
(function() {
    'use strict';
    
    // Flatpickr Library (already minified)
    /* flatpickr v4.6.13,, @license MIT */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).flatpickr=n()}(this,(function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var n,t=1,a=arguments.length;t<a;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function n(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var a=Array(e),i=0;for(n=0;n<t;n++)for(var o=arguments[n],r=0,l=o.length;r<l;r++,i++)a[i]=o[r];return a}var t=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],a={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:"object"==typeof window&&-1===window.navigator.userAgent.indexOf("MSIE"),ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(e){return"undefined"!=typeof console&&console.warn(e)},getWeek:function(e){var n=new Date(e.getTime());n.setHours(0,0,0,0),n.setDate(n.getDate()+3-(n.getDay()+6)%7);var t=new Date(n.getFullYear(),0,4);return 1+Math.round(((n.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},i={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(e){var n=e%100;if(n>3&&n<21)return"th";switch(n%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},o=function(e,n){return void 0===n&&(n=2),("000"+e).slice(-1*n)},r=function(e){return!0===e?1:0};function l(e,n){var t;return function(){var a=this,i=arguments;clearTimeout(t),t=setTimeout((function(){return e.apply(a,i)}),n)}}var c=function(e){return e instanceof Array?e:[e]};function s(e,n,t){if(!0===t)return e.classList.add(n);e.classList.remove(n)}function d(e,n,t){var a=window.document.createElement(e);return n=n||"",t=t||"",a.className=n,void 0!==t&&(a.textContent=t),a}function u(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function f(e,n){return n(e)?e:e.parentNode?f(e.parentNode,n):void 0}function m(e,n){var t=d("div","numInputWrapper"),a=d("input","numInput "+e),i=d("span","arrowUp"),o=d("span","arrowDown");if(-1===navigator.userAgent.indexOf("MSIE 9.0")?a.type="number":(a.type="text",a.pattern="\\d*"),void 0!==n)for(var r in n)a.setAttribute(r,n[r]);return t.appendChild(a),t.appendChild(i),t.appendChild(o),t}function g(e){try{return"function"==typeof e.composedPath?e.composedPath()[0]:e.target}catch(n){return e.target}}var p=function(){},h=function(e,n,t){return t.months[n?"shorthand":"longhand"][e]},v={D:p,F:function(e,n,t){e.setMonth(t.months.longhand.indexOf(n))},G:function(e,n){e.setHours((e.getHours()>=12?12:0)+parseFloat(n))},H:function(e,n){e.setHours(parseFloat(n))},J:function(e,n){e.setDate(parseFloat(n))},K:function(e,n,t){e.setHours(e.getHours()%12+12*r(new RegExp(t.amPM[1],"i").test(n)))},M:function(e,n,t){e.setMonth(t.months.shorthand.indexOf(n))},S:function(e,n){e.setSeconds(parseFloat(n))},U:function(e,n){return new Date(1e3*parseFloat(n))},W:function(e,n,t){var a=parseInt(n),i=new Date(e.getFullYear(),0,2+7*(a-1),0,0,0,0);return i.setDate(i.getDate()-i.getDay()+t.firstDayOfWeek),i},Y:function(e,n){e.setFullYear(parseFloat(n))},Z:function(e,n){return new Date(n)},d:function(e,n){e.setDate(parseFloat(n))},h:function(e,n){e.setHours((e.getHours()>=12?12:0)+parseFloat(n))},i:function(e,n){e.setMinutes(parseFloat(n))},j:function(e,n){e.setDate(parseFloat(n))},l:p,m:function(e,n){e.setMonth(parseFloat(n)-1)},n:function(e,n){e.setMonth(parseFloat(n)-1)},s:function(e,n){e.setSeconds(parseFloat(n))},u:function(e,n){return new Date(parseFloat(n))},w:p,y:function(e,n){e.setFullYear(2e3+parseFloat(n))}},D={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},w={Z:function(e){return e.toISOString()},D:function(e,n,t){return n.weekdays.shorthand[w.w(e,n,t)]},F:function(e,n,t){return h(w.n(e,n,t)-1,!1,n)},G:function(e,n,t){return o(w.h(e,n,t))},H:function(e){return o(e.getHours())},J:function(e,n){return void 0!==n.ordinal?e.getDate()+n.ordinal(e.getDate()):e.getDate()},K:function(e,n){return n.amPM[r(e.getHours()>11)]},M:function(e,n){return h(e.getMonth(),!0,n)},S:function(e){return o(e.getSeconds())},U:function(e){return e.getTime()/1e3},W:function(e,n,t){return t.getWeek(e)},Y:function(e){return o(e.getFullYear(),4)},d:function(e){return o(e.getDate())},h:function(e){return e.getHours()%12?e.getHours()%12:12},i:function(e){return o(e.getMinutes())},j:function(e){return e.getDate()},l:function(e,n){return n.weekdays.longhand[e.getDay()]},m:function(e){return o(e.getMonth()+1)},n:function(e){return e.getMonth()+1},s:function(e){return e.getSeconds()},u:function(e){return e.getTime()},w:function(e){return e.getDay()},y:function(e){return String(e.getFullYear()).substring(2)}},b=function(e){var n=e.config,t=void 0===n?a:n,o=e.l10n,r=void 0===o?i:o,l=e.isMobile,c=void 0!==l&&l;return function(e,n,a){var i=a||r;return void 0===t.formatDate||c?n.split("").map((function(n,a,o){return w[n]&&"\\"!==o[a-1]?w[n](e,i,t):"\\"!==n?n:""})).join(""):t.formatDate(e,n,i)}},C=function(e){var n=e.config,t=void 0===n?a:n,o=e.l10n,r=void 0===o?i:o;return function(e,n,i,o){if(0===e||e){var l,c=o||r,s=e;if(e instanceof Date)l=new Date(e.getTime());else if("string"!=typeof e&&void 0!==e.toFixed)l=new Date(e);else if("string"==typeof e){var d=n||(t||a).dateFormat,u=String(e).trim();if("today"===u)l=new Date,i=!0;else if(t&&t.parseDate)l=t.parseDate(e,d);else if(/Z$/.test(u)||/GMT$/.test(u))l=new Date(e);else{for(var f=void 0,m=[],g=0,p=0,h="";g<d.length;g++){var w=d[g],b="\\"===w,C="\\"===d[g-1]||b;if(D[w]&&!C){h+=D[w];var M=new RegExp(h).exec(e);M&&(f=!0)&&m["Y"!==w?"push":"unshift"]({fn:v[w],val:M[++p]})}else b||(h+=".")}l=t&&t.noCalendar?new Date((new Date).setHours(0,0,0,0)):new Date((new Date).getFullYear(),0,1,0,0,0,0),m.forEach((function(e){var n=e.fn,t=e.val;return l=n(l,t,c)||l})),l=f?l:void 0}}if(l instanceof Date&&!isNaN(l.getTime()))return!0===i&&l.setHours(0,0,0,0),l;t.errorHandler(new Error("Invalid date provided: "+s))}}};function M(e,n,t){return void 0===t&&(t=!0),!1!==t?new Date(e.getTime()).setHours(0,0,0,0)-new Date(n.getTime()).setHours(0,0,0,0):e.getTime()-n.getTime()}var y=function(e,n,t){return 3600*e+60*n+t},x=864e5;function E(e){var n=e.defaultHour,t=e.defaultMinute,a=e.defaultSeconds;if(void 0!==e.minDate){var i=e.minDate.getHours(),o=e.minDate.getMinutes(),r=e.minDate.getSeconds();n<i&&(n=i),n===i&&t<o&&(t=o),n===i&&t===o&&a<r&&(a=e.minDate.getSeconds())}if(void 0!==e.maxDate){var l=e.maxDate.getHours(),c=e.maxDate.getMinutes();(n=Math.min(n,l))===l&&(t=Math.min(c,t)),n===l&&t===c&&(a=e.maxDate.getSeconds())}return{hours:n,minutes:t,seconds:a}}"function"!=typeof Object.assign&&(Object.assign=function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];if(!e)throw TypeError("Cannot convert undefined or null to object");for(var a=function(n){n&&Object.keys(n).forEach((function(t){return e[t]=n[t]}))},i=0,o=n;i<o.length;i++){var r=o[i];a(r)}return e});function k(p,v){var w={config:e(e({},a),I.defaultConfig),l10n:i};function k(){var e;return(null===(e=w.calendarContainer)||void 0===e?void 0:e.getRootNode()).activeElement||document.activeElement}function T(e){return e.bind(w)}function S(){var e=w.config;!1===e.weekNumbers&&1===e.showMonths||!0!==e.noCalendar&&window.requestAnimationFrame((function(){if(void 0!==w.calendarContainer&&(w.calendarContainer.style.visibility="hidden",w.calendarContainer.style.display="block"),void 0!==w.daysContainer){var n=(w.days.offsetWidth+1)*e.showMonths;w.daysContainer.style.width=n+"px",w.calendarContainer.style.width=n+(void 0!==w.weekWrapper?w.weekWrapper.offsetWidth:0)+"px",w.calendarContainer.style.removeProperty("visibility"),w.calendarContainer.style.removeProperty("display")}}))}function _(e){if(0===w.selectedDates.length){var n=void 0===w.config.minDate||M(new Date,w.config.minDate)>=0?new Date:new Date(w.config.minDate.getTime()),t=E(w.config);n.setHours(t.hours,t.minutes,t.seconds,n.getMilliseconds()),w.selectedDates=[n],w.latestSelectedDateObj=n}void 0!==e&&"blur"!==e.type&&function(e){e.preventDefault();var n="keydown"===e.type,t=g(e),a=t;void 0!==w.amPM&&t===w.amPM&&(w.amPM.textContent=w.l10n.amPM[r(w.amPM.textContent===w.l10n.amPM[0])]);var i=parseFloat(a.getAttribute("min")),l=parseFloat(a.getAttribute("max")),c=parseFloat(a.getAttribute("step")),s=parseInt(a.value,10),d=e.delta||(n?38===e.which?1:-1:0),u=s+c*d;if(void 0!==a.value&&2===a.value.length){var f=a===w.hourElement,m=a===w.minuteElement;u<i?(u=l+u+r(!f)+(r(f)&&r(!w.amPM)),m&&L(void 0,-1,w.hourElement)):u>l&&(u=a===w.hourElement?u-l-r(!w.amPM):i,m&&L(void 0,1,w.hourElement)),w.amPM&&f&&(1===c?u+s===23:Math.abs(u-s)>c)&&(w.amPM.textContent=w.l10n.amPM[r(w.amPM.textContent===w.l10n.amPM[0])]),a.value=o(u)}}(e);var a=w._input.value;O(),ye(),w._input.value!==a&&w._debouncedChange()}function O(){if(void 0!==w.hourElement&&void 0!==w.minuteElement){var e,n,t=(parseInt(w.hourElement.value.slice(-2),10)||0)%24,a=(parseInt(w.minuteElement.value,10)||0)%60,i=void 0!==w.secondElement?(parseInt(w.secondElement.value,10)||0)%60:0;void 0!==w.amPM&&(e=t,n=w.amPM.textContent,t=e%12+12*r(n===w.l10n.amPM[1]));var o=void 0!==w.config.minTime||w.config.minDate&&w.minDateHasTime&&w.latestSelectedDateObj&&0===M(w.latestSelectedDateObj,w.config.minDate,!0),l=void 0!==w.config.maxTime||w.config.maxDate&&w.maxDateHasTime&&w.latestSelectedDateObj&&0===M(w.latestSelectedDateObj,w.config.maxDate,!0);if(void 0!==w.config.maxTime&&void 0!==w.config.minTime&&w.config.minTime>w.config.maxTime){var c=y(w.config.minTime.getHours(),w.config.minTime.getMinutes(),w.config.minTime.getSeconds()),s=y(w.config.maxTime.getHours(),w.config.maxTime.getMinutes(),w.config.maxTime.getSeconds()),d=y(t,a,i);if(d>s&&d<c){var u=function(e){var n=Math.floor(e/3600),t=(e-3600*n)/60;return[n,t,e-3600*n-60*t]}(c);t=u[0],a=u[1],i=u[2]}}else{if(l){var f=void 0!==w.config.maxTime?w.config.maxTime:w.config.maxDate;(t=Math.min(t,f.getHours()))===f.getHours()&&(a=Math.min(a,f.getMinutes())),a===f.getMinutes()&&(i=Math.min(i,f.getSeconds()))}if(o){var m=void 0!==w.config.minTime?w.config.minTime:w.config.minDate;(t=Math.max(t,m.getHours()))===m.getHours()&&a<m.getMinutes()&&(a=m.getMinutes()),a===m.getMinutes()&&(i=Math.max(i,m.getSeconds()))}}A(t,a,i)}}function F(e){var n=e||w.latestSelectedDateObj;n&&n instanceof Date&&A(n.getHours(),n.getMinutes(),n.getSeconds())}function A(e,n,t){void 0!==w.latestSelectedDateObj&&w.latestSelectedDateObj.setHours(e%24,n,t||0,0),w.hourElement&&w.minuteElement&&!w.isMobile&&(w.hourElement.value=o(w.config.time_24hr?e:(12+e)%12+12*r(e%12==0)),w.minuteElement.value=o(n),void 0!==w.amPM&&(w.amPM.textContent=w.l10n.amPM[r(e>=12)]),void 0!==w.secondElement&&(w.secondElement.value=o(t)))}function N(e){var n=g(e),t=parseInt(n.value)+(e.delta||0);(t/1e3>1||"Enter"===e.key&&!/[^\d]/.test(t.toString()))&&ee(t)}function P(e,n,t,a){return n instanceof Array?n.forEach((function(n){return P(e,n,t,a)})):e instanceof Array?e.forEach((function(e){return P(e,n,t,a)})):(e.addEventListener(n,t,a),void w._handlers.push({remove:function(){return e.removeEventListener(n,t,a)}}))}function Y(){De("onChange")}function j(e,n){var t=void 0!==e?w.parseDate(e):w.latestSelectedDateObj||(w.config.minDate&&w.config.minDate>w.now?w.config.minDate:w.config.maxDate&&w.config.maxDate<w.now?w.config.maxDate:w.now),a=w.currentYear,i=w.currentMonth;try{void 0!==t&&(w.currentYear=t.getFullYear(),w.currentMonth=t.getMonth())}catch(e){e.message="Invalid date supplied: "+t,w.config.errorHandler(e)}n&&w.currentYear!==a&&(De("onYearChange"),q()),!n||w.currentYear===a&&w.currentMonth===i||De("onMonthChange"),w.redraw()}function H(e){var n=g(e);~n.className.indexOf("arrow")&&L(e,n.classList.contains("arrowUp")?1:-1)}function L(e,n,t){var a=e&&g(e),i=t||a&&a.parentNode&&a.parentNode.firstChild,o=we("increment");o.delta=n,i&&i.dispatchEvent(o)}function R(e,n,t,a){var i=ne(n,!0),o=d("span",e,n.getDate().toString());return o.dateObj=n,o.$i=a,o.setAttribute("aria-label",w.formatDate(n,w.config.ariaDateFormat)),-1===e.indexOf("hidden")&&0===M(n,w.now)&&(w.todayDateElem=o,o.classList.add("today"),o.setAttribute("aria-current","date")),i?(o.tabIndex=-1,be(n)&&(o.classList.add("selected"),w.selectedDateElem=o,"range"===w.config.mode&&(s(o,"startRange",w.selectedDates[0]&&0===M(n,w.selectedDates[0],!0)),s(o,"endRange",w.selectedDates[1]&&0===M(n,w.selectedDates[1],!0)),"nextMonthDay"===e&&o.classList.add("inRange")))):o.classList.add("flatpickr-disabled"),"range"===w.config.mode&&function(e){return!("range"!==w.config.mode||w.selectedDates.length<2)&&(M(e,w.selectedDates[0])>=0&&M(e,w.selectedDates[1])<=0)}(n)&&!be(n)&&o.classList.add("inRange"),w.weekNumbers&&1===w.config.showMonths&&"prevMonthDay"!==e&&a%7==6&&w.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+w.config.getWeek(n)+"</span>"),De("onDayCreate",o),o}function W(e){e.focus(),"range"===w.config.mode&&oe(e)}function B(e){for(var n=e>0?0:w.config.showMonths-1,t=e>0?w.config.showMonths:-1,a=n;a!=t;a+=e)for(var i=w.daysContainer.children[a],o=e>0?0:i.children.length-1,r=e>0?i.children.length:-1,l=o;l!=r;l+=e){var c=i.children[l];if(-1===c.className.indexOf("hidden")&&ne(c.dateObj))return c}}function J(e,n){var t=k(),a=te(t||document.body),i=void 0!==e?e:a?t:void 0!==w.selectedDateElem&&te(w.selectedDateElem)?w.selectedDateElem:void 0!==w.todayDateElem&&te(w.todayDateElem)?w.todayDateElem:B(n>0?1:-1);void 0===i?w._input.focus():a?function(e,n){for(var t=-1===e.className.indexOf("Month")?e.dateObj.getMonth():w.currentMonth,a=n>0?w.config.showMonths:-1,i=n>0?1:-1,o=t-w.currentMonth;o!=a;o+=i)for(var r=w.daysContainer.children[o],l=t-w.currentMonth===o?e.$i+n:n<0?r.children.length-1:0,c=r.children.length,s=l;s>=0&&s<c&&s!=(n>0?c:-1);s+=i){var d=r.children[s];if(-1===d.className.indexOf("hidden")&&ne(d.dateObj)&&Math.abs(e.$i-s)>=Math.abs(n))return W(d)}w.changeMonth(i),J(B(i),0)}(i,n):W(i)}function K(e,n){for(var t=(new Date(e,n,1).getDay()-w.l10n.firstDayOfWeek+7)%7,a=w.utils.getDaysInMonth((n-1+12)%12,e),i=w.utils.getDaysInMonth(n,e),o=window.document.createDocumentFragment(),r=w.config.showMonths>1,l=r?"prevMonthDay hidden":"prevMonthDay",c=r?"nextMonthDay hidden":"nextMonthDay",s=a+1-t,u=0;s<=a;s++,u++)o.appendChild(R("flatpickr-day "+l,new Date(e,n-1,s),0,u));for(s=1;s<=i;s++,u++)o.appendChild(R("flatpickr-day",new Date(e,n,s),0,u));for(var f=i+1;f<=42-t&&(1===w.config.showMonths||u%7!=0);f++,u++)o.appendChild(R("flatpickr-day "+c,new Date(e,n+1,f%i),0,u));var m=d("div","dayContainer");return m.appendChild(o),m}function U(){if(void 0!==w.daysContainer){u(w.daysContainer),w.weekNumbers&&u(w.weekNumbers);for(var e=document.createDocumentFragment(),n=0;n<w.config.showMonths;n++){var t=new Date(w.currentYear,w.currentMonth,1);t.setMonth(w.currentMonth+n),e.appendChild(K(t.getFullYear(),t.getMonth()))}w.daysContainer.appendChild(e),w.days=w.daysContainer.firstChild,"range"===w.config.mode&&1===w.selectedDates.length&&oe()}}function q(){if(!(w.config.showMonths>1||"dropdown"!==w.config.monthSelectorType)){var e=function(e){return!(void 0!==w.config.minDate&&w.currentYear===w.config.minDate.getFullYear()&&e<w.config.minDate.getMonth())&&!(void 0!==w.config.maxDate&&w.currentYear===w.config.maxDate.getFullYear()&&e>w.config.maxDate.getMonth())};w.monthsDropdownContainer.tabIndex=-1,w.monthsDropdownContainer.innerHTML="";for(var n=0;n<12;n++)if(e(n)){var t=d("option","flatpickr-monthDropdown-month");t.value=new Date(w.currentYear,n).getMonth().toString(),t.textContent=h(n,w.config.shorthandCurrentMonth,w.l10n),t.tabIndex=-1,w.currentMonth===n&&(t.selected=!0),w.monthsDropdownContainer.appendChild(t)}}}function $(){var e,n=d("div","flatpickr-month"),t=window.document.createDocumentFragment();w.config.showMonths>1||"static"===w.config.monthSelectorType?e=d("span","cur-month"):(w.monthsDropdownContainer=d("select","flatpickr-monthDropdown-months"),w.monthsDropdownContainer.setAttribute("aria-label",w.l10n.monthAriaLabel),P(w.monthsDropdownContainer,"change",(function(e){var n=g(e),t=parseInt(n.value,10);w.changeMonth(t-w.currentMonth),De("onMonthChange")})),q(),e=w.monthsDropdownContainer);var a=m("cur-year",{tabindex:"-1"}),i=a.getElementsByTagName("input")[0];i.setAttribute("aria-label",w.l10n.yearAriaLabel),w.config.minDate&&i.setAttribute("min",w.config.minDate.getFullYear().toString()),w.config.maxDate&&(i.setAttribute("max",w.config.maxDate.getFullYear().toString()),i.disabled=!!w.config.minDate&&w.config.minDate.getFullYear()===w.config.maxDate.getFullYear());var o=d("div","flatpickr-current-month");return o.appendChild(e),o.appendChild(a),t.appendChild(o),n.appendChild(t),{container:n,yearElement:i,monthElement:e}}function V(){u(w.monthNav),w.monthNav.appendChild(w.prevMonthNav),w.config.showMonths&&(w.yearElements=[],w.monthElements=[]);for(var e=w.config.showMonths;e--;){var n=$();w.yearElements.push(n.yearElement),w.monthElements.push(n.monthElement),w.monthNav.appendChild(n.container)}w.monthNav.appendChild(w.nextMonthNav)}function z(){w.weekdayContainer?u(w.weekdayContainer):w.weekdayContainer=d("div","flatpickr-weekdays");for(var e=w.config.showMonths;e--;){var n=d("div","flatpickr-weekdaycontainer");w.weekdayContainer.appendChild(n)}return G(),w.weekdayContainer}function G(){if(w.weekdayContainer){var e=w.l10n.firstDayOfWeek,t=n(w.l10n.weekdays.shorthand);e>0&&e<t.length&&(t=n(t.splice(e,t.length),t.splice(0,e)));for(var a=w.config.showMonths;a--;)w.weekdayContainer.children[a].innerHTML="\n      <span class='flatpickr-weekday'>\n        "+t.join("</span><span class='flatpickr-weekday'>")+"\n      </span>\n      "}}function Z(e,n){void 0===n&&(n=!0);var t=n?e:e-w.currentMonth;t<0&&!0===w._hidePrevMonthArrow||t>0&&!0===w._hideNextMonthArrow||(w.currentMonth+=t,(w.currentMonth<0||w.currentMonth>11)&&(w.currentYear+=w.currentMonth>11?1:-1,w.currentMonth=(w.currentMonth+12)%12,De("onYearChange"),q()),U(),De("onMonthChange"),Ce())}function Q(e){return w.calendarContainer.contains(e)}function X(e){if(w.isOpen&&!w.config.inline){var n=g(e),t=Q(n),a=!(n===w.input||n===w.altInput||w.element.contains(n)||e.path&&e.path.indexOf&&(~e.path.indexOf(w.input)||~e.path.indexOf(w.altInput)))&&!t&&!Q(e.relatedTarget),i=!w.config.ignoredFocusElements.some((function(e){return e.contains(n)}));a&&i&&(w.config.allowInput&&w.setDate(w._input.value,!1,w.config.altInput?w.config.altFormat:w.config.dateFormat),void 0!==w.timeContainer&&void 0!==w.minuteElement&&void 0!==w.hourElement&&""!==w.input.value&&void 0!==w.input.value&&_(),w.close(),w.config&&"range"===w.config.mode&&1===w.selectedDates.length&&w.clear(!1))}}function ee(e){if(!(!e||w.config.minDate&&e<w.config.minDate.getFullYear()||w.config.maxDate&&e>w.config.maxDate.getFullYear())){var n=e,t=w.currentYear!==n;w.currentYear=n||w.currentYear,w.config.maxDate&&w.currentYear===w.config.maxDate.getFullYear()?w.currentMonth=Math.min(w.config.maxDate.getMonth(),w.currentMonth):w.config.minDate&&w.currentYear===w.config.minDate.getFullYear()&&(w.currentMonth=Math.max(w.config.minDate.getMonth(),w.currentMonth)),t&&(w.redraw(),De("onYearChange"),q())}}function ne(e,n){var t;void 0===n&&(n=!0);var a=w.parseDate(e,void 0,n);if(w.config.minDate&&a&&M(a,w.config.minDate,void 0!==n?n:!w.minDateHasTime)<0||w.config.maxDate&&a&&M(a,w.config.maxDate,void 0!==n?n:!w.maxDateHasTime)>0)return!1;if(!w.config.enable&&0===w.config.disable.length)return!0;if(void 0===a)return!1;for(var i=!!w.config.enable,o=null!==(t=w.config.enable)&&void 0!==t?t:w.config.disable,r=0,l=void 0;r<o.length;r++){if("function"==typeof(l=o[r])&&l(a))return i;if(l instanceof Date&&void 0!==a&&l.getTime()===a.getTime())return i;if("string"==typeof l){var c=w.parseDate(l,void 0,!0);return c&&c.getTime()===a.getTime()?i:!i}if("object"==typeof l&&void 0!==a&&l.from&&l.to&&a.getTime()>=l.from.getTime()&&a.getTime()<=l.to.getTime())return i}return!i}function te(e){return void 0!==w.daysContainer&&(-1===e.className.indexOf("hidden")&&-1===e.className.indexOf("flatpickr-disabled")&&w.daysContainer.contains(e))}function ae(e){var n=e.target===w._input,t=w._input.value.trimEnd()!==Me();!n||!t||e.relatedTarget&&Q(e.relatedTarget)||w.setDate(w._input.value,!0,e.target===w.altInput?w.config.altFormat:w.config.dateFormat)}function ie(e){var n=g(e),t=w.config.wrap?p.contains(n):n===w._input,a=w.config.allowInput,i=w.isOpen&&(!a||!t),o=w.config.inline&&t&&!a;if(13===e.keyCode&&t){if(a)return w.setDate(w._input.value,!0,n===w.altInput?w.config.altFormat:w.config.dateFormat),w.close(),n.blur();w.open()}else if(Q(n)||i||o){var r=!!w.timeContainer&&w.timeContainer.contains(n);switch(e.keyCode){case 13:r?(e.preventDefault(),_(),fe()):me(e);break;case 27:e.preventDefault(),fe();break;case 8:case 46:t&&!w.config.allowInput&&(e.preventDefault(),w.clear());break;case 37:case 39:if(r||t)w.hourElement&&w.hourElement.focus();else{e.preventDefault();var l=k();if(void 0!==w.daysContainer&&(!1===a||l&&te(l))){var c=39===e.keyCode?1:-1;e.ctrlKey?(e.stopPropagation(),Z(c),J(B(1),0)):J(void 0,c)}}break;case 38:case 40:e.preventDefault();var s=40===e.keyCode?1:-1;w.daysContainer&&void 0!==n.$i||n===w.input||n===w.altInput?e.ctrlKey?(e.stopPropagation(),ee(w.currentYear-s),J(B(1),0)):r||J(void 0,7*s):n===w.currentYearElement?ee(w.currentYear-s):w.config.enableTime&&(!r&&w.hourElement&&w.hourElement.focus(),_(e),w._debouncedChange());break;case 9:if(r){var d=[w.hourElement,w.minuteElement,w.secondElement,w.amPM].concat(w.pluginElements).filter((function(e){return e})),u=d.indexOf(n);if(-1!==u){var f=d[u+(e.shiftKey?-1:1)];e.preventDefault(),(f||w._input).focus()}}else!w.config.noCalendar&&w.daysContainer&&w.daysContainer.contains(n)&&e.shiftKey&&(e.preventDefault(),w._input.focus())}}if(void 0!==w.amPM&&n===w.amPM)switch(e.key){case w.l10n.amPM[0].charAt(0):case w.l10n.amPM[0].charAt(0).toLowerCase():w.amPM.textContent=w.l10n.amPM[0],O(),ye();break;case w.l10n.amPM[1].charAt(0):case w.l10n.amPM[1].charAt(0).toLowerCase():w.amPM.textContent=w.l10n.amPM[1],O(),ye()}(t||Q(n))&&De("onKeyDown",e)}function oe(e,n){if(void 0===n&&(n="flatpickr-day"),1===w.selectedDates.length&&(!e||e.classList.contains(n)&&!e.classList.contains("flatpickr-disabled"))){for(var t=e?e.dateObj.getTime():w.days.firstElementChild.dateObj.getTime(),a=w.parseDate(w.selectedDates[0],void 0,!0).getTime(),i=Math.min(t,w.selectedDates[0].getTime()),o=Math.max(t,w.selectedDates[0].getTime()),r=!1,l=0,c=0,s=i;s<o;s+=x)ne(new Date(s),!0)||(r=r||s>i&&s<o,s<a&&(!l||s>l)?l=s:s>a&&(!c||s<c)&&(c=s));Array.from(w.rContainer.querySelectorAll("*:nth-child(-n+"+w.config.showMonths+") > ."+n)).forEach((function(n){var i,o,s,d=n.dateObj.getTime(),u=l>0&&d<l||c>0&&d>c;if(u)return n.classList.add("notAllowed"),void["inRange","startRange","endRange"].forEach((function(e){n.classList.remove(e)}));r&&!u||(["startRange","inRange","endRange","notAllowed"].forEach((function(e){n.classList.remove(e)})),void 0!==e&&(e.classList.add(t<=w.selectedDates[0].getTime()?"startRange":"endRange"),a<t&&d===a?n.classList.add("startRange"):a>t&&d===a&&n.classList.add("endRange"),d>=l&&(0===c||d<=c)&&(o=a,s=t,(i=d)>Math.min(o,s)&&i<Math.max(o,s))&&n.classList.add("inRange")))}))}}function re(){!w.isOpen||w.config.static||w.config.inline||de()}function le(e){return function(n){var t=w.config["_"+e+"Date"]=w.parseDate(n,w.config.dateFormat),a=w.config["_"+("min"===e?"max":"min")+"Date"];void 0!==t&&(w["min"===e?"minDateHasTime":"maxDateHasTime"]=t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0),w.selectedDates&&(w.selectedDates=w.selectedDates.filter((function(e){return ne(e)})),w.selectedDates.length||"min"!==e||F(t),ye()),w.daysContainer&&(ue(),void 0!==t?w.currentYearElement[e]=t.getFullYear().toString():w.currentYearElement.removeAttribute(e),w.currentYearElement.disabled=!!a&&void 0!==t&&a.getFullYear()===t.getFullYear())}}function ce(){return w.config.wrap?p.querySelector("[data-input]"):p}function se(){"object"!=typeof w.config.locale&&void 0===I.l10ns[w.config.locale]&&w.config.errorHandler(new Error("flatpickr: invalid locale "+w.config.locale)),w.l10n=e(e({},I.l10ns.default),"object"==typeof w.config.locale?w.config.locale:"default"!==w.config.locale?I.l10ns[w.config.locale]:void 0),D.D="("+w.l10n.weekdays.shorthand.join("|")+")",D.l="("+w.l10n.weekdays.longhand.join("|")+")",D.M="("+w.l10n.months.shorthand.join("|")+")",D.F="("+w.l10n.months.longhand.join("|")+")",D.K="("+w.l10n.amPM[0]+"|"+w.l10n.amPM[1]+"|"+w.l10n.amPM[0].toLowerCase()+"|"+w.l10n.amPM[1].toLowerCase()+")",void 0===e(e({},v),JSON.parse(JSON.stringify(p.dataset||{}))).time_24hr&&void 0===I.defaultConfig.time_24hr&&(w.config.time_24hr=w.l10n.time_24hr),w.formatDate=b(w),w.parseDate=C({config:w.config,l10n:w.l10n})}function de(e){if("function"!=typeof w.config.position){if(void 0!==w.calendarContainer){De("onPreCalendarPosition");var n=e||w._positionElement,t=Array.prototype.reduce.call(w.calendarContainer.children,(function(e,n){return e+n.offsetHeight}),0),a=w.calendarContainer.offsetWidth,i=w.config.position.split(" "),o=i[0],r=i.length>1?i[1]:null,l=n.getBoundingClientRect(),c=window.innerHeight-l.bottom,d="above"===o||"below"!==o&&c<t&&l.top>t,u=window.pageYOffset+l.top+(d?-t-2:n.offsetHeight+2);if(s(w.calendarContainer,"arrowTop",!d),s(w.calendarContainer,"arrowBottom",d),!w.config.inline){var f=window.pageXOffset+l.left,m=!1,g=!1;"center"===r?(f-=(a-l.width)/2,m=!0):"right"===r&&(f-=a-l.width,g=!0),s(w.calendarContainer,"arrowLeft",!m&&!g),s(w.calendarContainer,"arrowCenter",m),s(w.calendarContainer,"arrowRight",g);var p=window.document.body.offsetWidth-(window.pageXOffset+l.right),h=f+a>window.document.body.offsetWidth,v=p+a>window.document.body.offsetWidth;if(s(w.calendarContainer,"rightMost",h),!w.config.static)if(w.calendarContainer.style.top=u+"px",h)if(v){var D=function(){for(var e=null,n=0;n<document.styleSheets.length;n++){var t=document.styleSheets[n];if(t.cssRules){try{t.cssRules}catch(e){continue}e=t;break}}return null!=e?e:(a=document.createElement("style"),document.head.appendChild(a),a.sheet);var a}();if(void 0===D)return;var b=window.document.body.offsetWidth,C=Math.max(0,b/2-a/2),M=D.cssRules.length,y="{left:"+l.left+"px;right:auto;}";s(w.calendarContainer,"rightMost",!1),s(w.calendarContainer,"centerMost",!0),D.insertRule(".flatpickr-calendar.centerMost:before,.flatpickr-calendar.centerMost:after"+y,M),w.calendarContainer.style.left=C+"px",w.calendarContainer.style.right="auto"}else w.calendarContainer.style.left="auto",w.calendarContainer.style.right=p+"px";else w.calendarContainer.style.left=f+"px",w.calendarContainer.style.right="auto"}}}else w.config.position(w,e)}function ue(){w.config.noCalendar||w.isMobile||(q(),Ce(),U())}function fe(){w._input.focus(),-1!==window.navigator.userAgent.indexOf("MSIE")||void 0!==navigator.msMaxTouchPoints?setTimeout(w.close,0):w.close()}function me(e){e.preventDefault(),e.stopPropagation();var n=f(g(e),(function(e){return e.classList&&e.classList.contains("flatpickr-day")&&!e.classList.contains("flatpickr-disabled")&&!e.classList.contains("notAllowed")}));if(void 0!==n){var t=n,a=w.latestSelectedDateObj=new Date(t.dateObj.getTime()),i=(a.getMonth()<w.currentMonth||a.getMonth()>w.currentMonth+w.config.showMonths-1)&&"range"!==w.config.mode;if(w.selectedDateElem=t,"single"===w.config.mode)w.selectedDates=[a];else if("multiple"===w.config.mode){var o=be(a);o?w.selectedDates.splice(parseInt(o),1):w.selectedDates.push(a)}else"range"===w.config.mode&&(2===w.selectedDates.length&&w.clear(!1,!1),w.latestSelectedDateObj=a,w.selectedDates.push(a),0!==M(a,w.selectedDates[0],!0)&&w.selectedDates.sort((function(e,n){return e.getTime()-n.getTime()})));if(O(),i){var r=w.currentYear!==a.getFullYear();w.currentYear=a.getFullYear(),w.currentMonth=a.getMonth(),r&&(De("onYearChange"),q()),De("onMonthChange")}if(Ce(),U(),ye(),i||"range"===w.config.mode||1!==w.config.showMonths?void 0!==w.selectedDateElem&&void 0===w.hourElement&&w.selectedDateElem&&w.selectedDateElem.focus():W(t),void 0!==w.hourElement&&void 0!==w.hourElement&&w.hourElement.focus(),w.config.closeOnSelect){var l="single"===w.config.mode&&!w.config.enableTime,c="range"===w.config.mode&&2===w.selectedDates.length&&!w.config.enableTime;(l||c)&&fe()}Y()}}w.parseDate=C({config:w.config,l10n:w.l10n}),w._handlers=[],w.pluginElements=[],w.loadedPlugins=[],w._bind=P,w._setHoursFromDate=F,w._positionCalendar=de,w.changeMonth=Z,w.changeYear=ee,w.clear=function(e,n){void 0===e&&(e=!0);void 0===n&&(n=!0);w.input.value="",void 0!==w.altInput&&(w.altInput.value="");void 0!==w.mobileInput&&(w.mobileInput.value="");w.selectedDates=[],w.latestSelectedDateObj=void 0,!0===n&&(w.currentYear=w._initialDate.getFullYear(),w.currentMonth=w._initialDate.getMonth());if(!0===w.config.enableTime){var t=E(w.config),a=t.hours,i=t.minutes,o=t.seconds;A(a,i,o)}w.redraw(),e&&De("onChange")},w.close=function(){w.isOpen=!1,w.isMobile||(void 0!==w.calendarContainer&&w.calendarContainer.classList.remove("open"),void 0!==w._input&&w._input.classList.remove("active"));De("onClose")},w.onMouseOver=oe,w._createElement=d,w.createDay=R,w.destroy=function(){void 0!==w.config&&De("onDestroy");for(var e=w._handlers.length;e--;)w._handlers[e].remove();if(w._handlers=[],w.mobileInput)w.mobileInput.parentNode&&w.mobileInput.parentNode.removeChild(w.mobileInput),w.mobileInput=void 0;else if(w.calendarContainer&&w.calendarContainer.parentNode)if(w.config.static&&w.calendarContainer.parentNode){var n=w.calendarContainer.parentNode;if(n.lastChild&&n.removeChild(n.lastChild),n.parentNode){for(;n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}}else w.calendarContainer.parentNode.removeChild(w.calendarContainer);w.altInput&&(w.input.type="text",w.altInput.parentNode&&w.altInput.parentNode.removeChild(w.altInput),delete w.altInput);w.input&&(w.input.type=w.input._type,w.input.classList.remove("flatpickr-input"),w.input.removeAttribute("readonly"));["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach((function(e){try{delete w[e]}catch(e){}}))},w.isEnabled=ne,w.jumpToDate=j,w.updateValue=ye,w.open=function(e,n){void 0===n&&(n=w._positionElement);if(!0===w.isMobile){if(e){e.preventDefault();var t=g(e);t&&t.blur()}return void 0!==w.mobileInput&&(w.mobileInput.focus(),w.mobileInput.click()),void De("onOpen")}if(w._input.disabled||w.config.inline)return;var a=w.isOpen;w.isOpen=!0,a||(w.calendarContainer.classList.add("open"),w._input.classList.add("active"),De("onOpen"),de(n));!0===w.config.enableTime&&!0===w.config.noCalendar&&(!1!==w.config.allowInput||void 0!==e&&w.timeContainer.contains(e.relatedTarget)||setTimeout((function(){return w.hourElement.select()}),50))},w.redraw=ue,w.set=function(e,n){if(null!==e&&"object"==typeof e)for(var a in Object.assign(w.config,e),e)void 0!==ge[a]&&ge[a].forEach((function(e){return e()}));else w.config[e]=n,void 0!==ge[e]?ge[e].forEach((function(e){return e()})):t.indexOf(e)>-1&&(w.config[e]=c(n));w.redraw(),ye(!0)},w.setDate=function(e,n,t){void 0===n&&(n=!1);void 0===t&&(t=w.config.dateFormat);if(0!==e&&!e||e instanceof Array&&0===e.length)return w.clear(n);pe(e,t),w.latestSelectedDateObj=w.selectedDates[w.selectedDates.length-1],w.redraw(),j(void 0,n),F(),0===w.selectedDates.length&&w.clear(!1);ye(n),n&&De("onChange")},w.toggle=function(e){if(!0===w.isOpen)return w.close();w.open(e)};var ge={locale:[se,G],showMonths:[V,S,z],minDate:[j],maxDate:[j],positionElement:[ve],clickOpens:[function(){!0===w.config.clickOpens?(P(w._input,"focus",w.open),P(w._input,"click",w.open)):(w._input.removeEventListener("focus",w.open),w._input.removeEventListener("click",w.open))}]};function pe(e,n){var t=[];if(e instanceof Array)t=e.map((function(e){return w.parseDate(e,n)}));else if(e instanceof Date||"number"==typeof e)t=[w.parseDate(e,n)];else if("string"==typeof e)switch(w.config.mode){case"single":case"time":t=[w.parseDate(e,n)];break;case"multiple":t=e.split(w.config.conjunction).map((function(e){return w.parseDate(e,n)}));break;case"range":t=e.split(w.l10n.rangeSeparator).map((function(e){return w.parseDate(e,n)}))}else w.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(e)));w.selectedDates=w.config.allowInvalidPreload?t:t.filter((function(e){return e instanceof Date&&ne(e,!1)})),"range"===w.config.mode&&w.selectedDates.sort((function(e,n){return e.getTime()-n.getTime()}))}function he(e){return e.slice().map((function(e){return"string"==typeof e||"number"==typeof e||e instanceof Date?w.parseDate(e,void 0,!0):e&&"object"==typeof e&&e.from&&e.to?{from:w.parseDate(e.from,void 0),to:w.parseDate(e.to,void 0)}:e})).filter((function(e){return e}))}function ve(){w._positionElement=w.config.positionElement||w._input}function De(e,n){if(void 0!==w.config){var t=w.config[e];if(void 0!==t&&t.length>0)for(var a=0;t[a]&&a<t.length;a++)t[a](w.selectedDates,w.input.value,w,n);"onChange"===e&&(w.input.dispatchEvent(we("change")),w.input.dispatchEvent(we("input")))}}function we(e){var n=document.createEvent("Event");return n.initEvent(e,!0,!0),n}function be(e){for(var n=0;n<w.selectedDates.length;n++){var t=w.selectedDates[n];if(t instanceof Date&&0===M(t,e))return""+n}return!1}function Ce(){w.config.noCalendar||w.isMobile||!w.monthNav||(w.yearElements.forEach((function(e,n){var t=new Date(w.currentYear,w.currentMonth,1);t.setMonth(w.currentMonth+n),w.config.showMonths>1||"static"===w.config.monthSelectorType?w.monthElements[n].textContent=h(t.getMonth(),w.config.shorthandCurrentMonth,w.l10n)+" ":w.monthsDropdownContainer.value=t.getMonth().toString(),e.value=t.getFullYear().toString()})),w._hidePrevMonthArrow=void 0!==w.config.minDate&&(w.currentYear===w.config.minDate.getFullYear()?w.currentMonth<=w.config.minDate.getMonth():w.currentYear<w.config.minDate.getFullYear()),w._hideNextMonthArrow=void 0!==w.config.maxDate&&(w.currentYear===w.config.maxDate.getFullYear()?w.currentMonth+1>w.config.maxDate.getMonth():w.currentYear>w.config.maxDate.getFullYear()))}function Me(e){var n=e||(w.config.altInput?w.config.altFormat:w.config.dateFormat);return w.selectedDates.map((function(e){return w.formatDate(e,n)})).filter((function(e,n,t){return"range"!==w.config.mode||w.config.enableTime||t.indexOf(e)===n})).join("range"!==w.config.mode?w.config.conjunction:w.l10n.rangeSeparator)}function ye(e){void 0===e&&(e=!0),void 0!==w.mobileInput&&w.mobileFormatStr&&(w.mobileInput.value=void 0!==w.latestSelectedDateObj?w.formatDate(w.latestSelectedDateObj,w.mobileFormatStr):""),w.input.value=Me(w.config.dateFormat),void 0!==w.altInput&&(w.altInput.value=Me(w.config.altFormat)),!1!==e&&De("onValueUpdate")}function xe(e){var n=g(e),t=w.prevMonthNav.contains(n),a=w.nextMonthNav.contains(n);t||a?Z(t?-1:1):w.yearElements.indexOf(n)>=0?n.select():n.classList.contains("arrowUp")?w.changeYear(w.currentYear+1):n.classList.contains("arrowDown")&&w.changeYear(w.currentYear-1)}return function(){w.element=w.input=p,w.isOpen=!1,function(){var n=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],i=e(e({},JSON.parse(JSON.stringify(p.dataset||{}))),v),o={};w.config.parseDate=i.parseDate,w.config.formatDate=i.formatDate,Object.defineProperty(w.config,"enable",{get:function(){return w.config._enable},set:function(e){w.config._enable=he(e)}}),Object.defineProperty(w.config,"disable",{get:function(){return w.config._disable},set:function(e){w.config._disable=he(e)}});var r="time"===i.mode;if(!i.dateFormat&&(i.enableTime||r)){var l=I.defaultConfig.dateFormat||a.dateFormat;o.dateFormat=i.noCalendar||r?"H:i"+(i.enableSeconds?":S":""):l+" H:i"+(i.enableSeconds?":S":"")}if(i.altInput&&(i.enableTime||r)&&!i.altFormat){var s=I.defaultConfig.altFormat||a.altFormat;o.altFormat=i.noCalendar||r?"h:i"+(i.enableSeconds?":S K":" K"):s+" h:i"+(i.enableSeconds?":S":"")+" K"}Object.defineProperty(w.config,"minDate",{get:function(){return w.config._minDate},set:le("min")}),Object.defineProperty(w.config,"maxDate",{get:function(){return w.config._maxDate},set:le("max")});var d=function(e){return function(n){w.config["min"===e?"_minTime":"_maxTime"]=w.parseDate(n,"H:i:S")}};Object.defineProperty(w.config,"minTime",{get:function(){return w.config._minTime},set:d("min")}),Object.defineProperty(w.config,"maxTime",{get:function(){return w.config._maxTime},set:d("max")}),"time"===i.mode&&(w.config.noCalendar=!0,w.config.enableTime=!0);Object.assign(w.config,o,i);for(var u=0;u<n.length;u++)w.config[n[u]]=!0===w.config[n[u]]||"true"===w.config[n[u]];t.filter((function(e){return void 0!==w.config[e]})).forEach((function(e){w.config[e]=c(w.config[e]||[]).map(T)})),w.isMobile=!w.config.disableMobile&&!w.config.inline&&"single"===w.config.mode&&!w.config.disable.length&&!w.config.enable&&!w.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(u=0;u<w.config.plugins.length;u++){var f=w.config.plugins[u](w)||{};for(var m in f)t.indexOf(m)>-1?w.config[m]=c(f[m]).map(T).concat(w.config[m]):void 0===i[m]&&(w.config[m]=f[m])}i.altInputClass||(w.config.altInputClass=ce().className+" "+w.config.altInputClass);De("onParseConfig")}(),se(),function(){if(w.input=ce(),!w.input)return void w.config.errorHandler(new Error("Invalid input element specified"));w.input._type=w.input.type,w.input.type="text",w.input.classList.add("flatpickr-input"),w._input=w.input,w.config.altInput&&(w.altInput=d(w.input.nodeName,w.config.altInputClass),w._input=w.altInput,w.altInput.placeholder=w.input.placeholder,w.altInput.disabled=w.input.disabled,w.altInput.required=w.input.required,w.altInput.tabIndex=w.input.tabIndex,w.altInput.type="text",w.input.setAttribute("type","hidden"),!w.config.static&&w.input.parentNode&&w.input.parentNode.insertBefore(w.altInput,w.input.nextSibling));w.config.allowInput||w._input.setAttribute("readonly","readonly");ve()}(),function(){w.selectedDates=[],w.now=w.parseDate(w.config.now)||new Date;var e=w.config.defaultDate||("INPUT"!==w.input.nodeName&&"TEXTAREA"!==w.input.nodeName||!w.input.placeholder||w.input.value!==w.input.placeholder?w.input.value:null);e&&pe(e,w.config.dateFormat);w._initialDate=w.selectedDates.length>0?w.selectedDates[0]:w.config.minDate&&w.config.minDate.getTime()>w.now.getTime()?w.config.minDate:w.config.maxDate&&w.config.maxDate.getTime()<w.now.getTime()?w.config.maxDate:w.now,w.currentYear=w._initialDate.getFullYear(),w.currentMonth=w._initialDate.getMonth(),w.selectedDates.length>0&&(w.latestSelectedDateObj=w.selectedDates[0]);void 0!==w.config.minTime&&(w.config.minTime=w.parseDate(w.config.minTime,"H:i"));void 0!==w.config.maxTime&&(w.config.maxTime=w.parseDate(w.config.maxTime,"H:i"));w.minDateHasTime=!!w.config.minDate&&(w.config.minDate.getHours()>0||w.config.minDate.getMinutes()>0||w.config.minDate.getSeconds()>0),w.maxDateHasTime=!!w.config.maxDate&&(w.config.maxDate.getHours()>0||w.config.maxDate.getMinutes()>0||w.config.maxDate.getSeconds()>0)}(),w.utils={getDaysInMonth:function(e,n){return void 0===e&&(e=w.currentMonth),void 0===n&&(n=w.currentYear),1===e&&(n%4==0&&n%100!=0||n%400==0)?29:w.l10n.daysInMonth[e]}},w.isMobile||function(){var e=window.document.createDocumentFragment();if(w.calendarContainer=d("div","flatpickr-calendar"),w.calendarContainer.tabIndex=-1,!w.config.noCalendar){if(e.appendChild((w.monthNav=d("div","flatpickr-months"),w.yearElements=[],w.monthElements=[],w.prevMonthNav=d("span","flatpickr-prev-month"),w.prevMonthNav.innerHTML=w.config.prevArrow,w.nextMonthNav=d("span","flatpickr-next-month"),w.nextMonthNav.innerHTML=w.config.nextArrow,V(),Object.defineProperty(w,"_hidePrevMonthArrow",{get:function(){return w.__hidePrevMonthArrow},set:function(e){w.__hidePrevMonthArrow!==e&&(s(w.prevMonthNav,"flatpickr-disabled",e),w.__hidePrevMonthArrow=e)}}),Object.defineProperty(w,"_hideNextMonthArrow",{get:function(){return w.__hideNextMonthArrow},set:function(e){w.__hideNextMonthArrow!==e&&(s(w.nextMonthNav,"flatpickr-disabled",e),w.__hideNextMonthArrow=e)}}),w.currentYearElement=w.yearElements[0],Ce(),w.monthNav)),w.innerContainer=d("div","flatpickr-innerContainer"),w.config.weekNumbers){var n=function(){w.calendarContainer.classList.add("hasWeeks");var e=d("div","flatpickr-weekwrapper");e.appendChild(d("span","flatpickr-weekday",w.l10n.weekAbbreviation));var n=d("div","flatpickr-weeks");return e.appendChild(n),{weekWrapper:e,weekNumbers:n}}(),t=n.weekWrapper,a=n.weekNumbers;w.innerContainer.appendChild(t),w.weekNumbers=a,w.weekWrapper=t}w.rContainer=d("div","flatpickr-rContainer"),w.rContainer.appendChild(z()),w.daysContainer||(w.daysContainer=d("div","flatpickr-days"),w.daysContainer.tabIndex=-1),U(),w.rContainer.appendChild(w.daysContainer),w.innerContainer.appendChild(w.rContainer),e.appendChild(w.innerContainer)}w.config.enableTime&&e.appendChild(function(){w.calendarContainer.classList.add("hasTime"),w.config.noCalendar&&w.calendarContainer.classList.add("noCalendar");var e=E(w.config);w.timeContainer=d("div","flatpickr-time"),w.timeContainer.tabIndex=-1;var n=d("span","flatpickr-time-separator",":"),t=m("flatpickr-hour",{"aria-label":w.l10n.hourAriaLabel});w.hourElement=t.getElementsByTagName("input")[0];var a=m("flatpickr-minute",{"aria-label":w.l10n.minuteAriaLabel});w.minuteElement=a.getElementsByTagName("input")[0],w.hourElement.tabIndex=w.minuteElement.tabIndex=-1,w.hourElement.value=o(w.latestSelectedDateObj?w.latestSelectedDateObj.getHours():w.config.time_24hr?e.hours:function(e){switch(e%24){case 0:case 12:return 12;default:return e%12}}(e.hours)),w.minuteElement.value=o(w.latestSelectedDateObj?w.latestSelectedDateObj.getMinutes():e.minutes),w.hourElement.setAttribute("step",w.config.hourIncrement.toString()),w.minuteElement.setAttribute("step",w.config.minuteIncrement.toString()),w.hourElement.setAttribute("min",w.config.time_24hr?"0":"1"),w.hourElement.setAttribute("max",w.config.time_24hr?"23":"12"),w.hourElement.setAttribute("maxlength","2"),w.minuteElement.setAttribute("min","0"),w.minuteElement.setAttribute("max","59"),w.minuteElement.setAttribute("maxlength","2"),w.timeContainer.appendChild(t),w.timeContainer.appendChild(n),w.timeContainer.appendChild(a),w.config.time_24hr&&w.timeContainer.classList.add("time24hr");if(w.config.enableSeconds){w.timeContainer.classList.add("hasSeconds");var i=m("flatpickr-second");w.secondElement=i.getElementsByTagName("input")[0],w.secondElement.value=o(w.latestSelectedDateObj?w.latestSelectedDateObj.getSeconds():e.seconds),w.secondElement.setAttribute("step",w.minuteElement.getAttribute("step")),w.secondElement.setAttribute("min","0"),w.secondElement.setAttribute("max","59"),w.secondElement.setAttribute("maxlength","2"),w.timeContainer.appendChild(d("span","flatpickr-time-separator",":")),w.timeContainer.appendChild(i)}w.config.time_24hr||(w.amPM=d("span","flatpickr-am-pm",w.l10n.amPM[r((w.latestSelectedDateObj?w.hourElement.value:w.config.defaultHour)>11)]),w.amPM.title=w.l10n.toggleTitle,w.amPM.tabIndex=-1,w.timeContainer.appendChild(w.amPM));return w.timeContainer}());s(w.calendarContainer,"rangeMode","range"===w.config.mode),s(w.calendarContainer,"animate",!0===w.config.animate),s(w.calendarContainer,"multiMonth",w.config.showMonths>1),w.calendarContainer.appendChild(e);var i=void 0!==w.config.appendTo&&void 0!==w.config.appendTo.nodeType;if((w.config.inline||w.config.static)&&(w.calendarContainer.classList.add(w.config.inline?"inline":"static"),w.config.inline&&(!i&&w.element.parentNode?w.element.parentNode.insertBefore(w.calendarContainer,w._input.nextSibling):void 0!==w.config.appendTo&&w.config.appendTo.appendChild(w.calendarContainer)),w.config.static)){var l=d("div","flatpickr-wrapper");w.element.parentNode&&w.element.parentNode.insertBefore(l,w.element),l.appendChild(w.element),w.altInput&&l.appendChild(w.altInput),l.appendChild(w.calendarContainer)}w.config.static||w.config.inline||(void 0!==w.config.appendTo?w.config.appendTo:window.document.body).appendChild(w.calendarContainer)}(),function(){w.config.wrap&&["open","close","toggle","clear"].forEach((function(e){Array.prototype.forEach.call(w.element.querySelectorAll("[data-"+e+"]"),(function(n){return P(n,"click",w[e])}))}));if(w.isMobile)return void function(){var e=w.config.enableTime?w.config.noCalendar?"time":"datetime-local":"date";w.mobileInput=d("input",w.input.className+" flatpickr-mobile"),w.mobileInput.tabIndex=1,w.mobileInput.type=e,w.mobileInput.disabled=w.input.disabled,w.mobileInput.required=w.input.required,w.mobileInput.placeholder=w.input.placeholder,w.mobileFormatStr="datetime-local"===e?"Y-m-d\\TH:i:S":"date"===e?"Y-m-d":"H:i:S",w.selectedDates.length>0&&(w.mobileInput.defaultValue=w.mobileInput.value=w.formatDate(w.selectedDates[0],w.mobileFormatStr));w.config.minDate&&(w.mobileInput.min=w.formatDate(w.config.minDate,"Y-m-d"));w.config.maxDate&&(w.mobileInput.max=w.formatDate(w.config.maxDate,"Y-m-d"));w.input.getAttribute("step")&&(w.mobileInput.step=String(w.input.getAttribute("step")));w.input.type="hidden",void 0!==w.altInput&&(w.altInput.type="hidden");try{w.input.parentNode&&w.input.parentNode.insertBefore(w.mobileInput,w.input.nextSibling)}catch(e){}P(w.mobileInput,"change",(function(e){w.setDate(g(e).value,!1,w.mobileFormatStr),De("onChange"),De("onClose")}))}();var e=l(re,50);w._debouncedChange=l(Y,300),w.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&P(w.daysContainer,"mouseover",(function(e){"range"===w.config.mode&&oe(g(e))}));P(w._input,"keydown",ie),void 0!==w.calendarContainer&&P(w.calendarContainer,"keydown",ie);w.config.inline||w.config.static||P(window,"resize",e);void 0!==window.ontouchstart?P(window.document,"touchstart",X):P(window.document,"mousedown",X);P(window.document,"focus",X,{capture:!0}),!0===w.config.clickOpens&&(P(w._input,"focus",w.open),P(w._input,"click",w.open));void 0!==w.daysContainer&&(P(w.monthNav,"click",xe),P(w.monthNav,["keyup","increment"],N),P(w.daysContainer,"click",me));if(void 0!==w.timeContainer&&void 0!==w.minuteElement&&void 0!==w.hourElement){var n=function(e){return g(e).select()};P(w.timeContainer,["increment"],_),P(w.timeContainer,"blur",_,{capture:!0}),P(w.timeContainer,"click",H),P([w.hourElement,w.minuteElement],["focus","click"],n),void 0!==w.secondElement&&P(w.secondElement,"focus",(function(){return w.secondElement&&w.secondElement.select()})),void 0!==w.amPM&&P(w.amPM,"click",(function(e){_(e)}))}w.config.allowInput&&P(w._input,"blur",ae)}(),(w.selectedDates.length||w.config.noCalendar)&&(w.config.enableTime&&F(w.config.noCalendar?w.latestSelectedDateObj:void 0),ye(!1)),S();var n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!w.isMobile&&n&&de(),De("onReady")}(),w}function T(e,n){for(var t=Array.prototype.slice.call(e).filter((function(e){return e instanceof HTMLElement})),a=[],i=0;i<t.length;i++){var o=t[i];try{if(null!==o.getAttribute("data-fp-omit"))continue;void 0!==o._flatpickr&&(o._flatpickr.destroy(),o._flatpickr=void 0),o._flatpickr=k(o,n||{}),a.push(o._flatpickr)}catch(e){console.error(e)}}return 1===a.length?a[0]:a}"undefined"!=typeof HTMLElement&&"undefined"!=typeof HTMLCollection&&"undefined"!=typeof NodeList&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(e){return T(this,e)},HTMLElement.prototype.flatpickr=function(e){return T([this],e)});var I=function(e,n){return"string"==typeof e?T(window.document.querySelectorAll(e),n):e instanceof Node?T([e],n):T(e,n)};return I.defaultConfig={},I.l10ns={en:e({},i),default:e({},i)},I.localize=function(n){I.l10ns.default=e(e({},I.l10ns.default),n)},I.setDefaults=function(n){I.defaultConfig=e(e({},I.defaultConfig),n)},I.parseDate=C({}),I.formatDate=b({}),I.compareDates=M,"undefined"!=typeof jQuery&&void 0!==jQuery.fn&&(jQuery.fn.flatpickr=function(e){return T(this,e)}),Date.prototype.fp_incr=function(e){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+("string"==typeof e?parseInt(e,10):e))},"undefined"!=typeof window&&(window.flatpickr=I),I}));
    
    function getCsrfToken(){const e=document.cookie.split(";").find((e=>e.trim().startsWith("crumb=")))?.split("=")[1];return e||null}function extractFileIdFromUrl(e){if(!e)return null;const t=e.match(/\/t\/([^\/]+)\//);return t?t[1]:null}async function deleteOldJsonFile(e){const t=getCsrfToken();if(t&&e)try{const n=extractFileIdFromUrl(e);if(!n)return;const o=window.location.hostname.includes("squarespace.com")&&document.querySelector('meta[name="website-id"]')?.content||"687467a95ae647520c2d338c",s=new URLSearchParams({templateId:"5c5a519771c10ba3470d8101",websiteId:o,itemId:n});await fetch(`${window.location.origin}/api/template/RemoveTemplateCSSAsset`,{method:"POST",headers:{accept:"application/json, text/plain, */*","content-type":"application/x-www-form-urlencoded","x-csrf-token":t},body:s.toString(),credentials:"include"})}catch(e){}}function convertScheduledDateToISO(e){try{let t;if(!e.includes("T")||e.includes("Z")||e.includes("+"))t=new Date(e);else{const n=e.includes(":")&&2===e.split(":").length?e+":00":e;t=new Date(n)}return t.toISOString()}catch(e){return new Date(Date.now()+36e5).toISOString()}}async function updateProductFields(e,t,n){const o=e.id,s="DIGITAL"===e.storeItem?.productType,i=t.variantId&&t.variantChanges,a=t.batchedVariantChanges&&Object.keys(t.batchedVariantChanges).length>0;if(i){const n=e.storeItem?.variants?.some((e=>e.id===t.variantId));if(!n)throw new Error(`Variant ID ${t.variantId} not found in product ${e.id}`)}else if(a){const n=Object.keys(t.batchedVariantChanges),o=e.storeItem?.variants?.map((e=>e.id))||[];for(const t of n)if(!o.includes(t))throw new Error(`Variant ID ${t} not found in product ${e.id}`)}let r;if(s){let n,o;if(void 0!==t.status)if("public"===t.status)n="VISIBLE";else if("hidden"===t.status)n="HIDDEN";else if("scheduled"===t.status)if(n="SCHEDULED",t.scheduledDate)try{o=convertScheduledDateToISO(t.scheduledDate)}catch(e){o=new Date(Date.now()+36e5).toISOString()}else o=new Date(Date.now()+36e5).toISOString();else n="HIDDEN";else n="PUBLISHED"===e.workflowState?"VISIBLE":"HIDDEN";const s=e.storeItem?.priceCurrency||window.getSystemCurrency?.();r={name:void 0!==t.title?t.title:e.title,description:e.description||"",visibility:{state:n,...o?{visibleOn:o}:"PUBLISHED"===e.workflowState&&{visibleOn:(new Date).toISOString()}},tags:e.tags||[],categories:e.categories||[],newImageOrder:[],price:{decimalValue:void 0!==t.price?parseFloat(t.price).toFixed(2):e.storeItem?.priceCents?(e.storeItem.priceCents/100).toFixed(2):"0.00",currencyCode:s},salePrice:{decimalValue:void 0!==t.salePrice?parseFloat(t.salePrice).toFixed(2):e.storeItem?.salePriceCents?(e.storeItem.salePriceCents/100).toFixed(2):"0.00",currencyCode:s},onSale:!1,shareStates:[],urlId:void 0!==t.url?t.url:e.urlId,regenerateUrlId:!1,sku:void 0!==t.sku?t.sku:e.storeItem?.sku||"",unlimited:void 0!==t.stock?"∞"===t.stock:e.storeItem?.unlimited||!1,productAddOnsConfiguration:{productAddOns:[]}};const i=parseFloat(r.price.decimalValue),a=parseFloat(r.salePrice.decimalValue);void 0!==t.onSale?"Yes"===t.onSale&&a>0&&a<i?r.onSale=!0:"Yes"===t.onSale&&a>=i?(r.salePrice.decimalValue=Math.max(.01,i-.01).toFixed(2),r.onSale=!0):r.onSale=!1:a>0&&a<i?r.onSale=!0:a>=i&&a>0?(r.salePrice.decimalValue=Math.max(.01,i-.01).toFixed(2),r.onSale=!0):r.onSale=!1,r.unlimited||void 0===t.stock||"∞"===t.stock||parseInt(t.stock)}else{const n=e.storeItem?.priceCurrency||window.getSystemCurrency?.(),o=i,s=e.storeItem?.variants?.map((e=>{let s;s=o?e.id===t.variantId?t.variantChanges:{}:a?t.batchedVariantChanges[e.id]?t.batchedVariantChanges[e.id]:{}:t;const i={id:e.id,sku:void 0!==s.sku?s.sku:e.sku,price:{decimalValue:void 0!==s.price?parseFloat(s.price).toFixed(2):e.price?(e.price/100).toFixed(2):"0.00",currencyCode:n},salePrice:{decimalValue:void 0!==s.salePrice?parseFloat(s.salePrice).toFixed(2):e.salePrice?(e.salePrice/100).toFixed(2):"0.00",currencyCode:n},unlimited:void 0!==s.stock?"∞"===s.stock:e.unlimited||!1,onSale:!1,optionValues:e.optionalValues||[],width:0,height:0,length:0,weight:0},r=parseFloat(i.price.decimalValue),c=parseFloat(i.salePrice.decimalValue);return void 0!==s.onSale?"Yes"===s.onSale&&c>0&&c<r?i.onSale=!0:"Yes"===s.onSale&&c>=r?(i.salePrice.decimalValue=Math.max(.01,r-.01).toFixed(2),i.onSale=!0):i.onSale=!1:c>0&&c<r?i.onSale=!0:c>=r&&c>0?(i.salePrice.decimalValue=Math.max(.01,r-.01).toFixed(2),i.onSale=!0):i.onSale=!1,i.unlimited||void 0===s.stock||"∞"===s.stock||parseInt(s.stock),i}))||[],c={...t};let l;if(delete c.variantId,delete c.variantChanges,delete c.batchedVariantChanges,"scheduled"===c.status)if(c.scheduledDate)try{l=convertScheduledDateToISO(c.scheduledDate)}catch(e){l=new Date(Date.now()+36e5).toISOString()}else l=new Date(Date.now()+36e5).toISOString();r={createdVariants:[],updatedVariants:s,deletedVariants:[],name:void 0!==c.title?c.title:e.title,description:e.description||"",visibility:{state:void 0!==c.status?"public"===c.status?"VISIBLE":"hidden"===c.status?"HIDDEN":"scheduled"===c.status?"SCHEDULED":"HIDDEN":"PUBLISHED"===e.workflowState?"VISIBLE":"HIDDEN",..."scheduled"===c.status&&l?{visibleOn:l}:"PUBLISHED"===e.workflowState&&{visibleOn:(new Date).toISOString()}},..."scheduled"===c.status&&l?{publishOn:l}:{},tags:e.tags||[],categories:e.categories||[],newImageOrder:[],variantOptionOrdering:e.storeItem?.variants?.length>0?[...new Set(e.storeItem.variants.flatMap((e=>(e.optionalValues||[]).map((e=>e.optionName)))))]:[],variantOrderBySkus:s.map((e=>e.sku)),useCustomAddButtonText:!1,customAddButtonText:"Add to Cart",featuredProduct:!1,shareStates:[],urlId:void 0!==c.url?c.url:e.urlId,regenerateUrlId:!1,productAddOnsConfiguration:{productAddOns:[]}}}const c=`${window.location.origin}/api/commerce/products/${o}`;try{const e=await fetch(c,{method:"PUT",headers:{accept:"application/json, text/plain, */*","content-type":"application/json","x-csrf-token":n},credentials:"include",body:JSON.stringify(r)});if(!e.ok){const t=await e.text();throw new Error(`HTTP ${e.status}: ${t}`)}return await e.json(),!0}catch(e){return!1}}async function updateProductCategories(e,t,n){try{const o=await getCategoryIdsByNames(t);if(!o||0===o.length)return!0;const s=`${window.location.origin}/api/commerce/products/${e}/categories/assign?categoryIds=${o.join(",")}`;return!!(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":n},credentials:"include"})).ok}catch(e){return!1}}async function getCategoryIdsByNames(e){const t=window.globalCategoriesData||[];if(0===t.length)return[];const n=[];for(const o of e){let e=t.find((e=>e.name===o));if(e)n.push(e.id);else{const e=await createNewCategory(o);if(e){n.push(e);const s={id:e,name:o,slug:o.toLowerCase().replace(/[^a-z0-9]/g,"-"),fullSlug:o.toLowerCase().replace(/[^a-z0-9]/g,"-"),itemCount:0,itemIds:[]};t.push(s),window.globalCategoriesData=t}}}return n}async function createNewCategory(e){try{const t=await getWebsiteId(),n=await getCollectionId();if(!t||!n)return null;const o=getCsrfToken();if(!o)return null;const s=`/api/content-service/product/1.1/websites/${t}/products/${n}/categories`,i=getRootCategoryId();if(!i)return null;const a={displayName:e,parentCategoryId:i,type:"INTERIOR",pageRendering:"LIST_VIEW",displayIndex:1},r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":o},body:JSON.stringify(a),credentials:"include"});if(r.ok){const e=await r.json();return e.id||e.categoryId||null}return null}catch(e){return null}}function getRootCategoryId(){if(window.globalCategoryTreeData&&window.globalCategoryTreeData.length>0){const e=window.globalCategoryTreeData.find((e=>"ROOT"===e.type));if(e)return e.id}return null}async function getWebsiteId(){if(window.globalCollectionsData&&window.globalCollectionsData.length>0){const e=window.globalCollectionsData[0].websiteId;if(e)return e}if(window.globalProductsData&&window.globalProductsData.length>0){const e=window.globalProductsData[0];if(e.websiteId)return e.websiteId}const e=window.location.pathname.match(/\/config\/pages\/([^\/]+)/);return e?e[1]:null}async function getCollectionId(){if(window.globalCollectionsData&&window.globalCollectionsData.length>0){const e=window.globalCollectionsData[0].id;if(e)return e}if(window.globalProductsData&&window.globalProductsData.length>0){const e=window.globalProductsData[0],t=e.collectionId||e.collection?.id;if(t)return t}return null}async function updateProductCategories(e,t,n){if(!t||0===t.length)return!0;const o=await getCategoryIdsByNames(t);if(!o||0===o.length)return!1;await new Promise((e=>setTimeout(e,1e3)));let s=0;for(let t=0;t<o.length;t++){const i=`/api/commerce/products/${e}/categories/assign?categoryIds=${o[t]}`;try{const e=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":n},credentials:"include"});e.ok?s++:await e.text()}catch(e){}t<o.length-1&&await new Promise((e=>setTimeout(e,250)))}return s===o.length}async function unassignProductCategories(e,t,n){if(!t||0===t.length)return!0;const o=await getCategoryIdsByNames(t);if(!o||0===o.length)return!1;let s=0;for(let t=0;t<o.length;t++){const i=`/api/commerce/products/${e}/categories/unassign?categoryIds=${o[t]}`;try{const e=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":n},credentials:"include"});e.ok?s++:await e.text()}catch(e){}t<o.length-1&&await new Promise((e=>setTimeout(e,250)))}return s===o.length}function getProductDataById(e){return globalProductsData.find((t=>t.id===e))||null}function getProcessedProductData(e){const t=getProductDataById(e);return t?{id:t.id,title:t.title,status:t.publicationStatus||"unknown",sku:t.sku||"",categories:t.categories?.map((e=>e.name)).join(", ")||"No categories",onSale:t.salePrice?"Yes":"No",price:t.price?formatCurrency(t.price):"N/A",salePrice:t.salePrice?formatCurrency(t.salePrice):"",stock:t.unlimited?"Unlimited":t.qtyInStock||0,type:t.type||"PHYSICAL"}:null}function getSelectedProductsWithData(){const e=document.querySelectorAll('.mix input[type="checkbox"]:checked'),t=(document.querySelectorAll('.mix input[type="checkbox"]'),Array.from(e).map((e=>{const t=e.closest("tr"),n=t?t.getAttribute("data-product-id"):null,o=!!t&&t.classList.contains("variant-row");return{productId:n,variantId:t?t.getAttribute("data-variant-id"):null,isVariant:o,row:t}})).filter((e=>e.productId))),n=globalProductsData.filter((e=>t.some((t=>t.productId===e.id))));return{products:n,selections:t,count:n.length}}function getSelectedProducts(){const e=document.querySelectorAll(".product-checkbox:checked");return Array.from(e).map((e=>e.closest("tr"))).filter((e=>null!==e))}function markProductAsChanged(e,t,n,o=null){if(!e)return;changedProducts.add(e);const s=`${e}.${t}`;originalData.has(s)||null===o||originalData.set(s,o),updateChangesFooter()}function updateChangesFooter(){const e=document.getElementById("changes-footer"),t=document.getElementById("changes-count");if(!e||!t)return;const n=changedProducts.size;if(n>0){t.textContent=`${n} product${1!==n?"s":""} modified`,e.classList.remove("hidden"),e.classList.add("visible"),e.style.cssText="";const o=document.querySelector(".changes-info");o&&(o.style.display="");const s=document.getElementById("save-changes"),i=window.licenseManager&&"demo"===window.licenseManager.getLicenseStatus().status;s&&(s.disabled=i,i?(s.textContent="Activate to Apply Changes",s.title="Apply changes is disabled in demo mode. Please activate your license to use this feature."):(s.textContent="Apply Changes",s.title=""))}else{const t=document.querySelector(".changes-notification-content");if(t&&"none"!==t.style.display&&"flex"===t.style.display)return;e.classList.remove("visible"),e.classList.add("hidden"),e.style.cssText=""}}function clearProductModifications(){changedProducts.clear(),originalData.clear(),void 0!==hasUnsavedChanges&&(hasUnsavedChanges=!1),document.querySelectorAll(".modified").forEach((e=>{e.classList.remove("modified"),e.removeAttribute("data-new-value"),e.removeAttribute("data-field-type")})),updateChangesFooter(),"function"==typeof loadProducts&&setTimeout((async()=>{try{await loadProducts()}catch(e){}}),100)}function getCurrentBulkSettings(){const e=document.getElementById("bulk-category-action"),t=document.getElementById("bulk-round-prices"),n=document.getElementById("bulk-regular-adjustment"),o=document.getElementById("bulk-regular-adjustment-type"),s=document.getElementById("bulk-adjust-sale-prices"),i=document.getElementById("bulk-fixed-price"),a=document.getElementById("bulk-fixed-apply-to-sale"),r=document.getElementById("bulk-sale-discount"),c=document.getElementById("bulk-sale-action"),l=document.getElementById("bulk-enable-rounding"),d=document.querySelector('input[name="bulk-rounding-type"]:checked'),u=document.getElementById("bulk-custom-cents"),p=document.getElementById("bulk-status-change"),g=document.getElementById("bulk-stock-toggle"),h=document.getElementById("bulk-stock-action"),m=document.getElementById("bulk-stock-amount"),y=document.getElementById("bulk-category-action-advanced"),f=document.getElementById("bulk-category-value"),v=document.getElementById("bulk-tag-action"),w=document.getElementById("bulk-tag-value"),k=document.getElementById("bulk-sku-action"),b=document.getElementById("bulk-sku-value");return{categoryToAdd:e?.value||null,roundPricesOnly:t?.checked||!1,priceAdjustment:n?.value?parseFloat(n.value):null,regularAdjustmentType:o?.value||"percentage",applyToSale:s?.checked||!1,fixedPrice:i?.value?parseFloat(i.value):null,fixedApplyToSale:a?.checked||!1,saleDiscount:r?.value?parseFloat(r.value):null,saleToggle:c?.value||"no-change",enableRounding:l?.checked||!1,roundingType:d?.value||"whole",customCents:u?.value?parseInt(u.value):99,newStatus:p?.value||null,enableStockTracking:g?.checked||!1,stockAction:h?.value||"set",stockAmount:m?.value?parseInt(m.value):null,categoryAction:y?.value||null,categoryValue:f?.value||null,tagAction:v?.value||null,tagValue:w?.value||null,skuAction:k?.value||null,skuValue:b?.value||null}}function applyBulkSettings(e){if(!e)return;const t=(e,t)=>{const n=document.getElementById(e);n&&("checkbox"===n.type?n.checked=!!t:"radio"===n.type?n.value===t&&(n.checked=!0):n.value=t||"",n.dispatchEvent(new Event("change",{bubbles:!0})))};if(t("bulk-category-action",e.categoryToAdd),t("bulk-round-prices",e.roundPricesOnly),t("bulk-regular-adjustment",e.priceAdjustment),t("bulk-regular-adjustment-type",e.regularAdjustmentType),t("bulk-adjust-sale-prices",e.applyToSale),t("bulk-fixed-price",e.fixedPrice),t("bulk-fixed-apply-to-sale",e.fixedApplyToSale),t("bulk-sale-discount",e.saleDiscount),t("bulk-sale-action",e.saleToggle),t("bulk-enable-rounding",e.enableRounding),t("bulk-custom-cents",e.customCents),t("bulk-status-change",e.newStatus),t("bulk-stock-toggle",e.enableStockTracking),t("bulk-stock-action",e.stockAction),t("bulk-stock-amount",e.stockAmount),e.roundingType){const t=document.querySelector(`input[name="bulk-rounding-type"][value="${e.roundingType}"]`);t&&(t.checked=!0,t.dispatchEvent(new Event("change",{bubbles:!0})))}t("bulk-category-action-advanced",e.categoryAction),t("bulk-category-value",e.categoryValue),t("bulk-tag-action",e.tagAction),t("bulk-tag-value",e.tagValue),t("bulk-sku-action",e.skuAction),t("bulk-sku-value",e.skuValue)}function generateActionDescription(e){const t=getCurrentBulkSettings(),n=[];return t.categoryToAdd&&n.push(`add category "${t.categoryToAdd}"`),null!==t.priceAdjustment&&n.push(`adjust prices by ${t.priceAdjustment}${"percentage"===t.regularAdjustmentType?"%":""}`),null!==t.fixedPrice&&n.push(`set price to $${t.fixedPrice}`),"no-change"!==t.saleToggle&&n.push(`${t.saleToggle} sale prices`),t.newStatus&&n.push(`change status to ${t.newStatus}`),t.enableStockTracking&&null!==t.stockAmount&&n.push(`${t.stockAction} stock to ${t.stockAmount}`),t.categoryAction&&t.categoryValue&&n.push(`${t.categoryAction} category "${t.categoryValue}"`),t.skuAction&&t.skuValue&&n.push(`${t.skuAction} SKU "${t.skuValue}"`),`Applied ${n.length>0?n.join(", "):"bulk changes"} to ${e} product${1!==e?"s":""}`}function validateProductData(e){return e&&"object"==typeof e?e.id?e.title?{valid:!0}:{valid:!1,error:"Product data missing title"}:{valid:!1,error:"Product data missing ID"}:{valid:!1,error:"Invalid product data structure"}}function deepClone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map((e=>deepClone(e)));if("object"==typeof e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=deepClone(e[n]));return t}}function formatCurrency(e,t=null){if(window.currencyManager)return window.currencyManager.formatCurrency(e,t);if(null==e||isNaN(e))return"N/A";const n=t||window.getSystemCurrency?.();return n?`${n}$${parseFloat(e).toFixed(2)}`:`$${parseFloat(e).toFixed(2)}`}function parseCurrency(e){if(!e||"string"!=typeof e)return null;const t=e.replace(/[^\d.-]/g,""),n=parseFloat(t);return isNaN(n)?null:n}async function saveChangesToSquarespace(){const e=getCsrfToken();if(!e)return alert("Unable to get authentication token. Please refresh and try again."),{successCount:0,errorCount:1};const t=document.querySelectorAll(".mix .modified"),n=new Map;t.forEach((e=>{const t=e.closest("tr"),o=t.getAttribute("data-product-id"),s=e.getAttribute("data-field-type"),i=e.getAttribute("data-new-value"),a=t.classList.contains("variant-row");let r,c;if(a){const e=t.getAttribute("data-parent-product");r=globalProductsData.find((t=>t.id===e)),c=e}else r=globalProductsData.find((e=>e.id===o)),c=o;!n.has(c)&&r&&n.set(c,{product:r,changes:{},variantChanges:{},categoryChanges:null});const l=n.get(c);if(l){let t;if(a?(l.variantChanges[o]||(l.variantChanges[o]={}),t=l.variantChanges[o]):t=l.changes,"price"===s)t.price=i;else if("title"===s)a||(t.title=i);else if("url"===s)a||(t.url=i);else if("sku"===s)t.sku=i;else if("salePrice"===s)t.salePrice=i;else if("onSale"===s)t.onSale=i;else if("status"===s){if(!a&&(t.status=i,"scheduled"===i)){const n=e.getAttribute("data-scheduled-date");n&&(t.scheduledDate=n)}}else if("stock"===s)t.stock=i;else if("category"===s&&!a){const t=e.getAttribute("data-categories-added"),n=e.getAttribute("data-categories-removed");l.categoryChanges={added:t?t.split(",").map((e=>e.trim())).filter((e=>e)):[],removed:n?n.split(",").map((e=>e.trim())).filter((e=>e)):[]}}}})),"undefined"!=typeof globalProgress&&globalProgress&&globalProgress.startMain(n.size,"Saving changes to Squarespace...");let o=0,s=0;const i=new Set;for(const[e,t]of n)if(t.categoryChanges?.added)for(const e of t.categoryChanges.added)!e.startsWith("new-category-")&&window.globalCategoriesData?.find((t=>t.id===e))||i.add(e);if(i.size>0)for(const e of i)"undefined"!=typeof globalProgress&&globalProgress&&globalProgress.updateMainProgress(`Creating category: ${e}...`);const a=Array.from(n.entries());if(a.length>0){const t=await(async t=>{const n=[],o=new Set;let s=0;const i=async()=>{if(s>=t.length)return;const a=s++,r=t[a];await new Promise((e=>setTimeout(e,50*a)));const c=(async(t,n)=>{const[o,s]=t,i=Object.keys(s.variantChanges).length>0,a=i?`${s.product.title} (${Object.keys(s.variantChanges).length} variant${Object.keys(s.variantChanges).length>1?"s":""})`:s.product.title;"undefined"!=typeof globalProgress&&globalProgress&&globalProgress.updateMainItem(n,a);try{let t=!0,n=!0;if(Object.keys(s.changes).length>0||i){let n={...s.changes};i&&(n.batchedVariantChanges=s.variantChanges),t=await updateProductFields(s.product,n,e)}if(s.categoryChanges&&(s.categoryChanges.added?.length>0||s.categoryChanges.removed?.length>0)){let t=!0,o=!0;s.categoryChanges.removed&&s.categoryChanges.removed.length>0&&(o=await unassignProductCategories(s.product.id,s.categoryChanges.removed,e)),s.categoryChanges.added&&s.categoryChanges.added.length>0&&(t=await updateProductCategories(s.product.id,s.categoryChanges.added,e)),n=t&&o}return t&&n?{success:!0,updateKey:o,displayName:a}:{success:!1,updateKey:o,displayName:a}}catch(e){return{success:!1,updateKey:o,displayName:a,error:e}}})(r,a);o.add(c);try{const e=await c;n[a]=e}catch(e){n[a]={success:!1,error:e}}finally{o.delete(c),s<t.length&&i()}},a=Math.min(10,t.length);for(let e=0;e<a;e++)i().catch((()=>{}));for(await new Promise((e=>setTimeout(e,10)));o.size>0;)await Promise.race(o);return n.filter((e=>void 0!==e))})(a);o+=t.filter((e=>e&&e.success)).length,s+=t.filter((e=>e&&!e.success)).length}if(o>0&&"function"==typeof applyUrlRedirects&&window.urlRedirects&&window.urlRedirects.size>0)try{await applyUrlRedirects()}catch(e){}return"undefined"!=typeof globalProgress&&globalProgress&&(0===s?globalProgress.completeMain(`Successfully saved ${o} product${1!==o?"s":""}!`):globalProgress.completeMain(`Saved ${o} products, ${s} failed`)),{successCount:o,errorCount:s}}function initializeDataUtilities(){const e=document.getElementById("discard-changes"),t=document.getElementById("save-changes");e&&e.addEventListener("click",(()=>{clearProductModifications(),"function"==typeof loadProducts&&loadProducts().then((()=>{})).catch((()=>{}))})),t&&t.addEventListener("click",(async()=>{if(window.licenseManager&&"demo"===window.licenseManager.getLicenseStatus().status)"function"==typeof showFooterNotification?showFooterNotification("Apply changes is disabled in demo mode. Please activate your license to use this feature.","error",5e3):alert("Apply changes is disabled in demo mode. Please activate your license to use this feature.");else try{t.textContent="Applying changes",t.disabled=!0;const e=document.getElementById("discard-changes");e&&(e.style.display="none");const n=document.querySelector(".changes-info");if(n&&(n.style.display="none"),changedProducts.size>0){const e=await saveChangesToSquarespace();e&&e.successCount>0?(document.querySelectorAll(".modified").forEach((e=>{e.classList.remove("modified"),e.removeAttribute("data-new-value"),e.removeAttribute("data-field-type")})),changedProducts.forEach((e=>{const t=getProductDataById(e);if(t){const n=convertProductToTableRow(t);originalData.set(e,{title:n.name,url:n.url,stock:n.stock,price:n.price,salePrice:n.salePrice,status:n.status})}})),clearProductModifications()):e&&e.errorCount>0&&("function"==typeof showFooterNotification?showFooterNotification("Failed to save changes. Please try again.","error"):showMessage("Failed to save changes. Please try again.","error"))}else"function"==typeof showFooterNotification?showFooterNotification("No changes to save.","info"):showMessage("No changes to save.","info")}catch(e){"function"==typeof showFooterNotification?showFooterNotification("Error saving changes. Please try again.","error"):showMessage("Error saving changes. Please try again.","error")}finally{t.textContent="Apply Changes",t.disabled=!1;const e=document.getElementById("discard-changes");e&&(e.style.display=""),document.querySelector(".changes-info")}}))}async function uploadJsonToCssAssets(e,t){try{const n=getCsrfToken();if(!n)throw new Error("No CSRF token found");const o=new File([t],e,{type:"application/json",lastModified:Date.now()}),s=new FormData;s.append("crumb",n),s.append("files",o);const i=await fetch(`${window.location.origin}/api/uploads/css-assets`,{method:"POST",body:s});if(!i.ok)throw await i.text(),new Error(`Upload failed: ${i.status} ${i.statusText}`);const a=await i.json(),r=a.media?.[0]?.assetUrl;if(!r)throw new Error("No file URL returned from upload");return r}catch(e){throw e}}async function savePresetsFile(e,t="Save presets"){if(presetFileSaveLock)return!1;presetFileSaveLock=!0;try{const n=getJsonFileUrl();if(!e)throw new Error("No presets data provided");const o=JSON.stringify(e,null,2),s=`sh_product_presets_${Date.now()}.json`,i=await uploadJsonToCssAssets(s,o,t);if(!i)throw new Error("Failed to upload new presets file");return!!await updateMetaTagWithJsonUrl(i)&&(n&&await deleteOldJsonFile(n),!0)}catch(e){return!1}finally{presetFileSaveLock=!1}}async function fetchPresets(){try{const e=getJsonFileUrl();if(!e)return{presets:[],version:"1.0.0",created:(new Date).toISOString(),lastModified:(new Date).toISOString()};const t=`${e}?t=${Date.now()}`,n=await fetch(t,{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!n.ok){if(404===n.status)return{presets:[],version:"1.0.0",created:(new Date).toISOString(),lastModified:(new Date).toISOString()};throw new Error(`HTTP ${n.status}: ${n.statusText}`)}const o=await n.json();if(!o||"object"!=typeof o)throw new Error("Invalid presets data structure");return o.presets||(o.presets=[]),o.version||(o.version="1.0.0"),o.created||(o.created=(new Date).toISOString()),o.lastModified||(o.lastModified=(new Date).toISOString()),o}catch(e){return{presets:[],version:"1.0.0",created:(new Date).toISOString(),lastModified:(new Date).toISOString(),error:e.message}}}async function savePresets(e){return await savePresetsFile(e,"Save presets")}async function createPresetsBackup(){try{const e=await fetchPresets(),t=`sh_product_presets_backup_${Date.now()}.json`,n={...e,backup:!0,backupCreated:(new Date).toISOString(),originalVersion:e.version},o=JSON.stringify(n,null,2);return await uploadJsonToCssAssets(t,o,"Create backup")}catch(e){return null}}async function importPresetsFromFile(e){try{if(!e)throw new Error("No file provided");if(!e.name.endsWith(".json"))throw new Error("File must be a JSON file");const t=await e.text(),n=JSON.parse(t);if(!n||"object"!=typeof n)throw new Error("Invalid file format");if(!n.presets||!Array.isArray(n.presets))throw new Error("File does not contain valid presets data");if(await createPresetsBackup(),n.lastModified=(new Date).toISOString(),n.importedAt=(new Date).toISOString(),await savePresetsFile(n,"Import presets"))return n;throw new Error("Failed to save imported presets")}catch(e){throw e}}async function exportPresetsToFile(){try{const e=await fetchPresets();if(!e.presets||0===e.presets.length)throw new Error("No presets to export");const t={...e,exported:!0,exportedAt:(new Date).toISOString()},n=JSON.stringify(t,null,2),o=`squarehero-product-presets-${(new Date).toISOString().replace(/[:.]/g,"-")}.json`,s=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(s),a=document.createElement("a");return a.href=i,a.download=o,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout((()=>URL.revokeObjectURL(i)),100),!0}catch(e){throw e}}function initializeFileUploadUtilities(){const e=document.getElementById("preset-import-zone");e&&(e.addEventListener("dragover",(t=>{t.preventDefault(),e.classList.add("drag-over")})),e.addEventListener("dragleave",(t=>{t.preventDefault(),e.classList.remove("drag-over")})),e.addEventListener("drop",(async t=>{t.preventDefault(),e.classList.remove("drag-over");const n=t.dataTransfer.files;if(n.length>0)try{await importPresetsFromFile(n[0]),"function"==typeof refreshPresetsList&&refreshPresetsList()}catch(e){"function"==typeof showBulkNotification&&showBulkNotification(`Import failed: ${e.message}`,"error")}})))}function initializeFlatpickr(e,t={}){if("undefined"==typeof flatpickr)return null;const n="string"==typeof e?document.querySelector(e):e;if(!n)return null;const o={enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"F j, Y at h:i K",time_24hr:!1,minDate:"today",inline:!0,static:!0,wrap:!1,onChange:function(){n&&n.dispatchEvent(new Event("change",{bubbles:!0}))},onDayCreate:function(e,t,n,o){const s=new Date(o.dateObj),i=new Date;i.setHours(0,0,0,0),s.setHours(0,0,0,0),s.getTime(),i.getTime()},onReady:function(e,t,n){const o=n.calendarContainer;if(o&&o.classList.add("squarehero-flatpickr"),!e.length){const e=new Date;n.setDate(e)}},onOpen:function(e,t,n){const o=e[0];if(o){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());if(new Date(o.getFullYear(),o.getMonth(),o.getDate()).getTime()===t.getTime()){const t=String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0");if(n.set("minTime",t),o<=e){const e=new Date;e.setSeconds(0,0),n.setDate(e)}}else n.set("minTime","00:00")}},onReady:function(e,t,n){const o=n.calendarContainer;o&&o.classList.add("squarehero-flatpickr")},...t};try{const e=flatpickr(n,o);return n.id&&(window.flatpickrInstances[n.id]=e),e}catch(e){return null}}function initializeBulkSchedulingPicker(){const e=document.getElementById("bulk-scheduled-date");if(!e)return null;e.placeholder="Select date and time";const t={altFormat:"F j, Y at h:i K",static:!0,onReady:function(e,t,n){setTimeout((()=>{const e=new Date;n.setDate(e)}),100)},onChange:function(t,n,o){const s=t[0];if(s){const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate());if(new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()===n.getTime()){if(s<=t){const e=new Date;return e.setSeconds(0,0),void o.setDate(e)}const e=String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0");o.set("minTime",e)}else o.set("minTime","00:00");e.value=s.toISOString().slice(0,16),e.dispatchEvent(new Event("change",{bubbles:!0}))}}};return initializeFlatpickr(e,t)}function getFlatpickrValue(e){return e&&e.selectedDates.length?e.selectedDates[0].toISOString():null}function setFlatpickrValue(e,t){e&&e.setDate(t)}function destroyFlatpickr(e){e&&"function"==typeof e.destroy&&e.destroy()}function validateField(e,t){const n=e.value,o=[];if(!n&&!t.includes("required"))return{valid:!0,errors:[]};for(const e of t){let t,s=[];if("string"==typeof e)t=validators[e];else if("object"==typeof e){const n=Object.keys(e)[0];s=Array.isArray(e[n])?e[n]:[e[n]],t=validators[n](...s)}else"function"==typeof e&&(t=e);if(t){const e=t(n);e.valid||o.push(e.message)}}return{valid:0===o.length,errors:o}}function validateForm(e,t){const n={};let o=!0;for(const s in t){const i=e.querySelector(`[name="${s}"]`);if(i){const e=validateField(i,t[s]);n[s]=e,e.valid?clearFieldError(i):(o=!1,showFieldError(i,e.errors[0]))}}return{valid:o,results:n}}function showFieldError(e,t){clearFieldError(e),e.classList.add("error");const n=document.createElement("div");n.className="field-error",n.textContent=t,e.parentNode.insertBefore(n,e.nextSibling),document.querySelector(".field-error")||e.focus()}function clearFieldError(e){e.classList.remove("error");const t=e.parentNode.querySelector(".field-error");t&&t.remove()}function initializeRealTimeValidation(e,t){for(const n in t){const o=e.querySelector(`[name="${n}"]`);o&&(o.addEventListener("blur",(()=>{const e=validateField(o,t[n]);e.valid?clearFieldError(o):showFieldError(o,e.errors[0])})),o.addEventListener("input",(()=>{o.classList.contains("error")&&clearFieldError(o)})))}}function initializeAdvancedEventHandlers(){const e=document.getElementById("bulk-apply-all"),t=document.querySelector(".bulk-drawer");if(t){const n={"category-input":["minLength:1","maxLength:50"],"price-adjustment":["number"],"fixed-price":["positiveNumber"],"sale-discount":["percentage"],"stock-amount":["number"],"custom-cents":[{number:!0},{custom:e=>e>=0&&e<=99,message:"Cents must be between 0 and 99"}]};initializeRealTimeValidation(t,n),e&&e.addEventListener("click",(e=>{validateForm(t,n).valid||(e.preventDefault(),showBulkNotification("Please fix validation errors before applying changes","error"))}))}document.querySelectorAll('input[type="number"]').forEach((e=>{e.addEventListener("input",(t=>{t.target.value=t.target.value.replace(/[^-+\d.]/g,"");const n=parseFloat(e.getAttribute("step")||"1");if(n<1){const e=n.toString().split(".")[1]?.length||0,o=parseFloat(t.target.value);isNaN(o)||(t.target.value=o.toFixed(e))}}))})),document.querySelectorAll("[data-auto-save]").forEach((e=>{const t=`draft_${e.name||e.id}`,n=localStorage.getItem(t);n&&!e.value&&(e.value=n),e.addEventListener("input",debounce((e=>{localStorage.setItem(t,e.target.value)}),500));const o=e.closest("form");o&&o.addEventListener("submit",(()=>{localStorage.removeItem(t)}))})),document.querySelectorAll(".bulk-drawer input, .bulk-drawer select").forEach((e=>{e.addEventListener("input",(()=>{hasUnsavedChanges=!0}))})),window.addEventListener("beforeunload",(e=>{hasUnsavedChanges&&(e.preventDefault(),e.returnValue="")})),e&&e.addEventListener("click",(()=>{hasUnsavedChanges=!1})),document.querySelectorAll(".editable-cell").forEach((e=>{e.addEventListener("dblclick",(()=>{makeInlineEditable(e)}))})),document.querySelectorAll(".product-table").forEach((e=>{e.addEventListener("keydown",(t=>{const n=document.activeElement;if(!n.closest(".product-table"))return;const o=Array.from(e.querySelectorAll("tr")),s=Array.from(e.querySelectorAll("td, th")),i=s.indexOf(n);if(-1===i)return;let a=i;switch(t.key){case"ArrowRight":a=Math.min(i+1,s.length-1);break;case"ArrowLeft":a=Math.max(i-1,0);break;case"ArrowDown":const e=n.closest("tr"),t=o.indexOf(e),r=o[t+1];if(r){const t=Array.from(e.cells).indexOf(n),o=r.cells[t];o&&(a=s.indexOf(o))}break;case"ArrowUp":const c=n.closest("tr"),l=o.indexOf(c),d=o[l-1];if(d){const e=Array.from(c.cells).indexOf(n),t=d.cells[e];t&&(a=s.indexOf(t))}}a!==i&&(t.preventDefault(),s[a].focus())}))}))}function makeInlineEditable(e){const t=e.textContent.trim();let n;switch(e.getAttribute("data-field-type")||"text"){case"number":n=document.createElement("input"),n.type="number",n.value=t.replace(/[^\d.-]/g,"");break;case"select":n=document.createElement("select");const o=e.getAttribute("data-options");o&&o.split(",").forEach((e=>{const o=document.createElement("option");o.value=e.trim(),o.textContent=e.trim(),o.selected=e.trim()===t,n.appendChild(o)}));break;default:n=document.createElement("input"),n.type="text",n.value=t}n.className="inline-edit-input",n.style.width="100%",n.style.border="none",n.style.padding="4px",n.style.fontSize="inherit",n.style.fontFamily="inherit",e.innerHTML="",e.appendChild(n),n.focus(),n.select();const o=()=>{const o=n.value.trim();if(e.innerHTML=o||t,o!==t){e.classList.add("modified"),e.setAttribute("data-new-value",o);const n=new CustomEvent("cellChange",{detail:{cell:e,oldValue:t,newValue:o}});e.dispatchEvent(n)}};n.addEventListener("blur",o),n.addEventListener("keydown",(n=>{"Enter"===n.key?(n.preventDefault(),o()):"Escape"===n.key&&(n.preventDefault(),e.innerHTML=t)}))}function debounce(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),e(...o)}),t)}}function getProductDataById(e){return globalProductsData.find((t=>t.id===e))}function getProcessedProductData(e){const t=getProductDataById(e);return t?convertProductToTableRow(t):null}function formatCurrency(e,t=null){if(null==e||""===e)return"";const n=parseFloat(e);if(isNaN(n))return"";if(window.currencyManager)return window.currencyManager.formatCurrency(n,t);const o=t||window.getSystemCurrency?.();try{return o?new Intl.NumberFormat("en-US",{style:"currency",currency:o}).format(n):`$${n.toFixed(2)}`}catch(e){return`${o}$${n.toFixed(2)}`}}function formatDate(e){return e?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e)):""}function debounce(e,t,n){let o;return function(){const s=this,i=arguments,a=n&&!o;clearTimeout(o),o=setTimeout((function(){o=null,n||e.apply(s,i)}),t),a&&e.apply(s,i)}}function sanitizeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function generateUrlSlug(e){return e?e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""):""}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function deepClone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map((e=>deepClone(e)));if("object"==typeof e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=deepClone(e[n]));return t}}function initializeUtilityHelpers(){initializeModalSystem(),initializeTooltips(),initializeKeyboardShortcuts()}function initializeModalSystem(){document.addEventListener("click",(function(e){e.target.classList.contains("sh-modal-overlay")&&closeModal(e.target)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&closeAllModals()}))}function closeModal(e){e&&e.parentElement&&(e.classList.add("closing"),setTimeout((()=>{e.parentElement&&e.parentElement.removeChild(e)}),300))}function closeAllModals(){document.querySelectorAll(".sh-modal-overlay").forEach((e=>closeModal(e)))}function initializeTooltips(){document.querySelectorAll("[data-tooltip]").forEach((e=>{e.addEventListener("mouseenter",showTooltip),e.addEventListener("mouseleave",hideTooltip)}))}function showTooltip(e){const t=e.target,n=t.getAttribute("data-tooltip");if(!n)return;const o=document.createElement("div");o.className="sh-tooltip",o.textContent=n,document.body.appendChild(o);const s=t.getBoundingClientRect();o.style.left=s.left+s.width/2+"px",o.style.top=s.top-o.offsetHeight-8+"px",t._tooltip=o,setTimeout((()=>o.classList.add("visible")),10)}function hideTooltip(e){const t=e.target;t._tooltip&&(document.body.removeChild(t._tooltip),delete t._tooltip)}function initializeKeyboardShortcuts(){document.addEventListener("keydown",(function(e){if((e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),showMessage("Changes are automatically saved","info")),!e.ctrlKey&&!e.metaKey||"a"!==e.key||e.target.matches("input, textarea")||(e.preventDefault(),selectAllProducts()),"Delete"===e.key&&!e.target.matches("input, textarea")){const e=getSelectedProducts();e.length>0&&showConfirmation(`Are you sure you want to delete ${e.length} selected products?`,(()=>deleteSelectedProducts()))}"Escape"!==e.key||e.target.matches("input, textarea")||(deselectAllProducts(),closeAllModals())}))}function selectAllProducts(){const e=document.querySelectorAll(".product-checkbox"),t=document.getElementById("select-all-products");e.forEach((e=>{e.checked=!0,e.dispatchEvent(new Event("change"))})),t&&(t.checked=!0),showMessage(`Selected ${e.length} products`,"success")}function deselectAllProducts(){const e=document.querySelectorAll(".product-checkbox"),t=document.getElementById("select-all-products");e.forEach((e=>{e.checked=!1,e.dispatchEvent(new Event("change"))})),t&&(t.checked=!1),showMessage("Deselected all products","info")}function getSelectedProducts(){const e=document.querySelectorAll(".product-checkbox:checked");return Array.from(e).map((e=>e.closest("tr")?.getAttribute("data-product-id"))).filter(Boolean)}async function deleteSelectedProducts(){const e=getSelectedProducts();if(0===e.length)return void showMessage("No products selected for deletion","warning");const t=showLoadingMessage(`Deleting ${e.length} products...`);try{const n=5;let o=0;for(let s=0;s<e.length;s+=n){const i=e.slice(s,s+n);await Promise.all(i.map((e=>deleteProduct(e)))),o+=i.length,updateProgressNotification(t,`Deleting products... ${o}/${e.length}`,o/e.length*100)}hideLoadingMessage(t),showMessage(`Successfully deleted ${e.length} products`,"success"),"function"==typeof loadProducts&&await loadProducts()}catch(e){hideLoadingMessage(t),showMessage("Error deleting products. Please try again.","error")}}async function deleteProduct(){return await new Promise((e=>setTimeout(e,100))),!0}function updateNotificationPositioning(){document.querySelectorAll(".sh-notification").forEach(((e,t)=>{e.style.top=20+60*t+"px"}))}function parseCurrency(e){if("number"==typeof e)return e;if("string"!=typeof e)return 0;const t=e.replace(/[$,\s]/g,"");return parseFloat(t)||0}function throttle(e,t){let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout((()=>n=!1),t))}}function generateId(){return"sh-"+Math.random().toString(36).substr(2,9)}async function copyToClipboard(e){try{await navigator.clipboard.writeText(e),showMessage("Copied to clipboard","success")}catch(e){showMessage("Failed to copy to clipboard","error")}}function downloadJSON(e,t){const n=JSON.stringify(e,null,2),o=new Blob([n],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)}function downloadCSV(e,t){if(!Array.isArray(e)||0===e.length)return void showMessage("No data to export","warning");const n=Object.keys(e[0]),o=[n.join(","),...e.map((e=>n.map((t=>`"${String(e[t]||"").replace(/"/g,'""')}"`)).join(",")))].join("\n"),s=new Blob([o],{type:"text/csv"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}function isValidURL(e){try{return new URL(e),!0}catch{return!1}}function getFileExtension(e){return e.split(".").pop().toLowerCase()}function isImageFile(e){return["jpg","jpeg","png","gif","webp","svg"].includes(getFileExtension(e))}async function initializeProductManager(){try{initializeEventHandlers(),initializeTableControls(),initializeBulkEditor(),initializeSearchAndFiltering(),initializePresetSystem(),initializeUrlManagement(),initializeFileUpload(),initializeUndoSystem(),initializeFormValidation(),await loadProductsData(),initializeCustomDropdowns(),initializeNotificationSystem(),setupPeriodicChecks()}catch(e){showMessage("Failed to initialize Product Manager. Please refresh the page.","error")}}function initializeEventHandlers(){const e=document.querySelector(".support-btn");e&&e.addEventListener("click",(()=>{window.open("https://www.squarehero.store/products/squarehero-support","_blank")}));const t=document.querySelector(".action-buttons .btn:nth-child(1)"),n=document.querySelector(".action-buttons .btn:nth-child(2)");t&&t.textContent.includes("Export")&&t.addEventListener("click",exportProducts),n&&n.textContent.includes("Import")&&n.addEventListener("click",importProducts);const o=document.getElementById("undo-changes-btn");o&&o.addEventListener("click",openUndoDrawer)}function initializeTableControls(){const e=document.getElementById("select-all-checkbox");e&&e.addEventListener("change",(function(){const e=this.checked;document.querySelectorAll(".product-checkbox").forEach((t=>{t.checked=e})),updateBulkAdjustButton()}));const t=document.getElementById("items-per-page");t&&t.addEventListener("change",(function(){})),document.addEventListener("change",(e=>{"checkbox"===e.target.type&&e.target.closest(".mix")&&updateBulkAdjustButton()}))}function initializeBulkEditor(){const e=document.querySelector(".bulk-adjust"),t=(document.getElementById("bulk-adjust-drawer"),document.getElementById("bulk-drawer-close")),n=document.getElementById("bulk-apply-all");e&&e.addEventListener("click",openBulkDrawer),t&&t.addEventListener("click",closeBulkDrawer),n&&n.addEventListener("click",applyBulkChanges),initializeBulkTabs(),initializeNewBulkControls()}function initializeBulkTabs(){const e=document.querySelectorAll(".bulk-tab"),t=document.querySelectorAll(".tab-pane");e.forEach((n=>{n.addEventListener("click",(()=>{const o=n.getAttribute("data-tab");e.forEach((e=>e.classList.remove("active"))),t.forEach((e=>e.classList.remove("active"))),n.classList.add("active");const s=document.getElementById(`${o}-tab`);s&&s.classList.add("active")}))}))}function initializeNewBulkControls(){initializePricingControls(),initializeVisibilityControls(),initializeInventoryControls(),initializePresetControls()}function initializePricingControls(){const e=document.getElementById("bulk-adjust-regular-prices"),t=document.getElementById("bulk-regular-price-options");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}));const n=document.getElementById("bulk-adjust-sale-prices"),o=document.getElementById("bulk-sale-price-options");n&&n.addEventListener("change",(function(){o&&(o.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}));const s=document.getElementById("bulk-round-prices"),i=document.getElementById("bulk-rounding-options");s&&s.addEventListener("change",(function(){i&&(i.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()})),initializeCustomSlider(),initializePricingDropdowns()}function initializeVisibilityControls(){const e=document.getElementById("bulk-product-status-toggle"),t=document.getElementById("bulk-product-status-options");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}));const n=document.getElementById("bulk-categories-toggle"),o=document.getElementById("bulk-categories-options");n&&n.addEventListener("change",(function(){o&&(o.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}));const s=document.getElementById("bulk-tags-toggle"),i=document.getElementById("bulk-tags-options");s&&s.addEventListener("change",(function(){i&&(i.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}))}function initializeInventoryControls(){const e=document.getElementById("bulk-stock-toggle"),t=document.getElementById("bulk-stock-options");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}));const n=document.getElementById("bulk-sku-toggle"),o=document.getElementById("bulk-sku-options");n&&n.addEventListener("change",(function(){o&&(o.style.display=this.checked?"block":"none"),updateApplyAllButton(),updatePreviewPane()}))}function initializePresetControls(){const e=document.getElementById("load-preset"),t=document.getElementById("save-current-preset"),n=document.getElementById("save-as-new-preset"),o=document.getElementById("delete-preset");e&&e.addEventListener("click",loadSelectedPreset),t&&t.addEventListener("click",saveCurrentPreset),n&&n.addEventListener("click",showSaveAsNewForm),o&&o.addEventListener("click",deleteSelectedPreset)}function initializeCustomSlider(){const e=document.querySelector(".price-slider-container");if(!e)return;const t=e.querySelector(".price-slider-track"),n=e.querySelector(".price-slider-handle"),o=e.querySelector(".price-slider-cover"),s=document.getElementById("bulk-regular-adjustment");if(!(t&&n&&o&&s))return;let i,a=!1;const r=()=>{const e=parseFloat(s.value)||0,t=Math.max(0,Math.min(100,(e- -50)/100*100));n.style.left=`${t}%`,o.style.width=`${t}%`},c=e=>{s.value=Math.round(e/100*100-50),s.dispatchEvent(new Event("input",{bubbles:!0}))};n.addEventListener("mousedown",(e=>{a=!0,i=t.getBoundingClientRect(),document.addEventListener("mousemove",l),document.addEventListener("mouseup",d),e.preventDefault()}));const l=e=>{if(!a||!i)return;const t=Math.max(0,Math.min(100,(e.clientX-i.left)/i.width*100));n.style.left=`${t}%`,o.style.width=`${t}%`,c(t)},d=()=>{a=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",d)};t.addEventListener("click",(e=>{if(e.target===n)return;const s=t.getBoundingClientRect(),i=Math.max(0,Math.min(100,(e.clientX-s.left)/s.width*100));n.style.left=`${i}%`,o.style.width=`${i}%`,c(i)})),s.addEventListener("input",r),r()}function initializePricingDropdowns(){const e=document.getElementById("price-method-trigger"),t=document.getElementById("price-method-dropdown"),n=document.getElementById("price-method-text"),o=document.getElementById("bulk-regular-adjustment-type"),s=document.getElementById("price-unit");if(!(e&&t&&n&&o&&s))return;e.addEventListener("click",(()=>{t.classList.toggle("active")}));const i=t.querySelectorAll(".select-option");i.forEach((e=>{e.addEventListener("click",(()=>{const a=e.dataset.value;switch(n.textContent=e.textContent,o.value=a,a){case"percentage":s.textContent="%";break;case"fixed-adjustment":case"fixed-price":s.textContent="$"}i.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),t.classList.remove("active"),o.dispatchEvent(new Event("change",{bubbles:!0})),updateApplyAllButton(),updatePreviewPane()}))})),document.addEventListener("click",(n=>{e.contains(n.target)||t.contains(n.target)||t.classList.remove("active")}))}function initializeCustomDropdowns(){const e=document.querySelectorAll(".bulk-select, .custom-dropdown");e.forEach((t=>{const n=t.querySelector(".select-trigger, .dropdown-trigger"),o=t.querySelector(".select-dropdown, .dropdown-menu"),s=t.querySelector('select[style*="none"]');if(!n||!o)return;n.addEventListener("click",(()=>{e.forEach((e=>{if(e!==t){const t=e.querySelector(".select-dropdown, .dropdown-menu");t&&t.classList.remove("active")}})),o.classList.toggle("active")}));const i=o.querySelectorAll(".select-option, .dropdown-option");i.forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.value||e.textContent,a=e.textContent,r=n.querySelector(".select-text, .dropdown-text");r&&(r.textContent=a),s&&(s.value=t,s.dispatchEvent(new Event("change",{bubbles:!0}))),i.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),o.classList.remove("active")}))}))})),document.addEventListener("click",(t=>{e.forEach((e=>{const n=e.querySelector(".select-trigger, .dropdown-trigger"),o=e.querySelector(".select-dropdown, .dropdown-menu");n&&o&&!e.contains(t.target)&&o.classList.remove("active")}))}))}function setupPeriodicChecks(){}function initializeApplication(){initializeProductManager()}function formatCurrency(e){return`$${parseFloat(e).toFixed(2)}`}function makePriceFieldEditable(e,t,n,o){const s=document.createElement("input");s.type="number",s.step="0.01",s.min="0";const i=o.replace(/[^0-9.]/g,"");s.value=i,s.className="inline-edit-input price-input",s.style.width="100%",s.style.border="1px solid #ddd",s.style.padding="4px",s.style.borderRadius="3px",s.style.fontSize="inherit",s.style.fontFamily="inherit",e.innerHTML="",e.appendChild(s),s.focus(),s.select();const a=()=>{const i=s.value.trim(),a=parseFloat(i);if(!isNaN(a)&&a>=0){const s=formatCurrency(a);s!==o?(e.textContent=s,e.setAttribute("data-new-value",a.toString()),e.setAttribute("data-field-type",n),e.classList.add("modified"),trackChanges(e,t)):e.textContent=o}else e.textContent=o;currentEditingCell=null};s.addEventListener("keydown",(t=>{"Enter"===t.key?(t.preventDefault(),a()):"Escape"===t.key&&(t.preventDefault(),e.textContent=o,currentEditingCell=null)})),s.addEventListener("blur",a)}function makeStockFieldEditable(e,t,n,o,s){const i=o.toLowerCase().includes("unlimited"),a=document.createElement("div");a.className="stock-editor",a.style.display="flex",a.style.alignItems="center",a.style.gap="5px";const r=document.createElement("input");r.type="number",r.min="0",r.step="1",r.style.width="60px",r.style.border="1px solid #ddd",r.style.padding="3px",r.style.borderRadius="3px",r.style.fontSize="inherit",r.disabled=i;const c=document.createElement("input");c.type="checkbox",c.checked=i,c.id=`unlimited-${s}`;const l=document.createElement("label");if(l.htmlFor=`unlimited-${s}`,l.textContent="Unlimited",l.style.fontSize="12px",l.style.cursor="pointer",!i){const e=parseInt(o.replace(/[^0-9]/g,""))||0;r.value=e}c.addEventListener("change",(()=>{r.disabled=c.checked,c.checked&&(r.value="")})),a.appendChild(r),a.appendChild(c),a.appendChild(l),e.innerHTML="",e.appendChild(a),i||(r.focus(),r.select());const d=()=>{let s,i;if(c.checked)s="unlimited",i="Unlimited";else{const e=parseInt(r.value)||0;s=e.toString(),i=e.toString()}i!==o?(e.textContent=i,e.setAttribute("data-new-value",s),e.setAttribute("data-field-type",n),e.classList.add("modified"),trackChanges(e,t)):e.textContent=o,currentEditingCell=null};r.addEventListener("keydown",(t=>{"Enter"===t.key?(t.preventDefault(),d()):"Escape"===t.key&&(t.preventDefault(),e.textContent=o,currentEditingCell=null)})),r.addEventListener("blur",d)}function makeToggleFieldEditable(e,t,n,o){const s="yes"===o.toLowerCase(),i=document.createElement("div");i.className="toggle-container",i.style.display="flex",i.style.alignItems="center",i.style.gap="5px";const a=document.createElement("input");a.type="checkbox",a.checked=s,a.className="sale-toggle";const r=document.createElement("span");r.textContent=s?"Yes":"No",r.style.fontSize="12px",a.addEventListener("change",(()=>{const o=a.checked,s=o?"Yes":"No";r.textContent=s,e.innerHTML=s,e.setAttribute("data-new-value",o.toString()),e.setAttribute("data-field-type",n),e.classList.add("modified"),trackChanges(e,t),currentEditingCell=null})),i.appendChild(a),i.appendChild(r),e.innerHTML="",e.appendChild(i)}function makeSelectFieldEditable(e,t,n,o){const s=document.createElement("select");s.className="inline-edit-select",["Public","Hidden","Scheduled"].forEach((e=>{const t=document.createElement("option");t.value=e.toLowerCase(),t.textContent=e,t.selected=e.toLowerCase()===o.toLowerCase(),s.appendChild(t)})),s.style.width="100%",s.style.border="1px solid #ddd",s.style.padding="4px",s.style.borderRadius="3px",s.style.fontSize="inherit",s.style.fontFamily="inherit",e.innerHTML="",e.appendChild(s),s.focus();const i=()=>{const i=s.options[s.selectedIndex].textContent;i!==o?(e.textContent=i,e.setAttribute("data-new-value",s.value),e.setAttribute("data-field-type",n),e.classList.add("modified"),trackChanges(e,t)):e.textContent=o,currentEditingCell=null};s.addEventListener("change",i),s.addEventListener("blur",i),s.addEventListener("keydown",(t=>{"Escape"===t.key&&(t.preventDefault(),e.textContent=o,currentEditingCell=null)}))}function generateSlug(e){return e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}function generateUniqueUrlSlug(e){let t=generateSlug(e);return t||(t="product"),t}function shouldSuggestURL(e,t,n){if(!e||!t||e===t)return!1;const o=generateSlug(t);return o.length>0&&o!==n}function showURLSuggestion(e,t,n){function o(){l&&d&&l.checked&&p&&p!==e?(d.textContent=`${p} -> ${e} 301`,d.classList.add("visible")):d&&d.classList.remove("visible")}const s=document.getElementById("url-suggestion-tooltip"),i=document.getElementById("url-suggestion-preview"),a=document.getElementById("url-suggestion-apply"),r=document.getElementById("url-suggestion-cancel"),c=document.getElementById("url-suggestion-close"),l=document.getElementById("url-create-redirect"),d=document.getElementById("url-redirect-preview");if(!(s&&i&&a&&r&&c))return;const u=n.querySelector("td:nth-child(3)"),p=u?u.textContent.trim():"";i.textContent=e,o(),l&&l.addEventListener("change",o);const g=t.getBoundingClientRect(),h=window.pageYOffset||document.documentElement.scrollTop,m=window.pageXOffset||document.documentElement.scrollLeft;s.style.position="absolute",s.style.top=g.bottom+h+10+"px",s.style.left=g.left+m+"px",s.style.zIndex="10000",s.classList.remove("hidden"),s.classList.add("visible"),s.setAttribute("data-target-row-id",n.getAttribute("data-product-id"));const y=function(){const t=n.querySelector("td:nth-child(3)");if(t&&!t.classList.contains("modified")){const n=t.textContent.trim();t.textContent=e,t.setAttribute("data-new-value",e),t.setAttribute("data-field-type","url"),t.classList.add("modified"),l&&l.checked&&n&&n!==e&&"undefined"!=typeof urlRedirects&&urlRedirects.set&&urlRedirects.set(n,e)}hideURLSuggestion()},f=function(){hideURLSuggestion()};a.removeEventListener("click",y),r.removeEventListener("click",f),c.removeEventListener("click",f),a.addEventListener("click",y),r.addEventListener("click",f),c.addEventListener("click",f),setTimeout((()=>{s.classList.contains("visible")&&hideURLSuggestion()}),1e4)}function hideURLSuggestion(){const e=document.getElementById("url-suggestion-tooltip");e&&(e.classList.remove("visible"),e.classList.add("hidden"))}function showFooterNotification(e,t="info",n=2e3){const o=document.getElementById("changes-footer"),s=document.querySelector(".changes-notification-content"),i=document.getElementById("notification-text"),a=document.querySelector(".changes-info");o&&s&&i&&(a&&(a.style.display="none"),i.textContent=e,s.style.display="flex",o.classList.remove("hidden"),o.classList.add("visible"),n>0&&setTimeout((()=>{s&&(s.style.display="none"),o.classList.remove("visible"),o.classList.add("hidden")}),n))}function exportProducts(){const e=getSelectedProductsWithData();0!==e.count?showMessage(`Exported ${e.count} products`,"success"):showMessage("Please select products to export","warning")}function importProducts(){showMessage("Import functionality coming soon","info")}function openBulkDrawer(){const e=document.getElementById("bulk-adjust-drawer");e&&(e.classList.add("active"),document.body.classList.add("drawer-open"),"function"==typeof resetBulkChanges&&resetBulkChanges())}function closeBulkDrawer(){const e=document.getElementById("bulk-adjust-drawer");e&&(e.classList.remove("active"),document.body.classList.remove("drawer-open"))}function openUndoDrawer(){const e=document.getElementById("undo-changes-drawer");if(!e)return;const t=document.getElementById("undo-history-count");t&&(t.textContent=0===undoHistory.length?"No changes to undo":`${undoHistory.length} change${1===undoHistory.length?"":"s"} available`),selectedUndoIndex=null;const n=document.getElementById("undo-restore");n&&(n.disabled=!0),"function"==typeof populateUndoHistoryList&&populateUndoHistoryList(),e.classList.add("visible"),document.body.style.overflow="hidden"}function initializeInteractiveUtilities(){document.addEventListener("click",(e=>{if(currentEditingCell&&!currentEditingCell.contains(e.target)){const e=currentEditingCell.querySelector("input, select");e&&e.blur()}document.querySelectorAll(".select-dropdown.active, .dropdown-menu.active").forEach((t=>{t.closest(".bulk-select, .custom-dropdown").contains(e.target)||t.classList.remove("active")}))})),document.addEventListener("keydown",(e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),"function"==typeof saveAllChanges&&hasUnsavedChanges&&saveAllChanges()),"Escape"===e.key&&document.querySelector(".bulk-adjust-drawer.active")&&closeBulkDrawer()}))}function initializeCustomDropdowns(){const e=document.querySelectorAll(".custom-dropdown");e.forEach((t=>{const n=t.querySelector(".dropdown-header"),o=t.querySelector(".dropdown-content"),s=t.querySelector('input[type="text"]');n&&o&&n.addEventListener("click",(n=>{n.stopPropagation(),e.forEach((e=>{e!==t&&(e.querySelector(".dropdown-content").style.display="none",e.classList.remove("active"))}));const s="block"===o.style.display;o.style.display=s?"none":"block",t.classList.toggle("active",!s)})),s&&s.addEventListener("focus",(()=>{o.style.display="block",t.classList.add("active")}))})),document.addEventListener("click",(t=>{t.target.closest(".custom-dropdown")||e.forEach((e=>{e.querySelector(".dropdown-content").style.display="none",e.classList.remove("active")}))}))}function initializeCustomSliders(){document.querySelectorAll(".custom-slider").forEach((e=>{const t=e.querySelector('input[type="range"]'),n=e.querySelector(".slider-value"),o=e.querySelector(".slider-min"),s=e.querySelector(".slider-max");if(t){const o=()=>{n&&(n.textContent=(e.dataset.prefix||"")+t.value+(e.dataset.suffix||""));const o=(t.value-t.min)/(t.max-t.min)*100;t.style.background=`linear-gradient(to right, var(--brand-color) 0%, var(--brand-color) ${o}%, #ddd ${o}%, #ddd 100%)`};t.addEventListener("input",o),t.addEventListener("change",o),o()}o&&t&&(o.textContent=t.min),s&&t&&(s.textContent=t.max)}))}function initializeToggleSwitches(){document.querySelectorAll(".toggle-switch").forEach((e=>{const t=e.querySelector('input[type="checkbox"]'),n=e.querySelector(".toggle-slider");t&&n&&(t.addEventListener("change",(()=>{e.classList.toggle("checked",t.checked),n.style.transform=t.checked?"translateX(20px)":"translateX(0)";const o=new CustomEvent("toggleChange",{detail:{checked:t.checked,toggle:e}});e.dispatchEvent(o)})),e.classList.toggle("checked",t.checked),n.style.transform=t.checked?"translateX(20px)":"translateX(0)")}))}function initializeTabNavigation(){document.querySelectorAll(".tab-container").forEach((e=>{const t=e.querySelectorAll(".tab-button"),n=e.querySelectorAll(".tab-content");t.forEach(((o,s)=>{o.addEventListener("click",(i=>{i.preventDefault(),t.forEach((e=>e.classList.remove("active"))),n.forEach((e=>e.classList.remove("active"))),o.classList.add("active"),n[s]&&n[s].classList.add("active");const a=new CustomEvent("tabChange",{detail:{tab:o,content:n[s],index:s}});e.dispatchEvent(a)}))}))}))}function initializeCollapsibleSections(){document.querySelectorAll(".collapsible").forEach((e=>{const t=e.querySelector(".collapsible-header"),n=e.querySelector(".collapsible-content"),o=t.querySelector(".collapse-icon");t&&n&&t.addEventListener("click",(()=>{const t=e.classList.contains("expanded");e.classList.toggle("expanded"),t?(n.style.maxHeight="0",o&&(o.style.transform="rotate(0deg)")):(n.style.maxHeight=n.scrollHeight+"px",o&&(o.style.transform="rotate(180deg)"));const s=new CustomEvent("sectionToggle",{detail:{expanded:!t,section:e}});e.dispatchEvent(s)}))}))}function initializeProgressBars(){document.querySelectorAll(".progress-bar").forEach((e=>{const t=e.querySelector(".progress-fill"),n=e.querySelector(".progress-text");t&&(e.updateProgress=(e,o=!0)=>{e=Math.max(0,Math.min(100,e)),t.style.transition=o?"width 0.3s ease-in-out":"none",t.style.width=e+"%",n&&(n.textContent=Math.round(e)+"%"),t.style.backgroundColor=e<30?"#e74c3c":e<70?"#f39c12":"#27ae60"},e.updateProgress(0,!1))}))}function initializeTooltips(){document.querySelectorAll("[data-tooltip]").forEach((e=>{const t=e.getAttribute("data-tooltip"),n=e.getAttribute("data-tooltip-position")||"top";let o=null;e.addEventListener("mouseenter",(()=>{o=document.createElement("div"),o.className=`tooltip tooltip-${n}`,o.textContent=t,document.body.appendChild(o);const s=e.getBoundingClientRect(),i=o.getBoundingClientRect();let a,r=s.left+s.width/2-i.width/2;switch(n){case"top":a=s.top-i.height-10;break;case"bottom":a=s.bottom+10;break;case"left":r=s.left-i.width-10,a=s.top+s.height/2-i.height/2;break;case"right":r=s.right+10,a=s.top+s.height/2-i.height/2}r=Math.max(10,Math.min(r,window.innerWidth-i.width-10)),a=Math.max(10,Math.min(a,window.innerHeight-i.height-10)),o.style.left=r+"px",o.style.top=a+"px",setTimeout((()=>o.classList.add("visible")),10)})),e.addEventListener("mouseleave",(()=>{o&&(o.classList.remove("visible"),setTimeout((()=>{o&&o.parentNode&&o.parentNode.removeChild(o)}),200))}))}))}function initializeContextMenus(){document.querySelectorAll(".context-menu-trigger").forEach((e=>{e.addEventListener("contextmenu",(t=>{t.preventDefault();const n=e.getAttribute("data-context-menu"),o=document.getElementById(n);if(o){document.querySelectorAll(".context-menu").forEach((e=>{e!==o&&e.classList.remove("visible")})),o.style.left=t.pageX+"px",o.style.top=t.pageY+"px",o.classList.add("visible");const e=o.querySelector(".context-menu-item");e&&e.focus()}}))})),document.addEventListener("click",(e=>{e.target.closest(".context-menu")||document.querySelectorAll(".context-menu").forEach((e=>{e.classList.remove("visible")}))}))}function initializeKeyboardShortcuts(){const e={"ctrl+a":selectAllProducts,"ctrl+d":clearAllCheckboxes,escape:hideBulkAdjustDrawer,"ctrl+z":()=>{"function"==typeof restoreFromUndo&&restoreFromUndo()},"ctrl+s":e=>{e.preventDefault();const t=document.getElementById("bulk-apply-all");t&&!t.disabled&&t.click()}};document.addEventListener("keydown",(t=>{const n=(t.ctrlKey?"ctrl+":"")+(t.shiftKey?"shift+":"")+(t.altKey?"alt+":"")+t.key.toLowerCase();e[n]&&(t.preventDefault(),e[n](t))}))}function initializeModals(){const e=document.querySelectorAll("[data-modal]"),t=document.querySelectorAll(".modal");e.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const n=e.getAttribute("data-modal"),o=document.getElementById(n);if(o){o.classList.add("active"),document.body.classList.add("modal-open");const e=o.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');e&&e.focus()}}))})),t.forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&closeModal(e)}));const t=e.querySelector(".modal-close");t&&t.addEventListener("click",(()=>closeModal(e)))})),document.addEventListener("keydown",(e=>{if("Escape"===e.key){const e=document.querySelector(".modal.active");e&&closeModal(e)}}))}function closeModal(e){e.classList.remove("active"),document.body.classList.remove("modal-open")}function initializeCustomUI(){initializeCustomDropdowns(),initializeCustomSliders(),initializeToggleSwitches(),initializeTabNavigation(),initializeCollapsibleSections(),initializeProgressBars(),initializeTooltips(),initializeContextMenus(),initializeKeyboardShortcuts(),initializeModals()}function initializeUI(){initializeHeader(),initializeFilters(),initializePagination(),initializeTooltips()}function initializeHeader(){const e=document.querySelector(".support-btn");e&&e.addEventListener("click",(function(){window.open("https://squarehero.store/support","_blank")}));const t=document.querySelector(".btn:first-child");t&&t.textContent.includes("Export")&&t.addEventListener("click",handleExport);const n=document.querySelector(".btn:nth-child(2)");n&&n.textContent.includes("Import")&&n.addEventListener("click",handleImport);const o=document.getElementById("undo-changes-btn");o&&o.addEventListener("click",(function(){"function"==typeof showUndoDrawer&&showUndoDrawer()}))}function initializeFilters(){const e=document.getElementById("search-input");e&&e.addEventListener("input",debounce(handleSearch,300));const t=document.getElementById("category-filter");t&&(t.addEventListener("change",handleCategoryFilter),populateCategoryFilter());const n=document.getElementById("status-filter");n&&n.addEventListener("change",handleStatusFilter);const o=document.querySelector(".bulk-adjust");o&&o.addEventListener("click",(function(){"function"==typeof showBulkAdjustDrawer&&showBulkAdjustDrawer()}))}function initializePagination(){const e=document.getElementById("items-per-page");e&&e.addEventListener("change",(function(){"function"==typeof updateProductsPerPage&&updateProductsPerPage(parseInt(this.value))}))}function initializeTooltips(){const e=document.getElementById("url-suggestion-apply"),t=document.getElementById("url-suggestion-cancel");e&&e.addEventListener("click",handleUrlSuggestionApply),t&&t.addEventListener("click",hideUrlSuggestionTooltip)}function handleExport(){}function handleImport(){}function handleSearch(){}function handleCategoryFilter(){}function handleStatusFilter(){}function populateCategoryFilter(e=null){const t=document.getElementById("category-filter"),n=document.getElementById("category-filter-dropdown");if(!t)return;let o=[];if(e&&e.size>0)o=Array.from(e).sort();else if(globalProductsData){const e=new Set;globalProductsData.forEach((t=>{t.categories&&t.categories.forEach((t=>e.add(t)))})),o=Array.from(e).sort()}for(;t.children.length>1;)t.removeChild(t.lastChild);o.forEach((e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})),n&&(n.querySelectorAll('.select-option:not([data-value="all"])').forEach((e=>e.remove())),o.forEach((e=>{const t=document.createElement("div");t.className="select-option",t.setAttribute("data-value",e),t.textContent=e,n.appendChild(t)})))}function hideUrlSuggestionTooltip(){const e=document.getElementById("url-suggestion-tooltip");e&&e.classList.add("hidden")}function handleUrlSuggestionApply(){hideUrlSuggestionTooltip()}function initializeAdvancedBulkEditor(){initializeCategoryBulkEdit(),initializeTagBulkEdit(),initializeSKUBulkEdit(),initializeAdvancedStockEdit(),initializeVisibilityControls(),initializeSalePriceControls(),initializeCustomSliders()}function initializeCategoryBulkEdit(){const e=document.getElementById("bulk-categories-toggle"),t=document.getElementById("bulk-categories-options"),n=document.getElementById("bulk-category-action"),o=document.getElementById("bulk-category-picker");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateBulkChanges()})),n&&n.addEventListener("change",(function(){o&&(o.style.display="none"!==this.value?"block":"none"),updateBulkChanges()})),initializeCategoryPicker()}function initializeCategoryPicker(){const e=document.getElementById("bulk-category-select");e&&(populateCategoryPicker(),e.addEventListener("change",updateBulkChanges))}function populateCategoryPicker(){const e=document.getElementById("bulk-category-select");if(!e||!globalProductsData)return;const t=new Set;globalProductsData.forEach((e=>{e.categories&&Array.isArray(e.categories)&&e.categories.forEach((e=>{e&&e.trim()&&t.add(e.trim())}))})),e.innerHTML='<option value="">Select a category...</option>',Array.from(t).sort().forEach((t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}))}function initializeTagBulkEdit(){const e=document.getElementById("bulk-tags-toggle"),t=document.getElementById("bulk-tags-options"),n=document.getElementById("bulk-tag-action"),o=document.getElementById("bulk-tag-input-group"),s=document.getElementById("bulk-tag-input");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateBulkChanges()})),n&&n.addEventListener("change",(function(){o&&(o.style.display="none"!==this.value?"block":"none"),updateBulkChanges()})),s&&s.addEventListener("input",debounce(updateBulkChanges,300))}function initializeSKUBulkEdit(){const e=document.getElementById("bulk-sku-toggle"),t=document.getElementById("bulk-sku-options"),n=document.getElementById("bulk-sku-action"),o=document.getElementById("bulk-sku-value-group"),s=document.getElementById("bulk-sku-value-label"),i=document.getElementById("bulk-sku-value");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateBulkChanges()})),n&&n.addEventListener("change",(function(){const e=this.value,t="none"!==e;o&&(o.style.display=t?"block":"none"),s&&t&&(s.textContent="prefix"===e?"Prefix:":"Suffix:"),updateBulkChanges()})),i&&i.addEventListener("input",debounce(updateBulkChanges,300))}function initializeAdvancedStockEdit(){const e=document.getElementById("bulk-stock-toggle"),t=document.getElementById("bulk-stock-options"),n=document.getElementById("bulk-stock-action"),o=document.getElementById("bulk-stock-amount-group"),s=document.getElementById("bulk-stock-amount");e&&e.addEventListener("change",(function(){t&&(t.style.display=this.checked?"block":"none"),updateBulkChanges()})),n&&n.addEventListener("change",(function(){const e=["set","adjust"].includes(this.value);o&&(o.style.display=e?"block":"none"),updateBulkChanges()})),s&&s.addEventListener("input",debounce(updateBulkChanges,300))}function initializeVisibilityControls(){document.querySelectorAll('input[name="bulk-visibility"]').forEach((e=>{e.addEventListener("change",(function(){this.checked&&(bulkChanges.newStatus=this.value,updateBulkChanges())}))}))}function initializeSalePriceControls(){const e=document.getElementById("bulk-sale-price-method"),t=document.getElementById("bulk-sale-value-label"),n=document.getElementById("bulk-sale-value-unit"),o=document.getElementById("bulk-sale-price-value");e&&e.addEventListener("change",(function(){if(t&&n)switch(this.value){case"percentage":t.textContent="Percentage off:",n.textContent="%",o&&(o.step="1");break;case"fixed":t.textContent="Amount off:",n.textContent=window.getSystemCurrency()||"",o&&(o.step="0.01");break;case"setPrice":t.textContent="Sale price:",n.textContent=window.getSystemCurrency()||"",o&&(o.step="0.01");break;case"adjustExisting":t.textContent="Adjust by:",n.textContent="%",o&&(o.step="1")}updateBulkChanges()}));const s=document.querySelectorAll('input[name="bulk-sale-action"]'),i=document.getElementById("bulk-sale-pricing-controls");s.forEach((e=>{e.addEventListener("change",(function(){i&&(i.style.display="put-on-sale"===this.value&&this.checked?"block":"none"),updateBulkChanges()}))})),o&&o.addEventListener("input",debounce(updateBulkChanges,300))}function initializeCustomSliders(){const e=document.getElementById("bulk-price-slider"),t=document.getElementById("bulk-price-slider-value"),n=document.getElementById("bulk-regular-adjustment");e&&t&&n&&initializeCustomSlider(e,t,n)}function initializeCustomSlider(e,t,n){function o(e){const o=(e-d)/(u-d)*100;r.style.left=`${o}%`,c.style.width=`${o}%`,t&&(t.textContent=`${e}%`),n&&(n.value=e)}function s(e){e=Math.max(d,Math.min(u,e)),o(e=Math.round(e/p)*p),updateBulkChanges()}function i(e){const t=a.getBoundingClientRect(),n=Math.max(0,Math.min(1,((e.clientX||e.touches&&e.touches[0].clientX)-t.left)/t.width));return Math.round((d+n*(u-d))/p)*p}const a=e.querySelector(".slider-track"),r=e.querySelector(".slider-thumb"),c=e.querySelector(".slider-fill");if(!a||!r||!c)return;let l=!1,d=parseFloat(n.min)||-100,u=parseFloat(n.max)||100,p=parseFloat(n.step)||1;r.addEventListener("mousedown",(function(e){l=!0,e.preventDefault()})),a.addEventListener("click",(function(e){l||s(i(e))})),document.addEventListener("mousemove",(function(e){l&&s(i(e))})),document.addEventListener("mouseup",(function(){l=!1})),r.addEventListener("touchstart",(function(e){l=!0,e.preventDefault()})),a.addEventListener("touchstart",(function(e){s(i(e)),e.preventDefault()})),document.addEventListener("touchmove",(function(e){l&&(s(i(e)),e.preventDefault())})),document.addEventListener("touchend",(function(){l=!1})),n.addEventListener("input",(function(){o(parseFloat(this.value)||0)})),o(parseFloat(n.value)||0)}function updateBulkChanges(){const e=document.getElementById("bulk-categories-toggle"),t=document.getElementById("bulk-category-action"),n=document.getElementById("bulk-category-select");e?.checked&&"none"!==t?.value?(bulkChanges.categoryAction=t.value,bulkChanges.categoryValue=n?.value||""):(bulkChanges.categoryAction=null,bulkChanges.categoryValue=null);const o=document.getElementById("bulk-tags-toggle"),s=document.getElementById("bulk-tag-action"),i=document.getElementById("bulk-tag-input");o?.checked&&"none"!==s?.value?(bulkChanges.tagAction=s.value,bulkChanges.tagValue=i?.value||""):(bulkChanges.tagAction=null,bulkChanges.tagValue=null);const a=document.getElementById("bulk-sku-toggle"),r=document.getElementById("bulk-sku-action"),c=document.getElementById("bulk-sku-value");a?.checked&&"none"!==r?.value?(bulkChanges.skuAction=r.value,bulkChanges.skuValue=c?.value||""):(bulkChanges.skuAction=null,bulkChanges.skuValue=null);const l=document.getElementById("bulk-stock-toggle"),d=document.getElementById("bulk-stock-action"),u=document.getElementById("bulk-stock-amount");l?.checked&&(bulkChanges.enableStockTracking=!0,bulkChanges.stockAction=d?.value||"set",["set","adjust"].includes(d?.value)&&(bulkChanges.stockAmount=parseInt(u?.value)||0));const p=document.getElementById("bulk-sale-price-method"),g=document.getElementById("bulk-sale-price-value"),h=document.querySelectorAll('input[name="bulk-sale-action"]:checked');if(h.length>0){const e=h[0].value;bulkChanges.saleAction=e,"put-on-sale"===e&&p&&g&&(bulkChanges.salePriceMethod=p.value,bulkChanges.salePriceValue=parseFloat(g.value)||0)}"function"==typeof updateApplyAllButton&&updateApplyAllButton(),"function"==typeof updatePreviewPane&&updatePreviewPane()}function applyAdvancedBulkChangesToProduct(e,t){const n={...e};if(t.categoryAction&&t.categoryValue)switch(t.categoryAction){case"add":n.categories||(n.categories=[]),n.categories.includes(t.categoryValue)||n.categories.push(t.categoryValue);break;case"remove":n.categories&&(n.categories=n.categories.filter((e=>e!==t.categoryValue)));break;case"replace":n.categories=[t.categoryValue]}if(t.tagAction&&t.tagValue){const e=t.tagValue.split(",").map((e=>e.trim())).filter(Boolean);switch(t.tagAction){case"add":n.tags||(n.tags=[]),e.forEach((e=>{n.tags.includes(e)||n.tags.push(e)}));break;case"remove":n.tags&&(n.tags=n.tags.filter((t=>!e.includes(t))));break;case"replace":n.tags=e}}if(t.skuAction&&t.skuValue&&n.sku)switch(t.skuAction){case"prefix":n.sku=t.skuValue+n.sku;break;case"suffix":n.sku=n.sku+t.skuValue}if(t.enableStockTracking&&t.stockAction)switch(t.stockAction){case"set":n.stock=t.stockAmount||0,n.trackStock=!0;break;case"adjust":n.stock=(n.stock||0)+(t.stockAmount||0),n.trackStock=!0;break;case"unlimited":n.trackStock=!1,n.stock=null;break;case"none":n.trackStock=!1,n.stock=0}return n}async function applyBulkChanges(){function e(){const e=document.getElementById("bulk-notification-footer");e&&e.textContent.trim()}if(window.licenseManager&&"demo"===window.licenseManager.getLicenseStatus().status)return void("function"==typeof showBulkNotification?showBulkNotification("Apply changes is disabled in demo mode. Please activate your license to use this feature.","error",5e3):alert("Apply changes is disabled in demo mode. Please activate your license to use this feature."));e();const t=document.querySelector(".products-selected-info");t&&(t.style.display="none");const n={...bulkChanges},o=getSelectedProducts();if(e(),0===o.length)return void showBulkNotification("No products selected","error");if(o.forEach((e=>{const t=e.classList.contains("variant-row");e.getAttribute(t?"data-variant-id":"data-product-id"),t&&e.getAttribute("data-parent-product")})),!(Object.values(n).some((e=>null!==e&&!1!==e&&"no-change"!==e&&"unchanged"!==e))||n.newStatus&&"unchanged"!==n.newStatus))return void showBulkNotification("No changes to apply","error");const s=document.getElementById("bulk-apply-all");s&&(s.disabled=!0,s.textContent="Preparing..."),generateActionDescription(o.length),stopPreparationMessages(),s&&(s.textContent="Applying...");try{e();const t=await saveBulkChangesToSquarespace(o);e(),setTimeout((()=>{e(),t.success&&(e(),o.forEach((e=>{e.querySelectorAll(".modified").forEach((e=>{e.classList.remove("modified"),e.dataset.originalValue=e.textContent})),e.classList.remove("has-changes","modified")})),resetBulkChanges(),void 0!==categoryOperationTracker&&categoryOperationTracker.cleanup(),e())}),2e3)}catch(e){stopPreparationMessages(),s&&(s.disabled=!1,s.textContent="Apply Changes"),showBulkNotification("Failed to apply bulk changes","error")}}function applyAdvancedBulkChangesToRow(e,t){if(t.categoryToAdd){const n=e.querySelector("td:nth-child(5)");if(n&&!e.classList.contains("variant-row")){const e=n.textContent.trim();let o;if(""===e||"No categories"===e)o=t.categoryToAdd;else{const n=e.split(", ").map((e=>e.trim()));n.includes(t.categoryToAdd)?o=e:(n.push(t.categoryToAdd),o=n.join(", "))}if(o!==e){const t="No categories"===e?"":e,s=t?t.split(", "):[],i="No categories"===o?[]:o.split(", "),a=i.filter((e=>!s.includes(e))),r=s.filter((e=>!i.includes(e)));n.setAttribute("data-field-type","category"),n.setAttribute("data-original-value",t),n.setAttribute("data-new-value",o),a.length>0?n.setAttribute("data-categories-added",a.join(",")):n.removeAttribute("data-categories-added"),r.length>0?n.setAttribute("data-categories-removed",r.join(",")):n.removeAttribute("data-categories-removed")}}}if(t.skuPrefix||t.skuSuffix){const n=e.querySelector("td:nth-child(4)");if(n){const e=n.textContent.trim();let o=e;t.skuPrefix&&(o=t.skuPrefix+o),t.skuSuffix&&(o+=t.skuSuffix),o!==e&&(n.setAttribute("data-field-type","sku"),n.setAttribute("data-original-value",e),n.setAttribute("data-new-value",o))}}}async function applyBulkChanges(){function e(){const e=document.getElementById("bulk-notification-footer");e&&e.textContent.trim()}if(window.licenseManager&&"demo"===window.licenseManager.getLicenseStatus().status)return void("function"==typeof showBulkNotification?showBulkNotification("Apply changes is disabled in demo mode. Please activate your license to use this feature.","error",5e3):alert("Apply changes is disabled in demo mode. Please activate your license to use this feature."));e();const t=document.querySelector(".products-selected-info");t&&(t.style.display="none");const n={...bulkChanges},o=getSelectedProducts();if(e(),0===o.length)return void showBulkNotification("No products selected","error");if(o.forEach((e=>{const t=e.classList.contains("variant-row");e.getAttribute(t?"data-variant-id":"data-product-id"),t&&e.getAttribute("data-parent-product")})),!(Object.values(n).some((e=>null!==e&&!1!==e&&"no-change"!==e&&"unchanged"!==e))||n.newStatus&&"unchanged"!==n.newStatus))return void showBulkNotification("No changes to apply","error");const s=document.getElementById("bulk-apply-all");s&&(s.disabled=!0,s.textContent="Preparing..."),generateActionDescription(o.length),stopPreparationMessages(),s&&(s.textContent="Applying...");try{e();const t=await saveBulkChangesToSquarespace(o);e(),setTimeout((()=>{e(),t.success&&(e(),o.forEach((e=>{e.querySelectorAll(".modified").forEach((e=>{e.classList.remove("modified"),e.dataset.originalValue=e.textContent})),e.classList.remove("has-changes","modified")})),resetBulkChanges(),void 0!==categoryOperationTracker&&categoryOperationTracker.cleanup(),e())}),2e3)}catch(e){stopPreparationMessages(),s&&(s.disabled=!1,s.textContent="Apply Changes"),showBulkNotification("Failed to apply bulk changes","error")}}function applyAdvancedBulkChangesToRow(e,t){if(t.categoryToAdd){const n=e.querySelector("td:nth-child(5)");if(n&&!e.classList.contains("variant-row")){const e=n.textContent.trim();let o;if(""===e||"No categories"===e)o=t.categoryToAdd;else{const n=e.split(", ").map((e=>e.trim()));n.includes(t.categoryToAdd)?o=e:(n.push(t.categoryToAdd),o=n.join(", "))}if(o!==e){const t="No categories"===e?"":e,s=t?t.split(", "):[],i="No categories"===o?[]:o.split(", "),a=i.filter((e=>!s.includes(e))),r=s.filter((e=>!i.includes(e)));n.setAttribute("data-field-type","category"),n.setAttribute("data-original-value",t),n.setAttribute("data-new-value",o),a.length>0?n.setAttribute("data-categories-added",a.join(",")):n.removeAttribute("data-categories-added"),r.length>0?n.setAttribute("data-categories-removed",r.join(",")):n.removeAttribute("data-categories-removed")}}}if(t.skuPrefix||t.skuSuffix){const n=e.querySelector("td:nth-child(4)");if(n){const e=n.textContent.trim();let o=e;t.skuPrefix&&(o=t.skuPrefix+o),t.skuSuffix&&(o+=t.skuSuffix),o!==e&&(n.setAttribute("data-field-type","sku"),n.setAttribute("data-original-value",e),n.setAttribute("data-new-value",o))}}}function applyRounding(e,t,n){if(!e||e<=0)return e;let o;switch(t){case"whole":o=Math.round(e);break;case".99":const t=Math.floor(e),s=t-1+.99,i=t+.99,a=t+1+.99,r=Math.abs(e-s),c=Math.abs(e-i),l=Math.abs(e-a);o=r<=c&&r<=l?s:c<=l?i:a,o<.99&&(o=.99);break;case".95":const d=Math.floor(e),u=d-1+.95,p=d+.95,g=d+1+.95,h=Math.abs(e-u),m=Math.abs(e-p),y=Math.abs(e-g);o=h<=m&&h<=y?u:m<=y?p:g,o<.95&&(o=.95);break;case"custom":const f=(n||99)/100,v=Math.floor(e),w=v-1+f,k=v+f,b=v+1+f,C=Math.abs(e-w),S=Math.abs(e-k),E=Math.abs(e-b);o=C<=S&&C<=E?w:S<=E?k:b,o<f&&(o=f);break;default:o=e}return o}async function getCategoryIdsByNames(e){const t=window.globalCategoriesData||[],n=[];for(const o of e){const e=t.find((e=>e.name===o));if(e)n.push(e.id);else{const e=await createNewCategory(o);e&&n.push(e)}}return n}async function createNewCategory(e){let t=null;if(window.globalCategoryTreeData&&window.globalCategoryTreeData.length>0){const e=window.globalCategoryTreeData.find((e=>"ROOT"===e.type));e&&(t=e.websiteId)}if(!t&&window.globalCollectionsData&&window.globalCollectionsData.length>0&&(t=window.globalCollectionsData[0].websiteId),!t&&window.globalProductsData&&window.globalProductsData.length>0){const e=window.globalProductsData[0];e.websiteId&&(t=e.websiteId)}const n=window.location.pathname.match(/\/config\/pages\/([^\/]+)/);if(!t&&n&&(t=n[1]),!t)return null;const o=getCsrfToken();if(!o)return null;try{let n=null;if(window.globalCategoryTreeData&&window.globalCategoryTreeData.length>0){const e=window.globalCategoryTreeData.find((e=>"ROOT"===e.type));e&&(n=e.id)}const s=window.globalCollectionsData?.[0]?.id;if(!s)throw new Error("Collection ID not found - cannot create category");const i=await fetch(`${window.location.origin}/api/content-service/product/1.1/websites/${t}/products/${s}/categories`,{method:"POST",headers:{accept:"application/json, text/plain, */*","content-type":"application/json","x-csrf-token":o},credentials:"include",body:JSON.stringify({displayName:e,parentCategoryId:n,type:"INTERIOR",pageRendering:"LIST_VIEW",displayIndex:1})});if(i.ok){const t=await i.json();return window.globalCategoriesData&&window.globalCategoriesData.push({id:t.id,name:e,itemIds:[]}),window.globalCategoryTreeData&&window.globalCategoryTreeData.push({id:t.id,name:e,displayName:e,parentId:n,type:"INTERIOR",productIds:[]}),t.id}return null}catch(e){return null}}async function updateProductCategories(e,t,n){if(!t||0===t.length)return!0;const o=await getCategoryIdsByNames(t);if(!o||0===o.length)return!1;const s=o.map((e=>`categoryIds=${e}`)).join("&"),i=`${window.location.origin}/api/commerce/products/${e}/categories/assign?${s}`;try{const e=await fetch(i,{method:"POST",headers:{accept:"application/json, text/plain, */*","x-csrf-token":n},credentials:"include",body:null});if(e.ok){const t=await e.json(),n=new Set(o),s=(new Set(Object.keys(t)),o.filter((e=>!t.hasOwnProperty(e))),Object.keys(t).filter((e=>!0===t[e])));return(Object.keys(t).filter((e=>!0!==t[e])),s.filter((e=>n.has(e)))).length===o.length}return await e.text(),!1}catch(e){return!1}}async function unassignProductCategories(e,t,n){if(!t||0===t.length)return!0;const o=await getCategoryIdsByNames(t);if(!o||0===o.length)return!1;const s=o.map((e=>`categoryIds=${e}`)).join("&"),i=`${window.location.origin}/api/commerce/products/${e}/categories/unassign?${s}`;try{const o=await fetch(i,{method:"POST",headers:{accept:"application/json, text/plain, */*","x-csrf-token":n},credentials:"include",body:null});if(o.ok){try{const t=await o.text();if(t)try{const n=JSON.parse(t);if("object"==typeof n){const t=Object.keys(n),o=String(e),s=Number(e);!0===n[e]||!0===n[o]||!0===n[s]||t.includes(e)||t.includes(o)}}catch(e){}}catch(e){}try{await new Promise((e=>setTimeout(e,500)));const o=await fetch(`${window.location.origin}/api/commerce/products/${e}`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-Token":n},credentials:"include"});if(o.ok){const s=await o.json(),i=await getCategoryIdsByNames(t),a=s.categoryIds||[],r=i.filter((e=>a.includes(e))),c=r.length>0?t.filter(((e,t)=>r.includes(i[t]))):[];if(c.length>0)try{return!!await updateProductCategories(e,c,n)&&(await new Promise((e=>setTimeout(e,300))),!!await unassignProductCategoriesCore(e,c,n))}catch(e){return!1}}}catch(e){}return!0}return await o.text(),!1}catch(e){return!1}}async function unassignProductCategoriesCore(e,t,n){if(!t||0===t.length)return!0;const o=await getCategoryIdsByNames(t);if(!o||0===o.length)return!1;const s=o.map((e=>`categoryIds=${e}`)).join("&"),i=`${window.location.origin}/api/commerce/products/${e}/categories/unassign?${s}`;try{const e=await fetch(i,{method:"POST",headers:{accept:"application/json, text/plain, */*","x-csrf-token":n},credentials:"include",body:null});if(e.ok){const t=await e.json(),n=Object.keys(t);return n.filter((e=>!0===t[e])),!(n.filter((e=>!0!==t[e])).length>0)}return await e.text(),!1}catch(e){return!1}}function convertScheduledDateToISO(e){try{let t;if(!e.includes("T")||e.includes("Z")||e.includes("+"))t=new Date(e);else{const n=e.includes(":")&&2===e.split(":").length?e+":00":e;t=new Date(n)}return t.toISOString()}catch(e){return new Date(Date.now()+36e5).toISOString()}}function processCategoryChanges(e){let t=e.categories||[];if(bulkChanges.categories&&(bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.length>0||bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.length>0)){let e=[...t];return bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.length>0&&(e=e.filter((e=>!bulkChanges.categories.toRemove.includes(e)))),bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.length>0&&bulkChanges.categories.toAdd.forEach((t=>{e.includes(t)||e.push(t)})),e}return t}function initializeBulkChangeApplication(){initializeProgressTracking(),initializeSquarespaceApiIntegration()}function initializeProgressTracking(){window.globalProgress={startBulk:function(e,t){this.currentItem=0,this.totalItems=e,this._completed=!1,this._successCount=0,this._errorCount=0,this._categoryTimerStarted=!1,this._currentCategoryProgress=75,this._categoryProgressInterval&&clearInterval(this._categoryProgressInterval),this.updateProgress(t)},updateCounts:function(e,t){this._successCount=e,this._errorCount=t,this.currentItem>=this.totalItems&&!this._completed&&this.completeBulk(0===t?`Successfully saved ${e} product${1!==e?"s":""}!`:`Saved ${e} products, ${t} failed`)},updateBulkItem:function(e,t){this.currentItem=e+1,Math.round(this.currentItem/this.totalItems*100),this.updateProgress(`Processing ${t}... (${this.currentItem}/${this.totalItems})`),this.currentItem>=this.totalItems&&!this._completed&&!this._categoryTimerStarted&&bulkChanges.categories&&(bulkChanges.categories.toAdd||bulkChanges.categories.toRemove)&&this.startCategoryProgressTimer()},startCategoryProgressTimer:function(){this._categoryTimerStarted=!0,this._currentCategoryProgress=75;const e=25/this.totalItems;this.updateProgress(`Processing categories... (${this.totalItems} products)`),this._categoryProgressInterval=setInterval((()=>{this._currentCategoryProgress+=e,this._currentCategoryProgress>=100&&(this._currentCategoryProgress=100,clearInterval(this._categoryProgressInterval)),this.updateProgress(`Processing categories... (${this.totalItems} products)`)}),1e3)},completeBulk:function(e){function t(){const e=document.getElementById("bulk-notification-footer");e&&e.textContent.trim()}if(this._completed)return;this._completed=!0,t(),this._categoryProgressInterval&&(clearInterval(this._categoryProgressInterval),this._categoryProgressInterval=null);const n=document.getElementById("bulk-progress-container");n&&(n.style.display="none"),t(),showBulkNotification(e,"success",0),t();const o=document.getElementById("select-all-checkbox");o&&(o.checked=!1,o.indeterminate=!1),setTimeout((()=>{t(),"function"==typeof hideBulkAdjustDrawer&&hideBulkAdjustDrawer(),"function"==typeof loadProducts&&loadProducts().then((()=>{})).catch((()=>{})),this._completed=!1}),3e3)},updateProgress:function(e){const t=document.getElementById("bulk-progress-container"),n=document.getElementById("bulk-progress-fill"),o=document.getElementById("bulk-progress-text");if(t&&n&&o){t.style.display="block";let s=0;const i=bulkChanges.categories&&(bulkChanges.categories.toAdd||bulkChanges.categories.toRemove);s=i&&!this._categoryTimerStarted?Math.round(75*(this.totalItems?this.currentItem/this.totalItems:0)):i&&this._categoryTimerStarted?Math.min(this._currentCategoryProgress||75,100):this.totalItems?Math.round(this.currentItem/this.totalItems*100):0,n.style.width=`${s}%`,o.textContent=e}},startMain:function(e,t){this.currentItem=0,this.totalItems=e,this._completed=!1,this._successCount=0,this._errorCount=0,this.updateMainProgress(t)},updateMainItem:function(e,t){this.currentItem=e+1,Math.round(this.currentItem/this.totalItems*100),this.updateMainProgress(`Processing ${t}... (${this.currentItem}/${this.totalItems})`)},completeMain:function(e){if(this._completed)return;this._completed=!0;const t=document.getElementById("main-progress-container");t&&(t.style.display="none"),showFooterNotification(e,"success")},updateMainProgress:function(e){const t=document.getElementById("main-progress-container"),n=document.getElementById("main-progress-fill"),o=document.getElementById("main-progress-text");if(t&&n&&o){t.style.display="block";const s=this.totalItems?Math.round(this.currentItem/this.totalItems*100):0;n.style.width=`${s}%`,o.textContent=e}}}}function getJsonFileUrl(){const e=document.querySelector('meta[data-squarehero-plugin="product-manager"]');return e?e.getAttribute("settings"):null}async function loadUndoHistoryFromJson(){try{const e=getJsonFileUrl();if(!e)return void(undoHistory=[]);const t=await fetch(e,{method:"GET",cache:"no-cache"});if(!t.ok)return void(undoHistory=[]);const n=await t.json();n.undoHistory||(n.undoHistory=[]),undoHistory=n.undoHistory||[]}catch(e){undoHistory=[]}}function populateUndoHistoryList(){const e=document.getElementById("undo-history-list");e&&(e.innerHTML="",0!==undoHistory.length?undoHistory.forEach(((t,n)=>{const o=document.createElement("div");o.className="undo-history-item",o.style.cssText="\n            border: 1px solid #e5e7eb;\n            border-radius: 8px;\n            padding: 16px;\n            margin-bottom: 12px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            background: white;\n        ",o.innerHTML=`\n            <div class="undo-item-header" style="\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                margin-bottom: 8px;\n            ">\n                <div class="undo-item-action" style="\n                    font-weight: 600;\n                    color: #111827;\n                    font-size: 14px;\n                ">${t.action}</div>\n                <div class="undo-item-time" style="\n                    font-size: 12px;\n                    color: #6b7280;\n                ">${formatTimeAgo(t.timestamp)}</div>\n            </div>\n            <div class="undo-item-details" style="\n                font-size: 13px;\n                color: #6b7280;\n                margin-bottom: 8px;\n            ">${t.productCount} product${1===t.productCount?"":"s"} affected</div>\n            <div class="undo-item-products" style="\n                font-size: 12px;\n                color: #9ca3af;\n                line-height: 1.4;\n                max-height: 40px;\n                overflow: hidden;\n            ">${t.productTitles?.slice(0,3).join(", ")}${t.productTitles?.length>3?"...":""}</div>\n        `,o.addEventListener("click",(()=>{document.querySelectorAll(".undo-history-item").forEach((e=>{e.style.borderColor="#e5e7eb",e.style.backgroundColor="white"})),o.style.borderColor="#3b82f6",o.style.backgroundColor="#eff6ff",selectedUndoIndex=n;const e=document.getElementById("undo-restore");e&&(e.disabled=!1)})),e.appendChild(o)})):e.innerHTML='\n            <div class="undo-empty-state" style="\n                text-align: center;\n                padding: 40px 20px;\n                color: #6b7280;\n                font-style: italic;\n            ">\n                <div style="font-size: 48px; margin-bottom: 16px;">📝</div>\n                <div>No changes to undo</div>\n                <div style="font-size: 14px; margin-top: 8px;">Make some bulk changes to see undo history here</div>\n            </div>\n        ')}function formatTimeAgo(e){const t=new Date,n=new Date(e),o=t-n,s=Math.floor(o/6e4),i=Math.floor(o/36e5),a=Math.floor(o/864e5);return s<1?"Just now":s<60?`${s}m ago`:i<24?`${i}h ago`:a<7?`${a}d ago`:n.toLocaleDateString()}async function initializeUndoSystem(){try{await loadUndoHistoryFromJson();const e=document.getElementById("undo-changes-btn");e&&e.removeEventListener("click",restoreFromUndo),updateUndoButtonState()}catch(e){undoHistory||(undoHistory=[]),updateUndoButtonState()}}function updateUndoButtonState(){const e=document.getElementById("undo-changes-btn");e&&(e.disabled=!(undoHistory&&undoHistory.length>0))}function getCsrfToken(){const e=document.cookie.split(";").find((e=>e.trim().startsWith("crumb=")))?.split("=")[1];return e||null}async function fetchCurrentProductStates(){try{const e=getCsrfToken();if(!e)return[];const t=await fetch(`${window.location.origin}/api/commondata/GetCollections`,{method:"GET",headers:{accept:"application/json","x-csrf-token":e},credentials:"include"});if(!t.ok)return[];const n=await t.json(),o=Object.values(n.collections||{}).filter((e=>13===e.type));if(0===o.length)return[];const s=o[0].websiteId;let i=[];const a=async t=>{const n=`${window.location.origin}/api/content-service/product/1.1/websites/${s}/products/${t.id}/queryProductItems`;try{const t=await fetch(n,{method:"POST",headers:{accept:"application/json","content-type":"application/json","x-csrf-token":e},body:JSON.stringify({limit:200}),credentials:"include"});if(t.ok){return(await t.json()).products||[]}return[]}catch(e){return[]}},r=o.map((e=>a(e)));return i=(await Promise.all(r)).flat(),i}catch(e){return[]}}async function captureUndoSnapshot(e="Bulk operation",t=null){try{const n=Date.now(),o=`undo_${new Date(n).toISOString().slice(0,19).replace(/[:-]/g,"").replace("T","_")}_${n}.json`,s=await fetchCurrentProductStates();if(!s||0===s.length)return;const i={timestamp:n,action:e,detailedDescription:t,filename:o,products:s.map((e=>{const t="DIGITAL"===e.storeItem?.productType||"DIGITAL"===e.type,n="SERVICE"===e.storeItem?.productType,o=!t&&!n&&(e.storeItem?.variants?.length>0?e.storeItem.variants[0]:e.variants?.length>0?e.variants[0]:null),s=(e,t=null)=>{if(null==e)return"N/A";if(window.currencyManager)return window.currencyManager.formatCurrency(e/100,t);const n=t||window.getSystemCurrency?.(),o=(e/100).toFixed(2);return n?`${n}$${o}`:`$${o}`};let i="N/A",a="";if(t){const t=e.price||e.storeItem?.priceCents,n=e.salePrice||e.storeItem?.salePriceCents;i=s(t),null!=n&&(a=s(n))}else{const e=o?.priceMoney?.value||o?.price,t=o?.salePriceMoney?.value||o?.salePrice;i=s(e),null!=t&&(a=s(t))}let r="0";t?r="∞":o&&(r=o.unlimited?"∞":o.qtyInStock?.toString()||"0");let c="hidden";return"PUBLISHED"===e.workflowState?c="public":"DRAFT"===e.workflowState&&(c=e.publishOn&&new Date(e.publishOn)>new Date?"scheduled":"hidden"),{id:e.id,name:e.title||"Untitled Product",price:i,salePrice:a,onSale:o?.onSale||!1,stockLevel:r,status:c,categories:e.categories&&Array.isArray(e.categories)&&e.categories.length>0?e.categories[0]?.title?e.categories.map((e=>e.title)).join(", "):e.categories.join(", "):"Uncategorized",urlSlug:e.urlId||"",sku:t||n?"N/A":o?.sku||"N/A",productType:n?"Service":t?"Digital":"Physical",originalData:e}}))},a=await saveUndoSnapshotFile(o,i),r=document.querySelector(".bulk-notification-content");r&&(r.style.display="none"),undoHistory||(undoHistory=[],updateUndoButtonState());const c={timestamp:i.timestamp,action:i.action,detailedDescription:i.detailedDescription,filename:o,fileUrl:a,productCount:i.products.length,productTitles:i.products.slice(0,3).map((e=>e.name||e.title)).filter(Boolean)};undoHistory.unshift(c);const l=5;if(undoHistory.length>l){for(let e=l;e<undoHistory.length;e++)await deleteUndoSnapshotFile(undoHistory[e].filename);undoHistory=undoHistory.slice(0,l)}updateUndoButtonState()}catch(e){throw e}}async function saveUndoSnapshotFile(e,t){try{const n=JSON.stringify(t,null,2);return await uploadJsonToCssAssets(e,n,"Save undo snapshot")}catch(e){throw e}}async function deleteUndoSnapshotFile(){}async function uploadJsonToCssAssets(e,t){try{const n=getCsrfToken();if(!n)throw new Error("Cannot upload file without CSRF token");const o=new File([t],e,{type:"application/json"}),s=new FormData;s.append("contentType",o.type),s.append("fileName",o.name),s.append("fileSize",o.size),s.append("Filedata",o);const i=await fetch(`${window.location.origin}/api/uploads/css-assets`,{method:"POST",headers:{accept:"application/json, text/plain, */*","x-csrf-token":n},body:s,credentials:"include"});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const a=await i.json(),r=a.media?.[0]?.assetUrl;if(!r)throw new Error("No file URL returned from upload");return r}catch(e){throw e}}async function restoreFromUndo(){if(undoHistory&&0!==undoHistory.length)try{const e=undoHistory.pop();updateUndoButtonState(),globalProductsData=[...e.productData],urlRedirects=new Map(e.urlRedirects),"function"==typeof loadProducts&&await loadProducts(),showMessage(`Undid: ${e.description}`,"success")}catch(e){showMessage("Error restoring changes","error")}else showMessage("No changes to undo","warning")}function initializeSquarespaceApiIntegration(){initializeProductUpdateAPI()}function initializeProductUpdateAPI(){window.updateProductFields=async function(e,t,n){const o=e.id,s="DIGITAL"===e.storeItem?.productType,i="SERVICE"===e.storeItem?.productType,a=t.variantId&&t.variantChanges,r=t.batchedVariantChanges&&Object.keys(t.batchedVariantChanges).length>0;if(a){const n=e.storeItem?.variants?.some((e=>e.id===t.variantId));if(!n)throw new Error(`Variant ID ${t.variantId} not found in product ${e.id}`)}else if(r){const n=Object.keys(t.batchedVariantChanges),o=e.storeItem?.variants?.map((e=>e.id))||[];for(const t of n)if(!o.includes(t))throw new Error(`Variant ID ${t} not found in product ${e.id}`)}let c;if(i){let n,o=null;if("undefined"!=typeof currentBulkChanges&&currentBulkChanges&&currentBulkChanges.newStatus&&"unchanged"!==currentBulkChanges.newStatus)"public"===currentBulkChanges.newStatus?n="VISIBLE":"hidden"===currentBulkChanges.newStatus?n="HIDDEN":"scheduled"===currentBulkChanges.newStatus&&(n="SCHEDULED",o=currentBulkChanges.scheduledDate?convertScheduledDateToISO(currentBulkChanges.scheduledDate):new Date(Date.now()+36e5).toISOString());else if(void 0!==t.status)if("public"===t.status)n="VISIBLE";else if("hidden"===t.status)n="HIDDEN";else if("scheduled"===t.status)if(n="SCHEDULED","undefined"!=typeof currentBulkChanges&&currentBulkChanges&&currentBulkChanges.scheduledDate)try{o=convertScheduledDateToISO(currentBulkChanges.scheduledDate)}catch(e){o=new Date(Date.now()+36e5).toISOString()}else o=new Date(Date.now()+36e5).toISOString();else n="HIDDEN";else n="PUBLISHED"===e.workflowState?"VISIBLE":"HIDDEN";const s=window.currencyManager?window.currencyManager.getCurrencySync():e.storeItem?.price&&"object"==typeof e.storeItem.price&&e.storeItem.price.currencyCode?e.storeItem.price.currencyCode:window.getSystemCurrency?.()||null;if(c={createdVariants:[],updatedVariants:[{id:e.storeItem?.variants?.[0]?.id||"variant-id",sku:void 0!==t.sku?t.sku:e.storeItem?.variants?.[0]?.sku||"",price:{decimalValue:void 0!==t.price?parseFloat(t.price).toFixed(2):(()=>{if(e.storeItem?.priceCents)return(e.storeItem.priceCents/100).toFixed(2);if(e.storeItem?.price&&"object"==typeof e.storeItem.price)return parseFloat(e.storeItem.price.decimalValue).toFixed(2);if(e.storeItem?.variants?.[0]?.price){const t=e.storeItem.variants[0];return("object"==typeof t.price&&t.price.decimalValue?parseFloat(t.price.decimalValue):t.price/100).toFixed(2)}return"0.00"})(),currencyCode:s},unlimited:!0,optionValues:e.storeItem?.variants?.[0]?.optionalValues||[]}],deletedVariants:[],name:void 0!==t.title?t.title:e.title,description:e.description||"",visibility:{state:n,...("SCHEDULED"===n||o)&&{visibleOn:o}},..."SCHEDULED"===n&&o?{publishOn:o}:{},tags:e.tags||[],categories:processCategoryChanges(e),newImageOrder:[],variantOptionOrdering:e.storeItem?.variants?.length>0?[...new Set(e.storeItem.variants.flatMap((e=>(e.optionalValues||[]).map((e=>e.optionName)))))]:[],variantOrderBySkus:[void 0!==t.sku?t.sku:e.storeItem?.variants?.[0]?.sku||""],useCustomAddButtonText:!1,customAddButtonText:"Add to Cart",featuredProduct:!1,shareStates:[],urlId:void 0!==t.url?t.url:e.urlId,regenerateUrlId:!1,productAddOnsConfiguration:{productAddOns:[]}},void 0!==t.salePrice||void 0!==t.salePrice||void 0!==t.onSale)c.updatedVariants[0].salePrice={decimalValue:void 0!==t.salePrice&&""!==t.salePrice?(()=>{const e=parseFloat(t.salePrice);return!isNaN(e)&&e>=0?e.toFixed(2):"0.00"})():(()=>{if(e.storeItem?.salePriceCents)return(e.storeItem.salePriceCents/100).toFixed(2);if(e.storeItem?.variants?.[0]?.salePrice){const t=e.storeItem.variants[0];return("object"==typeof t.salePrice&&t.salePrice.decimalValue?parseFloat(t.salePrice.decimalValue):t.salePrice/100).toFixed(2)}return"0.00"})(),currencyCode:s},parseFloat(c.updatedVariants[0].price.decimalValue),parseFloat(c.updatedVariants[0].salePrice.decimalValue),c.updatedVariants[0].onSale=void 0!==t.onSale?"Yes"===t.onSale:e.storeItem?.onSale||!1;else if(null!=e.storeItem?.salePriceCents)c.updatedVariants[0].salePrice={decimalValue:(e.storeItem.salePriceCents/100).toFixed(2),currencyCode:s},c.updatedVariants[0].onSale=e.storeItem?.onSale||!1;else if(null!=e.storeItem?.variants?.[0]?.salePrice){const t=e.storeItem.variants[0];c.updatedVariants[0].salePrice={decimalValue:"object"==typeof t.salePrice&&t.salePrice.decimalValue?parseFloat(t.salePrice.decimalValue).toFixed(2):(t.salePrice/100).toFixed(2),currencyCode:s},c.updatedVariants[0].onSale=t.onSale||!1}}else if(s){let n,o=null;if("undefined"!=typeof currentBulkChanges&&currentBulkChanges&&currentBulkChanges.newStatus&&"unchanged"!==currentBulkChanges.newStatus){if("public"===currentBulkChanges.newStatus)n="VISIBLE";else if("hidden"===currentBulkChanges.newStatus)n="HIDDEN";else if("scheduled"===currentBulkChanges.newStatus)if(n="SCHEDULED",currentBulkChanges.scheduledDate)try{o=convertScheduledDateToISO(currentBulkChanges.scheduledDate)}catch(e){o=new Date(Date.now()+36e5).toISOString()}else o=new Date(Date.now()+36e5).toISOString()}else if(void 0!==t.status)if("public"===t.status)n="VISIBLE";else if("hidden"===t.status)n="HIDDEN";else if("scheduled"===t.status)if(n="SCHEDULED","undefined"!=typeof currentBulkChanges&&currentBulkChanges&&currentBulkChanges.scheduledDate)try{o=convertScheduledDateToISO(currentBulkChanges.scheduledDate)}catch(e){o=new Date(Date.now()+36e5).toISOString()}else o=new Date(Date.now()+36e5).toISOString();else n="HIDDEN";else n="PUBLISHED"===e.workflowState?"VISIBLE":"HIDDEN";if(c={name:void 0!==t.title?t.title:e.title,description:e.description||"",visibility:{state:n,...("SCHEDULED"===n||o)&&{visibleOn:o}},..."SCHEDULED"===n&&o?{publishOn:o}:{},tags:e.tags||[],categories:processCategoryChanges(e),newImageOrder:[],variantOptionOrdering:[],variantOrderBySkus:[],useCustomAddButtonText:!1,customAddButtonText:"Add to Cart",featuredProduct:!1,shareStates:[],urlId:void 0!==t.url?t.url:e.urlId,regenerateUrlId:!1,productAddOnsConfiguration:{productAddOns:[]}},void 0!==t.price){const e=parseFloat(t.price),n=window.getSystemCurrency();c.price={decimalValue:e%1==0?e.toString():e.toFixed(2),currencyCode:n}}else{const t=(e.storeItem?.priceCents||0)/100,n=window.getSystemCurrency();c.price={decimalValue:t%1==0?t.toString():t.toFixed(2),currencyCode:n}}if(void 0!==t.salePrice&&""!==t.salePrice){const n=parseFloat(t.salePrice);if(!isNaN(n)&&n>=0){const o=window.getSystemCurrency();c.salePrice={decimalValue:n%1==0?n.toString():n.toFixed(2),currencyCode:o},c.onSale=void 0!==t.onSale?"Yes"===t.onSale:e.storeItem?.onSale||!1}else{const n=window.getSystemCurrency();c.salePrice={decimalValue:"0.00",currencyCode:n},c.onSale=void 0!==t.onSale?"Yes"===t.onSale:e.storeItem?.onSale||!1}}else if(void 0!==t.onSale){const n=(e.storeItem?.salePriceCents||0)/100,o=window.getSystemCurrency();c.salePrice={decimalValue:n%1==0?n.toString():n.toFixed(2),currencyCode:o},c.onSale="Yes"===t.onSale}else if(null!=e.storeItem?.salePriceCents){const t=e.storeItem.salePriceCents/100,n=window.getSystemCurrency();c.salePrice={decimalValue:t%1==0?t.toString():t.toFixed(2),currencyCode:n},c.onSale=e.storeItem?.onSale||!1}}else{const n=t.variantId&&t.variantChanges,o=t.batchedVariantChanges&&Object.keys(t.batchedVariantChanges).length>0,s=(()=>{if(e.storeItem?.variants?.length>0){const t=e.storeItem.variants[0];if(t.price&&"object"==typeof t.price&&t.price.currencyCode)return t.price.currencyCode}const t=window.getSystemCurrency?.();if(t)return t;throw new Error("Unable to detect currency for API request")})(),i=e.storeItem?.variants?.map((e=>{let i;i=n?e.id===t.variantId?t.variantChanges:{}:o?t.batchedVariantChanges[e.id]?t.batchedVariantChanges[e.id]:{}:t;const a={id:e.id,sku:void 0!==i.sku?i.sku:e.sku,price:{decimalValue:void 0!==i.price?parseFloat(i.price).toFixed(2):e.price?("object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100).toFixed(2):"0.00",currencyCode:s},unlimited:void 0!==i.stock?"∞"===i.stock:e.unlimited||!1,optionValues:e.optionalValues||[],width:0,height:0,length:0,weight:0},r=void 0!==i.salePrice||void 0!==i.onSale;return void 0!==i.salePrice||r?a.salePrice={decimalValue:void 0!==i.salePrice&&""!==i.salePrice?(()=>{const e=parseFloat(i.salePrice);return(!isNaN(e)&&e>=0?e:0).toFixed(2)})():(()=>{if(e.salePrice){const t="object"==typeof e.salePrice&&e.salePrice.decimalValue?parseFloat(e.salePrice.decimalValue):e.salePrice/100;return(!isNaN(t)&&t>=0?t:0).toFixed(2)}return"0.00"})(),currencyCode:s}:null!=e.salePrice&&(a.salePrice={decimalValue:"object"==typeof e.salePrice&&e.salePrice.decimalValue?parseFloat(e.salePrice.decimalValue).toFixed(2):(e.salePrice/100).toFixed(2),currencyCode:s}),(r||a.salePrice)&&(parseFloat(a.price.decimalValue),a.salePrice&&parseFloat(a.salePrice.decimalValue),a.onSale=void 0!==i.onSale?"Yes"===i.onSale:e.onSale||!1),a.unlimited||void 0===i.stock||"∞"===i.stock||parseInt(i.stock),a}))||[],a={...t};let r;delete a.variantId,delete a.variantChanges,delete a.batchedVariantChanges;let l=null;if("undefined"!=typeof currentBulkChanges&&currentBulkChanges&&currentBulkChanges.newStatus&&"unchanged"!==currentBulkChanges.newStatus){if("public"===currentBulkChanges.newStatus)r="VISIBLE";else if("hidden"===currentBulkChanges.newStatus)r="HIDDEN";else if("scheduled"===currentBulkChanges.newStatus)if(r="SCHEDULED",currentBulkChanges.scheduledDate)try{l=convertScheduledDateToISO(currentBulkChanges.scheduledDate)}catch(e){l=new Date(Date.now()+36e5).toISOString()}else l=new Date(Date.now()+36e5).toISOString()}else if(void 0!==a.status)if("public"===a.status)r="VISIBLE";else if("hidden"===a.status)r="HIDDEN";else if("scheduled"===a.status)if(r="SCHEDULED","undefined"!=typeof currentBulkChanges&&currentBulkChanges&&currentBulkChanges.scheduledDate)try{l=convertScheduledDateToISO(currentBulkChanges.scheduledDate)}catch(e){l=new Date(Date.now()+36e5).toISOString()}else if(a.scheduledDate)try{l=convertScheduledDateToISO(a.scheduledDate)}catch(e){l=new Date(Date.now()+36e5).toISOString()}else l=new Date(Date.now()+36e5).toISOString();else r="HIDDEN";else r="PUBLISHED"===e.workflowState?"VISIBLE":"HIDDEN";c={createdVariants:[],updatedVariants:i,deletedVariants:[],name:void 0!==a.title?a.title:e.title,description:e.description||"",visibility:{state:r,...("SCHEDULED"===r||"SCHEDULED"!==r&&l)&&{visibleOn:l}},..."SCHEDULED"===r&&l?{publishOn:l}:{},tags:e.tags||[],categories:e.categories||[],newImageOrder:[],variantOptionOrdering:e.storeItem?.variants?.length>0?[...new Set(e.storeItem.variants.flatMap((e=>(e.optionalValues||[]).map((e=>e.optionName)))))]:[],variantOrderBySkus:i.map((e=>e.sku)),useCustomAddButtonText:!1,customAddButtonText:"Add to Cart",featuredProduct:!1,shareStates:[],urlId:void 0!==a.url?a.url:e.urlId,regenerateUrlId:!1,productAddOnsConfiguration:{productAddOns:[]}}}if(c.updatedVariants&&c.updatedVariants.forEach((e=>{const t=parseFloat(e.price.decimalValue),n=e.salePrice?parseFloat(e.salePrice.decimalValue):0;t<=0&&(e.price.decimalValue="0.01"),e.onSale&&n<0&&(e.onSale=!1)})),c.price&&c.salePrice){const e=parseFloat(c.price.decimalValue),t=parseFloat(c.salePrice.decimalValue);e<=0&&(c.price.decimalValue="0.01"),c.onSale&&t<0&&(c.onSale=!1)}const l=`${window.location.origin}/api/commerce/products/${o}`;let d=e.categories||[];if((!d||0===d.length)&&void 0!==globalCategoryTreeData&&globalCategoryTreeData){const e=[];globalCategoryTreeData.forEach((t=>{t.productIds&&t.productIds.includes(o)&&e.push(t.name)})),e.length>0&&(d=e)}void 0!==c.categories&&(c.categories=d);try{const e=await fetch(l,{method:"PUT",headers:{accept:"application/json, text/plain, */*","content-type":"application/json","x-csrf-token":n},credentials:"include",body:JSON.stringify(c)});if(!e.ok){const t=await e.text();try{JSON.parse(t)}catch(e){}throw new Error(`HTTP ${e.status}: ${t}`)}await e.json();let t=!0;if(bulkChanges.categories&&bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.length>0){for(const e of bulkChanges.categories.toRemove)await categoryOperationTracker.waitForCategorySlot(e,"remove");void 0!==globalCategoriesData&&globalCategoriesData&&globalCategoriesData.forEach((e=>{e.itemIds&&e.itemIds.includes(o)}));try{await unassignProductCategories(o,bulkChanges.categories.toRemove,n)?await new Promise((e=>setTimeout(e,1e3))):t=!1}catch(e){t=!1}}if(bulkChanges.categories&&bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.length>0){for(const e of bulkChanges.categories.toAdd)await categoryOperationTracker.waitForCategorySlot(e,"add");try{await updateProductCategories(o,bulkChanges.categories.toAdd,n)||(t=!1)}catch(e){t=!1}}return!0}catch(e){return!1}}}async function saveBulkChangesToSquarespace(e){const t=getCsrfToken();if(!t)return{success:!1,successCount:0,errorCount:e.length};globalProgress&&globalProgress.startBulk(e.length,"Applying bulk changes...");const n=new Map;for(const t of e){const e=t.classList.contains("variant-row");let o,s;e?(o=t.getAttribute("data-parent-product"),s=t.getAttribute("data-variant-id")):o=t.getAttribute("data-product-id");const i=window.squarespaceProducts?.find((e=>e.id===o)),a=globalProductsData?.find((e=>e.id===o)),r=a||i;if(!r)continue;n.has(o)||n.set(o,{product:r,changes:{},variantChanges:{}});const c=n.get(o);let l;try{l=void 0!==bulkChanges?{...bulkChanges}:{}}catch(e){l={}}if(!l||0===Object.keys(l).length)return;if(l.newStatus&&"unchanged"!==l.newStatus){let e;"public"===l.newStatus?e="public":"hidden"===l.newStatus?e="hidden":"scheduled"===l.newStatus&&(e="scheduled"),e&&(c.changes.status=e,"scheduled"===e&&l.scheduledDate&&(c.changes.scheduledDate=l.scheduledDate))}if(null!=l.priceAdjustment||null!=l.fixedPrice){let t=null,n=0;if(e){const e=r.storeItem?.variants?.find((e=>e.id===s));e?.price&&(n="object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100)}else if(r.storeItem?.priceCents)n=r.storeItem.priceCents/100;else if(r.storeItem?.price)n="object"==typeof r.storeItem.price&&r.storeItem.price.decimalValue?parseFloat(r.storeItem.price.decimalValue):r.storeItem.price;else if(r.storeItem?.variants?.length>0){const e=r.storeItem.variants[0];e?.price&&(n="object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100)}if(n<=0)"percentage"===l.regularAdjustmentType&&(t=(1*(1+l.priceAdjustment/100)).toFixed(2));else{if("percentage"===l.regularAdjustmentType)t=(n*(1+l.priceAdjustment/100)).toFixed(2);else if("fixed-adjustment"===l.regularAdjustmentType){t=Math.max(0,n+l.priceAdjustment).toFixed(2)}else"fixed-price"===l.regularAdjustmentType&&(t=l.fixedPrice.toFixed(2));if(null!==t&&l.enableRounding){const e=l.roundingTarget||"all";"all"!==e&&"regular"!==e||(t=applyRounding(parseFloat(t),l.roundingType,l.customCents).toFixed(2))}null!==t&&(e?(c.variantChanges[s]||(c.variantChanges[s]={}),c.variantChanges[s].price=t):c.changes.price=t)}}else if(l.enableRounding){let t=0;if(e){const e=r.storeItem?.variants?.find((e=>e.id===s));e?.price&&(t="object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100)}else if(r.storeItem?.priceCents)t=r.storeItem.priceCents/100;else if(r.storeItem?.price)t="object"==typeof r.storeItem.price&&r.storeItem.price.decimalValue?parseFloat(r.storeItem.price.decimalValue):r.storeItem.price;else if(r.storeItem?.variants?.length>0){const e=r.storeItem.variants[0];e?.price&&(t="object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100)}if(t>0){const n=l.roundingTarget||"all";if("all"===n||"regular"===n){const n=applyRounding(t,l.roundingType,l.customCents),o=n.toFixed(2);Math.abs(n-t)>.005&&(e?(c.variantChanges[s]||(c.variantChanges[s]={}),c.variantChanges[s].price=o):c.changes.price=o)}}}if(l.enableRounding&&(null==l.saleDiscount||""===l.saleDiscount)){let t=0;const n="DIGITAL"===r.storeItem?.productType,o="SERVICE"===r.storeItem?.productType;if(e){const e=r.storeItem?.variants?.find((e=>e.id===s));null!=e?.salePrice&&(t="object"==typeof e.salePrice&&e.salePrice.decimalValue?parseFloat(e.salePrice.decimalValue):"number"==typeof e.salePrice?e.salePrice/100:parseFloat(e.salePrice))}else if(n||o)null!=r.storeItem?.salePriceCents?t=r.storeItem.salePriceCents/100:r.storeItem?.salePrice&&(t="object"==typeof r.storeItem.salePrice&&r.storeItem.salePrice.decimalValue?parseFloat(r.storeItem.salePrice.decimalValue):parseFloat(r.storeItem.salePrice));else{const e=r.storeItem?.variants||[];if(e.length>0){const n=e.find((e=>null!=e.salePrice))||e[0];null!=n?.salePrice&&(t="number"==typeof n.salePrice?n.salePrice/100:parseFloat(n.salePrice))}}if(t>0){const n=l.roundingTarget||"all";if("all"===n||"sale"===n){const n=applyRounding(t,l.roundingType,l.customCents),o=n.toFixed(2);Math.abs(n-t)>.005&&(e?(c.variantChanges[s]||(c.variantChanges[s]={}),c.variantChanges[s].salePrice=o):c.changes.salePrice=o)}}}if(null!=l.saleDiscount&&""!==l.saleDiscount){let t=0;const n="DIGITAL"===r.storeItem?.productType,o="SERVICE"===r.storeItem?.productType;if(e){const e=r.storeItem?.variants?.find((e=>e.id===s));t=null!=e?.salePrice?"object"==typeof e.salePrice&&e.salePrice.decimalValue?parseFloat(e.salePrice.decimalValue):"number"==typeof e.salePrice?e.salePrice/100:parseFloat(e.salePrice):"object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100}else{if(n||o)null!=r.storeItem?.salePriceCents?t=r.storeItem.salePriceCents/100:r.storeItem?.salePrice&&(t="object"==typeof r.storeItem.salePrice&&r.storeItem.salePrice.decimalValue?parseFloat(r.storeItem.salePrice.decimalValue):parseFloat(r.storeItem.salePrice));else{const e=r.storeItem?.variants||[];if(e.length>0){const n=e[0],o=e.find((e=>null!=e.salePrice))||n;null!=o?.salePrice&&(t="number"==typeof o.salePrice?o.salePrice/100:parseFloat(o.salePrice))}}0===t&&("percentage"===l.saleAdjustmentType?t=null:r.storeItem?.priceCents?t=r.storeItem.priceCents/100:r.storeItem?.price&&(t="object"==typeof r.storeItem.price&&r.storeItem.price.decimalValue?parseFloat(r.storeItem.price.decimalValue):r.storeItem.price))}let i=0;if(e){const e=r.storeItem?.variants?.find((e=>e.id===s));i="object"==typeof e.price&&e.price.decimalValue?parseFloat(e.price.decimalValue):e.price/100}else if(n||o)r.storeItem?.priceCents?i=r.storeItem.priceCents/100:r.storeItem?.price&&(i="object"==typeof r.storeItem.price&&r.storeItem.price.decimalValue?parseFloat(r.storeItem.price.decimalValue):parseFloat(r.storeItem.price));else{const e=r.storeItem?.variants||[];if(e.length>0){const t=e[0];i="number"==typeof t.price?t.price/100:parseFloat(t.price)}}null==l.priceAdjustment&&null==l.fixedPrice||("percentage"===l.regularAdjustmentType?i*=1+l.priceAdjustment/100:"fixed-adjustment"===l.regularAdjustmentType?i+=l.priceAdjustment:"fixed-price"===l.regularAdjustmentType&&(i=l.fixedPrice));let a=null;if("percentage"===l.saleAdjustmentType&&l.saleDiscount){const e=1+l.saleDiscount/100;a=t<=0?(1*e).toFixed(2):(t*e).toFixed(2)}else"fixed-adjustment"===l.saleAdjustmentType&&l.saleDiscount?a=(t+l.saleDiscount).toFixed(2):"fixed-price"===l.saleAdjustmentType&&l.saleDiscount&&(a=Math.abs(l.saleDiscount).toFixed(2));if(null!==a&&l.enableRounding){const e=l.roundingTarget||"all";"all"!==e&&"sale"!==e||(a=applyRounding(parseFloat(a),l.roundingType,l.customCents).toFixed(2))}null!==a&&(e?(c.variantChanges[s]||(c.variantChanges[s]={}),c.variantChanges[s].salePrice=a):c.changes.salePrice=a)}if(l.saleToggle&&"keep-current"!==l.saleToggle&&"no-change"!==l.saleToggle&&("put-on-sale"===l.saleToggle?e?(c.variantChanges[s]||(c.variantChanges[s]={}),c.variantChanges[s].onSale="Yes"):c.changes.onSale="Yes":"take-off-sale"===l.saleToggle&&(e?(c.variantChanges[s]||(c.variantChanges[s]={}),c.variantChanges[s].onSale="No"):c.changes.onSale="No")),l.categories){let e=!1;l.categories.toAdd&&l.categories.toAdd.length>0&&(c.changes.categoryChanges="add",e=!0),l.categories.toRemove&&l.categories.toRemove.length>0&&(c.changes.categoryChanges="add"===c.changes.categoryChanges?"both":"remove",e=!0)}}const o=Array.from(n.entries()),s=await(async e=>{const n=[],o=new Set;let s=0,i=0;const a=e.length,r=async()=>{if(s>=e.length)return;const c=s++,l=e[c];await new Promise((e=>setTimeout(e,50*c)));const d=(async(e,n)=>{const[o,s]=e,i=Object.keys(s.variantChanges).length>0,a=Object.keys(s.changes).length>0;if(!i&&!a)return globalProgress&&globalProgress.updateBulkItem(n,`${s.product.title} (skipped)`),{success:!0,productId:o};const r=i?`${s.product.title} (${Object.keys(s.variantChanges).length} variant${Object.keys(s.variantChanges).length>1?"s":""})`:s.product.title;globalProgress&&globalProgress.updateBulkItem(n,r);try{let e={...s.changes};return i&&(e.batchedVariantChanges=s.variantChanges),await window.updateProductFields(s.product,e,t)?{success:!0,productId:o,displayName:r}:{success:!1,productId:o,displayName:r}}catch(e){return{success:!1,productId:o,displayName:r,error:e}}})(l,c);o.add(d);try{const e=await d;if(n[c]=e,i++,i===a){const e=n.filter((e=>e&&e.success)).length,t=n.filter((e=>e&&!e.success)).length;n.filter((e=>!e)),globalProgress&&globalProgress.updateCounts(e,t)}}catch(e){if(n[c]={success:!1,error:e},i++,i===a){const e=n.filter((e=>e&&e.success)).length,t=n.filter((e=>e&&!e.success)).length;n.filter((e=>!e)),globalProgress&&globalProgress.updateCounts(e,t)}}finally{o.delete(d),s<e.length&&r()}},c=Math.min(10,e.length),l=[];for(let e=0;e<c;e++)l.push(r());for(await Promise.all(l);o.size>0;)await Promise.race(Array.from(o));return n})(o),i=s.filter((e=>e&&e.success)).length,a=s.filter((e=>e&&!e.success)).length;return{success:0===a,successCount:i,errorCount:a}}function generateActionDescription(e){const t=[];if(null!==bulkChanges.priceAdjustment){const e=window.getSystemCurrency()||"";t.push(`Price ${bulkChanges.priceAdjustment>0?"+":""}${bulkChanges.priceAdjustment}${"percentage"===bulkChanges.regularAdjustmentType?"%":` ${e}`}`)}if(bulkChanges.saleToggle&&"keep-current"!==bulkChanges.saleToggle)switch(bulkChanges.saleToggle){case"put-on-sale":t.push("Put products on sale");break;case"take-off-sale":t.push("Take products off sale")}return bulkChanges.enableStockTracking&&t.push("Stock level changes"),bulkChanges.categories&&bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.length>0&&t.push(`Add categories: ${bulkChanges.categories.toAdd.join(", ")}`),bulkChanges.categories&&bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.length>0&&t.push(`Remove categories: ${bulkChanges.categories.toRemove.join(", ")}`),bulkChanges.newStatus&&t.push(`Set status to ${bulkChanges.newStatus}`),bulkChanges.enableRounding&&t.push("Price rounding"),`${t.length>0?t.join(", "):"Bulk changes"} (${e} product${1!==e?"s":""})`}function startPreparationMessages(){usedMessages=[];let e=Math.floor(Math.random()*preparationMessages.length);usedMessages.push(e),showBulkNotification(preparationMessages[e],"info",0),preparationMessageInterval=setInterval((()=>{let e;usedMessages.length>=preparationMessages.length&&(usedMessages=[]);do{e=Math.floor(Math.random()*preparationMessages.length)}while(usedMessages.includes(e));usedMessages.push(e),showBulkNotification(preparationMessages[e],"info",0)}),4e3)}function stopPreparationMessages(){preparationMessageInterval&&(clearInterval(preparationMessageInterval),preparationMessageInterval=null)}function showBulkNotification(e,t="info",n=3e3){const o=document.getElementById("bulk-notification-footer"),s=document.getElementById("bulk-notification-text");if(!o||!s)return;hideBulkNotification(),s.textContent=e,o.className=`bulk-notification-footer visible ${t}`;const i=o.querySelector(".bulk-notification-content"),a=o.querySelector(".bulk-drawer-actions");i&&(i.style.display="block"),a&&(a.style.display="none"),n>0&&setTimeout((()=>{hideBulkNotification()}),n)}function hideBulkNotification(){const e=document.getElementById("bulk-notification-footer");if(!e)return;e.classList.remove("visible","success","error","info");const t=e.querySelector(".bulk-notification-content"),n=e.querySelector(".bulk-drawer-actions");t&&(t.style.display="none"),n&&(n.style.display="flex"),"function"==typeof updateChangesFooter&&updateChangesFooter()}function getSelectedProducts(){return Array.from(document.querySelectorAll('.mix input[type="checkbox"]:checked')).map((e=>e.closest("tr"))).filter((e=>null!==e))}function initializeBulkEditor(){bulkChanges.categories||(bulkChanges.categories={toAdd:[],toRemove:[]}),initializeBulkDrawer(),initializeBulkControls(),initializeCategoryControls(),initializeFlatpickrInputs(),initializeBulkAdjust()}function initializeFlatpickrInputs(){"function"==typeof initializeBulkSchedulingPicker&&initializeBulkSchedulingPicker()}function initializeBulkAdjust(){const e=document.querySelector(".bulk-adjust");document.getElementById("bulk-adjust-drawer"),e&&(e.disabled=!0,e.addEventListener("click",(function(){showBulkDrawer()}))),updateBulkAdjustButton=function(){const t=getSelectedProducts();e&&(e.disabled=!(t.length>0))}}function showBulkDrawer(){if(0===getSelectedProducts().length)return;const e=document.getElementById("bulk-adjust-drawer");if(e){resetBulkChanges();const t=document.getElementById("bulk-progress-container");t&&(t.style.display="none");const n=document.querySelector(".products-selected-info");n&&(n.style.display="flex");const o=document.querySelector(".bulk-notification-content");o&&(o.style.display="none"),"function"==typeof stopPreparationMessages&&stopPreparationMessages(),"function"==typeof hideBulkNotification&&hideBulkNotification(),populateCategoryDropdowns(),updatePreviewPane(),initializeBulkTabs(),initializeBulkToggles(),initializeCustomDropdowns();const s=document.getElementById("bulk-notification-footer");s&&s.classList.add("visible"),e.classList.add("visible"),document.body.style.overflow="hidden"}}function initializeBulkSettings(){try{initializeBulkToggles(),initializeBulkTabs(),initializeBulkControls(),initializeCustomDropdowns()}catch(e){}}function initializeInputListeners(){const e=document.getElementById("price-adjustment"),t=document.getElementById("regular-adjustment-type"),n=document.getElementById("round-prices-only"),o=document.getElementById("apply-to-sale");e&&e.addEventListener("input",(function(){bulkChanges.priceAdjustment=parseFloat(this.value)||null,updatePreviewPane()})),t&&t.addEventListener("change",(function(){bulkChanges.regularAdjustmentType=this.value,updatePreviewPane()})),n&&n.addEventListener("change",(function(){bulkChanges.roundPricesOnly=this.checked,updatePreviewPane()})),o&&o.addEventListener("change",(function(){bulkChanges.applyToSale=this.checked,updatePreviewPane()}))}function getSelectedProducts(){const e=document.querySelectorAll('.mix input[type="checkbox"]:checked');return Array.from(e).map((e=>e.closest("tr")))}function getSelectedProductsWithData(){const e=document.querySelectorAll('.mix input[type="checkbox"]:checked'),t=(document.querySelectorAll('.mix input[type="checkbox"]'),Array.from(e).map((e=>{const t=e.closest("tr");return t?t.getAttribute("data-product-id"):null})).filter((e=>null!==e)));return void 0!==globalProductsData&&globalProductsData?(globalProductsData.length>0&&globalProductsData.slice(0,3).forEach((()=>{})),globalProductsData.filter((e=>t.includes(e.id)))):[]}function populateCategoryDropdowns(){populateAddCategoryDropdown(),populateRemoveCategoryDropdown()}function populateAddCategoryDropdown(){const e=document.getElementById("bulk-category-add-dropdown");if(!e)return;if(void 0===globalCategoriesData||!globalCategoriesData)return;const t=new Set;globalCategoriesData.forEach((e=>{e.name&&e.name.trim()&&"Uncategorized"!==e.name.trim()&&t.add(e.name.trim())}));const n=bulkChanges.categories&&bulkChanges.categories.toRemove?bulkChanges.categories.toRemove:[],o=Array.from(t).filter((e=>!n.includes(e)));e.innerHTML="",o.sort().forEach((t=>{const n=document.createElement("div");n.className="select-option",n.setAttribute("data-value",t),n.textContent=t,e.appendChild(n)}))}function populateRemoveCategoryDropdown(){const e=document.getElementById("bulk-category-remove-dropdown");if(!e)return;const t=getSelectedProductsWithData(),n=new Map;t.forEach((e=>{globalCategoriesData&&globalCategoriesData.length>0&&globalCategoriesData.forEach((t=>{if(t.itemIds&&t.itemIds.includes(e.id)){const e=t.name.trim();if(e&&"Uncategorized"!==e){const t=n.get(e)||0;n.set(e,t+1)}}})),e.categories&&Array.isArray(e.categories)&&e.categories.forEach((e=>{if(e&&e.trim()&&"Uncategorized"!==e.trim()){const t=e.trim(),o=n.get(t)||0;n.set(t,o+1)}})),e.tags&&Array.isArray(e.tags)&&e.tags.forEach((e=>{if(e&&e.trim()&&"Uncategorized"!==e.trim()){const t=e.trim(),o=n.get(t)||0;n.set(t,o+1)}}))}));const o=bulkChanges.categories&&bulkChanges.categories.toRemove?bulkChanges.categories.toRemove:[],s=new Map;if(n.forEach(((e,t)=>{o.includes(t)||s.set(t,e)})),e.innerHTML="",0===s.size){const t=document.createElement("div");t.className="select-option disabled",t.textContent=0===n.size?"No categories in selected products":"All categories already selected for removal",e.appendChild(t)}else Array.from(s.entries()).sort(((e,t)=>e[0].localeCompare(t[0]))).forEach((([t,n])=>{const o=document.createElement("div");o.className="select-option",o.setAttribute("data-value",t),o.textContent=`${t} (${n})`,e.appendChild(o)}))}function countProductsWithCategory(e){const t=getSelectedProductsWithData();let n=0;return t.forEach((t=>{globalCategoriesData&&globalCategoriesData.length>0&&globalCategoriesData.forEach((o=>{o.name.trim()===e&&o.itemIds&&o.itemIds.includes(t.id)&&n++})),t.categories&&Array.isArray(t.categories)&&t.categories.forEach((t=>{t&&t.trim()===e&&n++})),t.tags&&Array.isArray(t.tags)&&t.tags.forEach((t=>{t&&t.trim()===e&&n++}))})),n}function updateCategoryTags(){const e=document.getElementById("bulk-category-tags-display");e&&(e.innerHTML="",bulkChanges.categories&&bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.forEach((t=>{const n=document.createElement("span");n.className="category-tag add-tag",n.innerHTML=`${t} <span class="remove-tag" data-category="${t}" data-type="add">×</span>`,e.appendChild(n)})),bulkChanges.categories&&bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.forEach((t=>{const n=countProductsWithCategory(t),o=document.createElement("span");o.className="category-tag remove-tag",o.innerHTML=`${t} (${n}) <span class="remove-tag" data-category="${t}" data-type="remove">×</span>`,e.appendChild(o)}))),document.querySelectorAll(".remove-tag").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.getAttribute("data-category"),n=e.target.getAttribute("data-type");"add"===n&&bulkChanges.categories&&bulkChanges.categories.toAdd?bulkChanges.categories.toAdd=bulkChanges.categories.toAdd.filter((e=>e!==t)):"remove"===n&&bulkChanges.categories&&bulkChanges.categories.toRemove&&(bulkChanges.categories.toRemove=bulkChanges.categories.toRemove.filter((e=>e!==t))),updateCategoryTags(),updatePreviewPane(),updateApplyAllButton(),populateCategoryDropdowns()}))}))}function updateApplyAllButton(){const e=document.getElementById("bulk-apply-all");if(!e)return;const t=window.licenseManager&&"demo"===window.licenseManager.getLicenseStatus().status,n=null!==bulkChanges.priceAdjustment||null!==bulkChanges.fixedPrice||"no-change"!==bulkChanges.saleToggle&&"keep-current"!==bulkChanges.saleToggle||null!==bulkChanges.saleDiscount&&0!==bulkChanges.saleDiscount||bulkChanges.enableRounding||bulkChanges.enableStockTracking||bulkChanges.categories&&bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.length>0||bulkChanges.categories&&bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.length>0||bulkChanges.newStatus&&"unchanged"!==bulkChanges.newStatus,o=getSelectedProducts();e.disabled=!n||!(o.length>0)||t,t?(e.textContent="Activate to Apply Changes",e.title="Apply changes is disabled in demo mode. Please activate your license to use this feature."):(e.textContent="Apply Changes",e.title="")}function updatePreviewPaneInfo(){const e=getSelectedProducts(),t=document.getElementById("products-selected-count");if(t){const n=e.length;t.textContent=`${n} Product${1!==n?"s":""} Selected`}const n=document.getElementById("estimated-time");if(n){const t=e.length;let o=t;bulkChanges.categories&&(bulkChanges.categories.toAdd||bulkChanges.categories.toRemove)&&(o+=t),o=Math.max(5,o),n.textContent=`Est. ${o} seconds`}}function initializeBulkDrawer(){document.querySelector(".bulk-adjust"),document.getElementById("bulk-adjust-drawer");const e=document.getElementById("bulk-drawer-close"),t=document.querySelector(".bulk-drawer-overlay");e&&e.addEventListener("click",hideBulkAdjustDrawer),t&&t.addEventListener("click",hideBulkAdjustDrawer);const n=document.getElementById("bulk-apply-all");n&&n.addEventListener("click",applyBulkChanges)}function hideBulkAdjustDrawer(){const e=document.getElementById("bulk-adjust-drawer");if(e){e.classList.remove("visible"),document.body.style.overflow="";const t=()=>{resetBulkChanges();const n=document.getElementById("select-all-checkbox");n&&(n.checked=!1,n.indeterminate=!1),resetBulkTabs();const o=document.getElementById("bulk-categories-options"),s=document.getElementById("bulk-categories-toggle");o&&(o.style.display="none"),s&&(s.checked=!1),e.removeEventListener("transitionend",t)};e.addEventListener("transitionend",t)}}function resetBulkTabs(){const e=document.querySelectorAll(".bulk-tab"),t=document.querySelectorAll(".tab-pane");e.forEach((e=>e.classList.remove("active"))),t.forEach((e=>e.classList.remove("active"))),e.length>0&&e[0].classList.add("active"),t.length>0&&t[0].classList.add("active")}function initializeBulkSettings(){resetBulkChanges(),initializeBulkTabs(),initializeBulkToggles(),updateApplyAllButton()}function resetBulkChanges(){bulkChanges={categories:{toAdd:[],toRemove:[]},roundPricesOnly:!1,priceAdjustment:null,regularAdjustmentType:"percentage",applyToSale:!1,fixedPrice:null,fixedApplyToSale:!1,saleDiscount:null,saleAdjustmentType:"percentage",saleToggle:"no-change",enableRounding:!1,roundingType:"whole",roundingTarget:"all",customCents:99,newStatus:null,enableStockTracking:!1,stockType:"limited",stockAction:"adjust",stockAmount:null};const e=document.getElementById("bulk-round-prices"),t=document.getElementById("bulk-rounding-options");e&&(e.checked=!1),t&&(t.style.display="none");const n=document.getElementById("bulk-rounding-type"),o=document.getElementById("bulk-custom-ending"),s=document.getElementById("bulk-rounding-target");if(n&&(n.value="whole"),o){o.style.display="none";const e=document.getElementById("bulk-custom-cents");e&&(e.value="99")}s&&(s.value="all");const i=document.querySelector(".four-way-toggle");if(i){i.querySelectorAll(".toggle-option").forEach((e=>e.classList.remove("active")));const e=i.querySelector('.toggle-option[data-value="whole"]');e&&e.classList.add("active")}const a=document.querySelector("#bulk-rounding-options .three-way-toggle");if(a){a.querySelectorAll(".toggle-option").forEach((e=>e.classList.remove("active")));const e=a.querySelector('.toggle-option[data-value="all"]');e&&e.classList.add("active")}const r=document.getElementById("bulk-adjust-regular-prices"),c=document.getElementById("bulk-regular-price-options"),l=document.getElementById("bulk-regular-price-value"),d=document.getElementById("bulk-regular-price-method");r&&(r.checked=!1),c&&(c.style.display="none"),l&&(l.value=""),d&&(d.value="adjust");const u=document.getElementById("price-method-text"),p=document.getElementById("price-method-dropdown");u&&(u.textContent="Adjust by %"),p&&p.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected"),"percentage"===e.getAttribute("data-value")&&e.classList.add("selected")}));const g=document.getElementById("bulk-regular-adjustment-type");g&&(g.value="percentage");const h=document.querySelector(".price-slider-row");h&&(h.style.display="block");const m=document.getElementById("bulk-regular-adjustment");m&&(m.classList.remove("show-spinners","hide-spinners"),m.classList.add("hide-spinners"),m.value="0",m.setAttribute("data-clamped","true"));const y=document.querySelector('.price-slider-container[data-slider="regular"] .price-slider-cover'),f=document.querySelector('.price-slider-container[data-slider="regular"] .price-slider-handle'),v=document.querySelector('.price-slider-container[data-slider="regular"]');y&&f&&(y.style.width="50%",f.style.left="50%"),v&&v.removeAttribute("data-slider-initialized");const w=document.getElementById("bulk-adjust-sale-prices"),k=document.getElementById("bulk-sale-price-options");w&&(w.checked=!1),k&&(k.style.display="none"),document.querySelectorAll("#bulk-sale-price-options .three-way-toggle .toggle-option").forEach((e=>e.classList.remove("active")));const b=document.querySelector('#bulk-sale-price-options .three-way-toggle .toggle-option[data-value="unchanged"]');b&&b.classList.add("active");const C=document.getElementById("bulk-sale-status");C&&(C.value="unchanged");const S=document.getElementById("bulk-sale-adjustment");S&&(S.value="0");const E=document.getElementById("sale-price-method-text"),P=document.getElementById("sale-price-method-dropdown");E&&(E.textContent="Adjust by %"),P&&P.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected"),"percentage"===e.getAttribute("data-value")&&e.classList.add("selected")}));const I=document.getElementById("bulk-sale-adjustment-type"),L=document.getElementById("sale-price-unit");I&&(I.value="percentage"),L&&(L.textContent="%");const x=document.querySelector('.price-slider-container[data-slider="sale"] .price-slider-cover'),A=document.querySelector('.price-slider-container[data-slider="sale"] .price-slider-handle'),B=document.querySelector('.price-slider-container[data-slider="sale"]');x&&A&&(x.style.width="50%",A.style.left="50%"),B&&B.removeAttribute("data-slider-initialized");const T=document.getElementById("bulk-category-input");T&&(T.value="");const D=document.getElementById("bulk-category-add-dropdown"),M=document.getElementById("bulk-category-remove-dropdown");D&&(D.style.display="none"),M&&(M.style.display="none"),updateCategoryTags();const j=document.getElementById("bulk-tags-input");j&&(j.value="");const $=document.getElementById("bulk-status-select");if($){$.value="";const e=$.closest(".bulk-select")?.querySelector(".select-text");e&&(e.textContent="No change",e.classList.add("placeholder"))}const q=document.getElementById("bulk-product-status-toggle"),F=document.getElementById("bulk-product-status-options"),U=document.getElementById("bulk-scheduled-date-group"),N=document.getElementById("bulk-scheduled-date");q&&(q.checked=!1),F&&(F.style.display="none"),U&&(U.style.display="none"),N&&(N.value="",window.flatpickrInstances&&window.flatpickrInstances["bulk-scheduled-date"]&&window.flatpickrInstances["bulk-scheduled-date"].clear());const z=document.querySelector("#bulk-product-status-options .four-way-toggle");if(z){z.querySelectorAll(".toggle-option").forEach((e=>e.classList.remove("active")));const e=z.querySelector('.toggle-option[data-value="unchanged"]');e&&e.classList.add("active")}const H=document.getElementById("bulk-product-status");H&&(H.value="unchanged"),bulkChanges.scheduledDate=null;const R=document.getElementById("bulk-enable-stock-tracking"),O=document.getElementById("bulk-stock-controls"),V=document.getElementById("bulk-stock-action"),_=document.getElementById("bulk-stock-adjustment"),J=document.getElementById("bulk-stock-type");R&&(R.checked=!1),O&&(O.style.display="none"),V&&(V.value="adjust"),_&&(_.value="0"),J&&(J.value="limited");const W=document.querySelector("#bulk-stock-controls .two-way-toggle");if(W){W.querySelectorAll(".toggle-option").forEach((e=>e.classList.remove("active")));const e=W.querySelector('.toggle-option[data-value="limited"]');e&&e.classList.add("active")}const K=document.getElementById("stock-method-text"),Y=document.getElementById("stock-method-dropdown");K&&(K.textContent="Adjust by amount"),Y&&Y.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected"),"adjust"===e.getAttribute("data-value")&&e.classList.add("selected")}));const X=document.getElementById("bulk-stock-adjustment-group");X&&(X.style.display="block");const G=document.querySelector(".stock-slider-row");G&&(G.style.display="block");const Z=document.querySelector('.price-slider-container[data-slider="stock"] .price-slider-cover'),Q=document.querySelector('.price-slider-container[data-slider="stock"] .price-slider-handle'),ee=document.querySelector('.price-slider-container[data-slider="stock"]');Z&&Q&&(Z.style.width="50%",Q.style.left="50%"),ee&&ee.removeAttribute("data-stock-slider-initialized")}function initializeBulkTabs(){const e=document.querySelectorAll(".bulk-tab"),t=document.querySelectorAll(".tab-pane");e.forEach((n=>{n.addEventListener("click",(()=>{const o=n.getAttribute("data-tab");e.forEach((e=>e.classList.remove("active"))),t.forEach((e=>e.classList.remove("active"))),n.classList.add("active");const s=document.getElementById(`${o}-tab`);s&&s.classList.add("active")}))}))}function initializeBulkToggles(){const e=document.getElementById("bulk-round-prices"),t=document.getElementById("bulk-rounding-options");e&&e.addEventListener("change",(()=>{bulkChanges.enableRounding=e.checked,t&&(t.style.display=e.checked?"block":"none"),updatePreviewPane(),updateApplyAllButton()}));const n=document.getElementById("bulk-rounding-type"),o=document.getElementById("bulk-custom-ending");n&&n.addEventListener("change",(()=>{bulkChanges.roundingType=n.value,o&&(o.style.display="custom"===n.value?"block":"none"),updatePreviewPane(),updateApplyAllButton()}));const s=document.getElementById("bulk-custom-cents");s&&s.addEventListener("input",(()=>{const e=parseInt(s.value)||99;bulkChanges.customCents=e,updatePreviewPane(),updateApplyAllButton()}));const i=document.getElementById("bulk-adjust-regular-prices"),a=document.getElementById("bulk-regular-price-options");i&&i.addEventListener("change",(()=>{if(a&&(a.style.display=i.checked?"block":"none"),i.checked)setTimeout((()=>{initializeCustomSlider()}),100);else{const e=document.getElementById("bulk-regular-adjustment");e&&(e.value="0");const t=document.querySelector('.price-slider-container[data-slider="regular"] .price-slider-cover'),n=document.querySelector('.price-slider-container[data-slider="regular"] .price-slider-handle');t&&n&&(t.style.width="50%",n.style.left="50%")}updatePreviewPane()}));const r=document.getElementById("bulk-adjust-sale-prices"),c=document.getElementById("bulk-sale-price-options");r&&r.addEventListener("change",(()=>{if(c&&(c.style.display=r.checked?"block":"none"),r.checked)setTimeout((()=>{setupSalePriceSliderEventHandlers(),initializeSalePricingSlider()}),100);else{const e=document.getElementById("bulk-sale-price-value"),t=document.getElementById("bulk-sale-price-method");e&&(e.value=""),t&&(t.value="percentage");const n=document.getElementById("bulk-sale-keep-current"),o=document.getElementById("bulk-sale-enable"),s=document.getElementById("bulk-sale-disable");n&&(n.checked=!0),o&&(o.checked=!1),s&&(s.checked=!1),document.querySelectorAll(".three-way-toggle .toggle-option").forEach((e=>e.classList.remove("active")));const i=document.querySelector('.three-way-toggle .toggle-option[data-value="unchanged"]');i&&i.classList.add("active");const a=document.getElementById("bulk-sale-status");a&&(a.value="unchanged");const r=document.getElementById("bulk-sale-adjustment");r&&(r.value="0");const c=document.querySelector('.price-slider-container[data-slider="sale"] .price-slider-cover'),l=document.querySelector('.price-slider-container[data-slider="sale"] .price-slider-handle');c&&l&&(c.style.width="50%",l.style.left="50%")}updatePreviewPane()}));const l=document.getElementById("bulk-product-status-toggle"),d=document.getElementById("bulk-product-status-options");l&&l.addEventListener("change",(()=>{d&&(d.style.display=l.checked?"block":"none"),updatePreviewPane()}));const u=document.querySelector("#bulk-product-status-options .four-way-toggle");if(u){const e=u.querySelectorAll(".toggle-option"),t=document.getElementById("bulk-product-status"),n=document.getElementById("bulk-scheduled-date-group");e.forEach((o=>{o.addEventListener("click",(function(){e.forEach((e=>e.classList.remove("active"))),this.classList.add("active");const o=this.getAttribute("data-value");t&&(t.value=o),bulkChanges.newStatus=o,n&&(n.style.display="scheduled"===o?"block":"none","scheduled"===o&&window.flatpickrInstances&&window.flatpickrInstances["bulk-scheduled-date"]&&window.flatpickrInstances["bulk-scheduled-date"].redraw()),updatePreviewPane(),updateApplyAllButton()}))}))}const p=document.getElementById("bulk-scheduled-date");p&&p.addEventListener("change",(()=>{bulkChanges.scheduledDate=p.value,updatePreviewPane(),updateApplyAllButton()}));const g=document.getElementById("bulk-categories-toggle"),h=document.getElementById("bulk-categories-options");g&&g.addEventListener("change",(()=>{h&&(h.style.display=g.checked?"block":"none"),updatePreviewPane()}));const m=document.getElementById("bulk-category-input");document.getElementById("bulk-category-add-trigger"),document.getElementById("bulk-category-add-dropdown"),document.getElementById("bulk-category-remove-trigger"),document.getElementById("bulk-category-remove-dropdown"),m&&m.addEventListener("keypress",(e=>{if("Enter"===e.key){const e=m.value.trim();bulkChanges.categories||(bulkChanges.categories={toAdd:[],toRemove:[]}),e&&bulkChanges.categories&&bulkChanges.categories.toAdd&&!bulkChanges.categories.toAdd.includes(e)&&(bulkChanges.categories.toAdd.push(e),updateCategoryTags(),updatePreviewPane(),updateApplyAllButton(),m.value="")}}));const y=document.getElementById("bulk-tags-toggle"),f=document.getElementById("bulk-tags-options");y&&y.addEventListener("change",(()=>{f&&(f.style.display=y.checked?"block":"none"),updatePreviewPane()}));const v=document.getElementById("bulk-enable-stock-tracking"),w=document.getElementById("bulk-stock-controls");v&&v.addEventListener("change",(()=>{if(bulkChanges.enableStockTracking=v.checked,w&&(w.style.display=v.checked?"block":"none"),v.checked){bulkChanges.inventory||(bulkChanges.inventory={}),bulkChanges.inventory.stock||(bulkChanges.inventory.stock={});const e=document.querySelector("#bulk-stock-controls .two-way-toggle .toggle-option.active");e&&(bulkChanges.inventory.stock.type=e.getAttribute("data-value")||"limited");const t=document.getElementById("bulk-stock-action");t&&(bulkChanges.inventory.stock.method=t.value||"adjust")}else bulkChanges.inventory&&bulkChanges.inventory.stock&&delete bulkChanges.inventory.stock;v.checked&&setTimeout((()=>{initializeStockSlider()}),100),updatePreviewPane()}));const k=document.querySelector("#bulk-stock-controls .two-way-toggle");if(k){const e=k.querySelectorAll(".toggle-option"),t=document.getElementById("bulk-stock-type"),n=document.getElementById("bulk-stock-adjustment-group");e.forEach((o=>{o.addEventListener("click",(()=>{const s=o.getAttribute("data-value");if(e.forEach((e=>e.classList.remove("active"))),o.classList.add("active"),t&&(t.value=s),bulkChanges.inventory||(bulkChanges.inventory={}),bulkChanges.inventory.stock||(bulkChanges.inventory.stock={}),bulkChanges.inventory.stock.type=s,"limited"===s){n&&(n.style.display="block");const e=document.getElementById("bulk-stock-action");e&&(bulkChanges.inventory.stock.method=e.value||"adjust");const t=document.getElementById("bulk-stock-adjustment");t&&t.value&&(bulkChanges.inventory.stock.amount=parseFloat(t.value)||0);const o=document.getElementById("bulk-stock-action")?.value||"adjust",s=document.querySelector('.price-slider-row:has([data-slider="stock"])'),i=document.getElementById("stock-adjustment-tooltip");s&&(s.style.display="adjust"===o?"block":"none"),i&&(i.style.display="adjust"===o?"flex":"none"),setTimeout((()=>{initializeStockSlider()}),100)}else{n&&(n.style.display="none");const e=document.getElementById("stock-adjustment-tooltip");e&&(e.style.display="none"),delete bulkChanges.inventory.stock.method,delete bulkChanges.inventory.stock.amount}updatePreviewPane()}))}))}setupStockSliderEventHandlers();const b=document.getElementById("bulk-stock-adjustment");b&&b.addEventListener("input",(()=>{const e=parseFloat(b.value)||0;bulkChanges.inventory||(bulkChanges.inventory={}),bulkChanges.inventory.stock||(bulkChanges.inventory.stock={}),bulkChanges.inventory.stock.amount=e;const t=document.querySelector('.price-slider-container[data-slider="stock"] .price-slider-cover'),n=document.querySelector('.price-slider-container[data-slider="stock"] .price-slider-handle');if(t&&n){const o=(Math.max(-100,Math.min(100,e))+100)/200*100;t.style.width=`${o}%`,n.style.left=`${o}%`}updatePreviewPane()}));const C=document.getElementById("bulk-sku-toggle"),S=document.getElementById("bulk-sku-options");C&&C.addEventListener("change",(()=>{S&&(S.style.display=C.checked?"block":"none"),updatePreviewPane()}))}function initializeBulkControls(){const e=document.getElementById("bulk-regular-adjustment");e&&e.addEventListener("input",(function(){const e=parseFloat(this.value),t=bulkChanges.regularAdjustmentType||"percentage";isNaN(e)||0===e?(bulkChanges.priceAdjustment=null,bulkChanges.fixedPrice=null):"fixed-price"===t?(bulkChanges.fixedPrice=e,bulkChanges.priceAdjustment=null):(bulkChanges.priceAdjustment=e,bulkChanges.fixedPrice=null),updateApplyAllButton(),"function"==typeof updatePreviewPane&&updatePreviewPane()})),document.querySelectorAll('input[name="bulk-product-status"]').forEach((e=>{e.addEventListener("change",(function(){this.checked&&(bulkChanges.newStatus=this.value,updateApplyAllButton(),updatePreviewPane())}))})),document.querySelectorAll('input[name="bulk-sale-action"]').forEach((e=>{e.addEventListener("change",(function(){this.checked&&(bulkChanges.saleToggle=this.value,updateApplyAllButton(),updatePreviewPane())}))}));const t=document.querySelector(".three-way-toggle");if(t){const e=t.querySelectorAll(".toggle-option"),n=document.getElementById("bulk-sale-status");e.forEach((t=>{t.addEventListener("click",(function(){e.forEach((e=>e.classList.remove("active"))),this.classList.add("active");const t=this.getAttribute("data-value");n&&(n.value=t),bulkChanges.saleToggle="unchanged"===t?"keep-current":"on-sale"===t?"put-on-sale":"take-off-sale","put-on-sale"!==bulkChanges.saleToggle||bulkChanges.saleAdjustmentType||(bulkChanges.saleAdjustmentType="percentage");const o=document.getElementById("unchanged"===t?"bulk-sale-keep-current":"on-sale"===t?"bulk-sale-put-on":"bulk-sale-take-off");o&&(o.checked=!0),updateApplyAllButton(),updatePreviewPane()}))}))}const n=document.querySelector(".four-way-toggle");if(n){const e=n.querySelectorAll(".toggle-option"),t=document.getElementById("bulk-rounding-type"),o=document.getElementById("bulk-custom-ending"),s=document.getElementById("bulk-rounding-description-text");e.forEach((n=>{n.addEventListener("click",(function(){e.forEach((e=>e.classList.remove("active"))),this.classList.add("active");const n=this.getAttribute("data-value");if(t&&(t.value=n),bulkChanges.roundingType=n,o&&(o.style.display="custom"===n?"block":"none"),s)switch(n){case"whole":s.textContent="Round to the nearest dollar (e.g. $24.60 becomes $25)";break;case".99":s.textContent="Round to end in .99 (e.g. $24.60 becomes $24.99)";break;case".95":s.textContent="Round to end in .95 (e.g. $24.60 becomes $24.95)";break;case"custom":s.textContent="Round to your custom ending"}e.forEach((e=>{switch(e.getAttribute("data-value")){case"whole":e.setAttribute("title","Round to nearest dollar (e.g., $24.60 becomes $25)");break;case".99":e.setAttribute("title","Round to the nearest .99 (e.g. $24.60 becomes $24.99)");break;case".95":e.setAttribute("title","Round to the nearest .95 (e.g. $24.60 becomes $24.95)");break;case"custom":e.setAttribute("title","Round to custom cents value")}})),updateApplyAllButton(),updatePreviewPane()}))}))}const o=document.querySelector("#bulk-rounding-options .three-way-toggle");if(o){const e=o.querySelectorAll(".toggle-option"),t=document.getElementById("bulk-rounding-target");e.forEach((n=>{n.addEventListener("click",(function(){e.forEach((e=>e.classList.remove("active"))),this.classList.add("active");const n=this.getAttribute("data-value");t&&(t.value=n),bulkChanges.roundingTarget=n,updateApplyAllButton(),updatePreviewPane()}))}))}const s=document.getElementById("bulk-regular-adjustment-type");s&&s.addEventListener("change",(function(){bulkChanges.regularAdjustmentType=this.value,updateApplyAllButton()}));const i=document.getElementById("bulk-stock-amount");i&&i.addEventListener("input",(function(){bulkChanges.stockAmount=parseInt(this.value)||0,updateApplyAllButton()}));const a=document.getElementById("bulk-stock-action");a&&a.addEventListener("change",(function(){bulkChanges.stockAction=this.value;const e=document.getElementById("bulk-stock-amount-group");e&&(e.style.display="unlimited"===this.value||"none"===this.value?"none":"block"),updateApplyAllButton()})),document.querySelectorAll('input[name="bulk-product-status"]').forEach((e=>{e.addEventListener("change",(function(){this.checked&&(bulkChanges.newStatus=this.value,updateApplyAllButton())}))}))}function initializeCustomSlider(){function e(e,t=!1){r=a&&a.hasAttribute("data-clamped")?Math.max(-99,Math.min(100,e)):e,function(e){const t=(e+99)/199*100;s&&(s.style.width=100-t+"%"),i&&(i.style.left=t+"%"),"function"==typeof updatePreviewPane&&updatePreviewPane()}(r),a&&(a.value=r,t||a.dispatchEvent(new Event("input"))),t||updatePreviewPane()}function t(e){const t=o.getBoundingClientRect(),n=Math.max(0,Math.min(1,((e.touches?e.touches[0].clientX:e.clientX)-t.left)/t.width));return Math.round(199*n-99)}const n=document.querySelector('.price-slider-container[data-slider="regular"]'),o=n?.querySelector(".price-slider-track"),s=n?.querySelector(".price-slider-cover"),i=n?.querySelector(".price-slider-handle"),a=document.getElementById("bulk-regular-adjustment");document.getElementById("price-unit"),document.getElementById("price-method-trigger"),document.getElementById("price-method-dropdown"),document.getElementById("price-method-text");let r=0,c=!1;n&&i&&s&&(null!==n.offsetParent||"none"!==getComputedStyle(n).display?n.hasAttribute("data-slider-initialized")||(n.setAttribute("data-slider-initialized","true"),n.addEventListener("mousedown",(n=>{n.preventDefault(),c=!0,e(t(n))})),document.addEventListener("mousemove",(n=>{c&&(n.preventDefault(),e(t(n)))})),document.addEventListener("mouseup",(()=>{c&&(c=!1)})),n.addEventListener("touchstart",(n=>{n.preventDefault(),c=!0,e(t(n))})),document.addEventListener("touchmove",(n=>{c&&(n.preventDefault(),e(t(n)))})),document.addEventListener("touchend",(()=>{c&&(c=!1)})),e(0,!0),setupPriceSliderEventHandlers(),setupSalePriceSliderEventHandlers(),initializeSalePricingSlider()):setTimeout((()=>{initializeCustomSlider()}),200))}function updatePriceUnit(e){const t=document.getElementById("price-unit");if(t)switch(e){case"percentage":default:t.textContent="%";break;case"fixed-adjustment":case"fixed-price":t.textContent=window.getSystemCurrency()||""}}function setupPriceSliderEventHandlers(){const e=document.getElementById("bulk-regular-adjustment"),t=document.getElementById("price-method-trigger"),n=document.getElementById("price-method-dropdown"),o=document.getElementById("price-method-text");e&&e.addEventListener("input",(e=>{const t=parseInt(e.target.value)||0;let n;n=e.target.hasAttribute("data-clamped")?Math.max(-99,Math.min(100,t)):t;const o=document.querySelector(".price-slider-cover"),s=document.querySelector(".price-slider-handle");if(o&&s){const e=(n+99)/199*100;o.style.width=100-e+"%",s.style.left=e+"%"}updatePreviewPane()})),t&&n&&(t.removeEventListener("click",t._clickHandler),n.removeEventListener("click",n._clickHandler),t._clickHandler=()=>{n.classList.toggle("active"),t.classList.toggle("active")},n._clickHandler=e=>{if(e.target.classList.contains("select-option")){const s=e.target.getAttribute("data-value"),i=e.target.textContent;n.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")})),e.target.classList.add("selected"),o&&(o.textContent=i);const a=document.getElementById("bulk-regular-adjustment-type");a&&(a.value=s,a.dispatchEvent(new Event("change"))),updatePriceUnit(s),n.classList.remove("active"),t.classList.remove("active"),updatePreviewPane()}},t.addEventListener("click",t._clickHandler),n.addEventListener("click",n._clickHandler));const s=document.getElementById("bulk-regular-adjustment-type");s&&s.addEventListener("change",(()=>{const e=s.value;bulkChanges.regularAdjustmentType=e;const t=document.getElementById("bulk-regular-adjustment");if(t&&t.value){const n=parseFloat(t.value);isNaN(n)||0===n||("fixed-price"===e?(bulkChanges.fixedPrice=n,bulkChanges.priceAdjustment=null):(bulkChanges.priceAdjustment=n,bulkChanges.fixedPrice=null))}if(t)switch(e){case"percentage":t.placeholder="10 (for +10%)",t.step="1",t.setAttribute("data-clamped","true");break;case"fixed-adjustment":t.placeholder="5 (for +$5)",t.step="0.01",t.removeAttribute("data-clamped");break;case"fixed-price":t.placeholder="29.99 (set to $29.99)",t.step="1",t.removeAttribute("data-clamped")}const n=document.querySelector(".price-slider-row");n&&(n.style.display="fixed-price"===e?"none":"block"),t&&(t.classList.remove("show-spinners","hide-spinners"),t.classList.add("hide-spinners"),t.value=0,bulkChanges.priceAdjustment=0,setTimeout((()=>{const e=document.querySelector('.price-slider-container[data-slider="regular"] .price-slider-cover'),t=document.querySelector('.price-slider-container[data-slider="regular"] .price-slider-handle');e&&t&&(e.style.width="50%",t.style.left="50%")}),10));const o=document.querySelector(".price-adjustment-tooltip");o&&(o.style.display="fixed-adjustment"===e?"flex":"none"),updateApplyAllButton(),"function"==typeof updatePreviewPane&&updatePreviewPane()}))}function setupSalePriceSliderEventHandlers(){const e=document.getElementById("bulk-sale-adjustment"),t=document.getElementById("sale-price-method-trigger"),n=document.getElementById("sale-price-method-dropdown"),o=document.getElementById("sale-price-method-text");e&&e.addEventListener("input",(e=>{const t=parseFloat(e.target.value)||0;bulkChanges.saleDiscount=t,bulkChanges.saleAdjustmentType||(bulkChanges.saleAdjustmentType="percentage"),bulkChanges.saleAdjustmentType||(bulkChanges.saleAdjustmentType="percentage"),updateApplyAllButton(),updatePreviewPane()})),t&&n&&(t.removeEventListener("click",t._clickHandler),n.removeEventListener("click",n._clickHandler),t._clickHandler=()=>{n.classList.toggle("active"),t.classList.toggle("active")},n._clickHandler=e=>{if(e.target.classList.contains("select-option")){const s=e.target.getAttribute("data-value"),i=e.target.textContent;n.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")})),e.target.classList.add("selected"),o&&(o.textContent=i);const a=document.getElementById("bulk-sale-adjustment-type");a&&(a.value=s,a.dispatchEvent(new Event("change"))),updateSalePriceUnit(s),n.classList.remove("active"),t.classList.remove("active"),updatePreviewPane()}},t.addEventListener("click",t._clickHandler),n.addEventListener("click",n._clickHandler));const s=document.getElementById("bulk-sale-adjustment-type");s&&s.addEventListener("change",(()=>{const e=s.value;bulkChanges.saleAdjustmentType=e;const t=document.getElementById("bulk-sale-adjustment");if(t)switch(e){case"percentage":t.placeholder="25 (for 25% off)",t.step="1",t.setAttribute("data-clamped","true");break;case"fixed-adjustment":t.placeholder="-25 (for $25 off)",t.step="0.01",t.removeAttribute("data-clamped");break;case"fixed-price":t.placeholder="19.99 (set to $19.99)",t.step="0.01",t.removeAttribute("data-clamped")}const n=document.querySelector(".sale-adjustment-tooltip");n&&(n.style.display="flex"),updateApplyAllButton(),"function"==typeof updatePreviewPane&&updatePreviewPane()})),updateSalePriceUnit("percentage")}function updateSalePriceUnit(e){const t=document.getElementById("sale-price-unit"),n=document.getElementById("bulk-sale-adjustment"),o=document.querySelector('.price-slider-container[data-slider="sale"]'),s=document.getElementById("sale-adjustment-tooltip");if(t){switch(e){case"percentage":default:t.textContent="%";break;case"fixed-adjustment":case"fixed-price":t.textContent=window.getSystemCurrency()||""}o&&(o.style.display="fixed-price"===e?"none":"block"),n&&(n.classList.remove("show-spinners","hide-spinners"),n.classList.add("hide-spinners"),n.value=0,bulkChanges.saleDiscount=0,setTimeout((()=>{const e=document.querySelector('.price-slider-container[data-slider="sale"] .price-slider-cover'),t=document.querySelector('.price-slider-container[data-slider="sale"] .price-slider-handle');e&&t&&(e.style.width="50%",t.style.left="50%")}),10),"fixed-price"===e?n.removeAttribute("data-clamped"):n.setAttribute("data-clamped","true")),s&&(s.style.display="flex")}}function setupStockSliderEventHandlers(){const e=document.getElementById("stock-method-trigger"),t=document.getElementById("stock-method-dropdown"),n=document.getElementById("stock-method-text"),o=document.getElementById("bulk-stock-action"),s=document.querySelector('[data-slider="stock"]')?.closest(".price-slider-row");e&&t&&(e.removeEventListener("click",e._clickHandler),t.removeEventListener("click",t._clickHandler),e._clickHandler=n=>{n.stopPropagation(),t.classList.toggle("active"),e.classList.toggle("active")},t._clickHandler=i=>{if(i.target.classList.contains("select-option")){const a=i.target.getAttribute("data-value"),r=i.target.textContent;t.querySelectorAll(".select-option").forEach((e=>e.classList.remove("selected"))),i.target.classList.add("selected"),n&&(n.textContent=r),o&&(o.value=a),bulkChanges.inventory||(bulkChanges.inventory={}),bulkChanges.inventory.stock||(bulkChanges.inventory.stock={}),bulkChanges.inventory.stock.method=a,s&&(s.style.display="adjust"===a?"block":"none");const c=document.getElementById("stock-adjustment-tooltip");c&&(c.style.display="adjust"===a?"flex":"none"),t.classList.remove("active"),e.classList.remove("active"),updatePreviewPane()}},e.addEventListener("click",e._clickHandler),t.addEventListener("click",t._clickHandler),document.addEventListener("click",(n=>{e.contains(n.target)||t.contains(n.target)||(t.classList.remove("active"),e.classList.remove("active"))})))}function initializeSalePricingSlider(){function e(e){let t;t=a&&a.hasAttribute("data-clamped")?Math.max(-99,Math.min(100,e)):e;const n=(Math.max(-99,Math.min(100,t))+99)/199*100;s.style.width=100-n+"%",i.style.left=n+"%",a.value=t,bulkChanges.saleDiscount=t,bulkChanges.saleAdjustmentType||(bulkChanges.saleAdjustmentType="percentage"),updateApplyAllButton(),updatePreviewPane()}function t(t){t.preventDefault();const n=o.getBoundingClientRect(),s=Math.max(0,Math.min(100,(t.clientX-n.left)/n.width*100));e(Math.round(s/100*199-99))}const n=document.querySelector('.price-slider-container[data-slider="sale"]'),o=n?.querySelector(".price-slider-track"),s=n?.querySelector(".price-slider-cover"),i=n?.querySelector(".price-slider-handle"),a=document.getElementById("bulk-sale-adjustment");if(!(n&&o&&s&&i&&a))return;if(n.hasAttribute("data-sale-slider-initialized"))return;n.setAttribute("data-sale-slider-initialized","true");let r=!1;o.addEventListener("mousedown",(e=>{r=!0,t(e)})),document.addEventListener("mousemove",(e=>{r&&t(e)})),document.addEventListener("mouseup",(()=>{r=!1})),a.addEventListener("input",(t=>{e(parseInt(t.target.value)||0)})),e(bulkChanges.saleDiscount||0)}function initializeCustomDropdowns(){document.querySelectorAll(".bulk-select, .bulk-select-inline").forEach((e=>{const t=e.querySelector(".select-trigger"),n=e.querySelector(".select-dropdown"),o=e.querySelectorAll(".select-option"),s=e.querySelector("select"),i=e.querySelector(".select-text"),a=e.querySelector(".select-arrow");t&&n&&s&&(t.addEventListener("click",(e=>{e.stopPropagation(),document.querySelectorAll(".select-dropdown.open").forEach((e=>{e!==n&&(e.classList.remove("open"),e.parentNode.querySelector(".select-arrow").classList.remove("open"),e.parentNode.querySelector(".select-trigger").classList.remove("focused"))})),n.classList.toggle("open"),a.classList.toggle("open"),t.classList.toggle("focused")})),o.forEach((e=>{e.addEventListener("click",(r=>{r.stopPropagation();const c=e.getAttribute("data-value"),l=e.textContent;s.value=c,i.textContent=l,i.classList.remove("placeholder"),o.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),n.classList.remove("open"),a.classList.remove("open"),t.classList.remove("focused"),s.dispatchEvent(new Event("change"))}))})))})),document.addEventListener("click",(()=>{document.querySelectorAll(".select-dropdown.open").forEach((e=>{e.classList.remove("open"),e.parentNode.querySelector(".select-arrow").classList.remove("open"),e.parentNode.querySelector(".select-trigger").classList.remove("focused")}))}))}function initializeStockSlider(){function e(e,t=!1){l=Math.max(-100,Math.min(100,e)),function(e){const t=(e+100)/200*100;a&&(a.style.width=100-t+"%"),r&&(r.style.left=t+"%"),"function"==typeof updatePreviewPane&&updatePreviewPane()}(l),c&&!t&&(c.value=l,bulkChanges.inventory||(bulkChanges.inventory={}),bulkChanges.inventory.stock||(bulkChanges.inventory.stock={}),bulkChanges.inventory.stock.amount=l)}function t(t){const n=i.getBoundingClientRect(),o=Math.max(0,Math.min(n.width,t-n.left));e(Math.round(o/n.width*200-100))}function n(e){e.preventDefault(),d=!0,document.body.style.userSelect="none",t(e.clientX)}function o(e){e.preventDefault(),d=!0,t(e.touches[0].clientX)}const s=document.querySelector('.price-slider-container[data-slider="stock"]'),i=s?.querySelector(".price-slider-track"),a=s?.querySelector(".price-slider-cover"),r=s?.querySelector(".price-slider-handle"),c=document.getElementById("bulk-stock-adjustment");let l=0,d=!1;s&&r&&a&&(null!==s.offsetParent||"none"!==getComputedStyle(s).display?s.hasAttribute("data-stock-slider-initialized")||(s.setAttribute("data-stock-slider-initialized","true"),r.addEventListener("mousedown",n),i.addEventListener("mousedown",n),document.addEventListener("mousemove",(function(e){d&&(e.preventDefault(),t(e.clientX))})),document.addEventListener("mouseup",(function(){d&&(d=!1,document.body.style.userSelect="")})),r.addEventListener("touchstart",o),i.addEventListener("touchstart",o),document.addEventListener("touchmove",(function(e){d&&(e.preventDefault(),t(e.touches[0].clientX))})),document.addEventListener("touchend",(function(){d&&(d=!1)})),c&&c.addEventListener("input",(function(){const t=parseInt(this.value)||0;bulkChanges.inventory||(bulkChanges.inventory={}),bulkChanges.inventory.stock||(bulkChanges.inventory.stock={}),bulkChanges.inventory.stock.amount=t,e(t,!0)})),e(l)):setTimeout((()=>{initializeStockSlider()}),200))}function initializeCategoryControls(){let e=0;!function t(){const n=document.getElementById("bulk-category-add-trigger"),o=document.getElementById("bulk-category-add-dropdown"),s=document.getElementById("bulk-category-remove-trigger"),i=document.getElementById("bulk-category-remove-dropdown"),a=document.getElementById("bulk-category-input");return n&&o&&s&&i?(n.addEventListener("click",(function(e){e.stopPropagation(),i&&(i.style.display="none"),o.style.display="block"===o.style.display?"none":"block"})),s.addEventListener("click",(function(e){e.stopPropagation(),o&&(o.style.display="none");const t="block"===i.style.display;i.style.display=t?"none":"block",t||(document.querySelectorAll('.mix input[type="checkbox"]:checked').forEach((e=>{e.closest("tr")})),populateRemoveCategoryDropdown())})),o.addEventListener("click",(function(e){if(e.stopPropagation(),e.target.classList.contains("select-option")){const t=e.target.getAttribute("data-value");t&&bulkChanges.categories&&bulkChanges.categories.toAdd&&!bulkChanges.categories.toAdd.includes(t)&&(bulkChanges.categories.toAdd.push(t),updateCategoryTags(),updatePreviewPane(),updateApplyAllButton(),o.style.display="none")}})),i.addEventListener("click",(function(e){if(e.stopPropagation(),e.target.classList.contains("select-option")&&!e.target.classList.contains("disabled")){const t=e.target.getAttribute("data-value");t&&!bulkChanges.categories.toRemove.includes(t)&&(bulkChanges.categories.toRemove.push(t),updateCategoryTags(),updatePreviewPane(),updateApplyAllButton(),i.style.display="none")}})),a&&a.addEventListener("keypress",(function(e){if("Enter"===e.key){const e=a.value.trim();bulkChanges.categories||(bulkChanges.categories={toAdd:[],toRemove:[]}),e&&bulkChanges.categories&&bulkChanges.categories.toAdd&&!bulkChanges.categories.toAdd.includes(e)&&(bulkChanges.categories.toAdd.push(e),updateCategoryTags(),updatePreviewPane(),updateApplyAllButton(),a.value="")}})),document.addEventListener("click",(function(e){!o||n.contains(e.target)||o.contains(e.target)||(o.style.display="none"),!i||s.contains(e.target)||i.contains(e.target)||(i.style.display="none")})),!0):(e++,e<10&&setTimeout(t,200),!1)}()}function initializeProductManager(){setupGlobalEventListeners(),initializeDataStructures(),"function"==typeof initializeNotifications&&initializeNotifications()}function setupGlobalEventListeners(){window.addEventListener("beforeunload",(function(e){if(changedProducts.size>0)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue})),document.addEventListener("keydown",handleKeyboardShortcuts)}function initializeDataStructures(){globalProductsData||(globalProductsData=[]),changedProducts||(changedProducts=new Set),originalData||(originalData=new Map),urlRedirects||(urlRedirects=new Map),undoHistory||(undoHistory=[])}function handleKeyboardShortcuts(e){if((e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),changedProducts.size>0)){const e=document.getElementById("save-changes");e&&!e.disabled&&e.click()}if("Escape"===e.key&&closeAllModals(),(e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey){e.preventDefault();const t=document.getElementById("undo-changes-btn");t&&!t.disabled&&t.click()}}function closeAllModals(){const e=document.getElementById("bulk-adjust-drawer");if(e&&e.classList.contains("visible")){const e=document.getElementById("bulk-drawer-close");e&&e.click()}const t=document.getElementById("undo-changes-drawer");if(t&&t.classList.contains("visible")){const e=document.getElementById("undo-drawer-close");e&&e.click()}const n=document.getElementById("url-suggestion-tooltip");if(n&&!n.classList.contains("hidden")){const e=document.getElementById("url-suggestion-close");e&&e.click()}}function initializeFileManagement(){initializePresetFileManagement(),initializeImportExport()}function initializePresetFileManagement(){initializeFileUploadHandlers(),loadPresetsFromFile()}function initializeFileUploadHandlers(){const e=document.getElementById("preset-file-input"),t=document.getElementById("upload-preset-file");e&&e.addEventListener("change",handlePresetFileUpload),t&&t.addEventListener("click",(()=>{e?.click()}))}async function handlePresetFileUpload(e){const t=e.target.files[0];if(t){try{const e=await readFileAsText(t),n=JSON.parse(e);if(!validatePresetStructure(n))throw new Error("Invalid preset file format");Object.assign(window.savedPresets,n),savePresets(),await uploadPresetsToServer(window.savedPresets),populatePresetDropdown(),showMessage(`Successfully imported ${Object.keys(n).length} presets`,"success")}catch(e){showMessage("Error importing presets: "+e.message,"error")}e.target.value=""}}function readFileAsText(e){return new Promise(((t,n)=>{const o=new FileReader;o.onload=e=>t(e.target.result),o.onerror=e=>n(e),o.readAsText(e)}))}function validatePresetStructure(e){if("object"!=typeof e||null===e)return!1;for(const[t,n]of Object.entries(e))if(!n.name||!n.settings||"object"!=typeof n.settings)return!1;return!0}async function loadPresetsFromFile(){try{const e=getJsonFileUrl();if(!e)return;const t=await fetch(e);if(t.ok){const e=await t.json();Object.assign(window.savedPresets,e),populatePresetDropdown()}}catch(e){}}function getJsonFileUrl(){const e=document.querySelector('meta[name="sh-preset-file-url"]');return e?e.getAttribute("content"):null}function extractFileIdFromUrl(e){if(!e)return null;const t=e.match(/\/([a-f0-9]{32})\//);return t?t[1]:null}async function deleteOldJsonFile(e){if(!e)return;const t=extractFileIdFromUrl(e);if(t)try{const e=getCsrfToken();if(!e)throw new Error("No CSRF token found");await fetch("/api/asset/DeleteAsset",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({crumb:e,assetId:t})})}catch(e){}}async function uploadJsonToCssAssetsForPresets(e,t,n="Upload file"){const o=showLoadingMessage(n+"...");try{const n=getCsrfToken();if(!n)throw new Error("No CSRF token found");const s=new FormData,i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});s.append("crumb",n),s.append("assetType","css"),s.append("filename",e),s.append("file",i,e);const a=await fetch("/api/asset/UploadAsset",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:s});if(!a.ok)throw new Error(`Upload failed with status ${a.status}`);const r=await a.json();if(hideLoadingMessage(o),r.assetUrl)return r.assetUrl;throw new Error("No asset URL returned")}catch(e){throw hideLoadingMessage(o),e}}async function updateMetaTagWithJsonUrl(e){try{const t=document.querySelector('meta[name="sh-preset-file-url"]');t&&t.remove();const n=document.createElement("meta");n.name="sh-preset-file-url",n.content=e,document.head.appendChild(n)}catch(e){}}async function savePresetsFile(e,t="Save presets"){try{const n=getJsonFileUrl(),o=`sh-presets-${(new Date).toISOString().replace(/[:.]/g,"-")}.json`,s=await uploadJsonToCssAssetsForPresets(o,e,t);return await updateMetaTagWithJsonUrl(s),n&&n!==s&&await deleteOldJsonFile(n),showMessage("Presets saved successfully","success"),s}catch(e){throw showMessage("Error saving presets: "+e.message,"error"),e}}async function uploadPresetsToServer(e){return savePresetsFile(e,"Upload presets")}function initializeImportExport(){const e=document.getElementById("export-presets-btn"),t=document.getElementById("import-presets-btn"),n=document.getElementById("export-products-btn"),o=document.getElementById("import-products-btn");e&&e.addEventListener("click",exportPresets),t&&t.addEventListener("click",(()=>{const e=document.getElementById("preset-file-input");e?.click()})),n&&n.addEventListener("click",exportProducts),o&&o.addEventListener("click",importProducts)}function exportPresets(){try{const e=`squarehero-presets-${(new Date).toISOString().split("T")[0]}.json`;downloadJSON(window.savedPresets,e),showMessage("Presets exported successfully","success")}catch(e){showMessage("Error exporting presets","error")}}function exportProducts(){try{if(!globalProductsData||0===globalProductsData.length)return void showMessage("No products to export","warning");const e=globalProductsData.map((e=>({"Product ID":e.id,Title:e.title,SKU:e.sku,Price:e.price,"Sale Price":e.salePrice||"",Stock:e.stock||"",Status:e.status,Categories:e.categories?e.categories.join(", "):"",Tags:e.tags?e.tags.join(", "):"",Description:e.description||"",URL:e.url||""})));downloadCSV(e,`squarehero-products-${(new Date).toISOString().split("T")[0]}.csv`),showMessage(`Exported ${e.length} products successfully`,"success")}catch(e){showMessage("Error exporting products","error")}}function importProducts(){showMessage("Product import functionality coming soon","info")}async function fetchPresets(){try{const e=getJsonFileUrl();if(!e)return getDefaultPresets();const t=(new Date).getTime(),n=await fetch(`${e}?cb=${t}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}catch(e){return getDefaultPresets()}}function savePresetsWithUpload(){savePresets(),debouncedAutoSave()}function validateFileSize(e,t=1){if(e.size>1024*t*1024)throw new Error(`File size exceeds ${t}MB limit`);return!0}function getFileExtension(e){return e.split(".").pop().toLowerCase()}function validateFileType(e,t=["json"]){const n=getFileExtension(e.name);if(!t.includes(n))throw new Error(`File type .${n} not allowed. Allowed types: ${t.join(", ")}`);return!0}function initializeNotificationSystem(){createNotificationContainer(),initializeNotificationAutoHide()}function createNotificationContainer(){if(!document.getElementById("sh-notifications")){const e=document.createElement("div");e.id="sh-notifications",e.className="sh-notifications-container",document.body.appendChild(e)}}function showMessage(e,t="info",n=5e3){const o=document.getElementById("sh-notifications");if(!o)return;const s=document.createElement("div");return s.className=`sh-notification sh-notification-${t}`,s.innerHTML=`\n        <div class="sh-notification-content">\n            <div class="sh-notification-icon">\n                ${getNotificationIcon(t)}\n            </div>\n            <div class="sh-notification-message">${e}</div>\n            <button class="sh-notification-close" onclick="hideNotification(this.parentElement)">\n                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">\n                    <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                </svg>\n            </button>\n        </div>\n    `,o.appendChild(s),setTimeout((()=>{s.classList.add("show")}),10),n>0&&setTimeout((()=>{hideNotification(s)}),n),s}function hideNotification(e){e&&e.parentElement&&(e.classList.add("hiding"),setTimeout((()=>{e.parentElement&&e.parentElement.removeChild(e)}),300))}function getNotificationIcon(e){switch(e){case"success":return'<svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <path d="M13.5 4.5L6 12L2.5 8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>';case"error":return'<svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n            </svg>';case"warning":return'<svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <path d="M8 1L15 14H1L8 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M8 5V9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                <circle cx="8" cy="12" r="1" fill="currentColor"/>\n            </svg>';default:return'<svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>\n                <path d="M8 11V8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                <circle cx="8" cy="5" r="1" fill="currentColor"/>\n            </svg>'}}function initializeNotificationAutoHide(){document.addEventListener("click",(function(e){e.target.closest(".sh-notification")||e.target.closest(".sh-notifications-container")||document.querySelectorAll(".sh-notification.show").forEach((e=>{e.classList.contains("persistent")||hideNotification(e)}))}))}function showLoadingMessage(e="Loading..."){const t=showMessage(e,"info",0);return t.classList.add("loading"),t.querySelector(".sh-notification-icon").innerHTML='\n        <div class="sh-spinner">\n            <div class="sh-spinner-circle"></div>\n        </div>\n    ',t}function hideLoadingMessage(e){e&&hideNotification(e)}function showProgressNotification(e,t=0){const n=showMessage("","info",0);return n.classList.add("progress"),n.querySelector(".sh-notification-content").innerHTML=`\n        <div class="sh-notification-icon">\n            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>\n                <path d="M8 11V8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                <circle cx="8" cy="5" r="1" fill="currentColor"/>\n            </svg>\n        </div>\n        <div class="sh-notification-message">\n            <div class="sh-progress-text">${e}</div>\n            <div class="sh-progress-bar">\n                <div class="sh-progress-fill" style="width: ${t}%"></div>\n            </div>\n        </div>\n        <button class="sh-notification-close" onclick="hideNotification(this.parentElement.parentElement)">\n            <svg width="12" height="12" viewBox="0 0 12 12" fill="none">\n                <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n            </svg>\n        </button>\n    `,n}function updateProgressNotification(e,t,n){if(!e)return;const o=e.querySelector(".sh-progress-text"),s=e.querySelector(".sh-progress-fill");o&&(o.textContent=t),s&&(s.style.width=`${n}%`)}function showConfirmation(e,t,n){const o=showMessage("","warning",0);o.classList.add("confirmation"),o.querySelector(".sh-notification-content").innerHTML=`\n        <div class="sh-notification-icon">\n            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">\n                <path d="M8 1L15 14H1L8 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                <path d="M8 5V9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                <circle cx="8" cy="12" r="1" fill="currentColor"/>\n            </svg>\n        </div>\n        <div class="sh-notification-message">${e}</div>\n        <div class="sh-notification-actions">\n            <button class="sh-btn sh-btn-danger sh-btn-sm confirm-yes">Yes</button>\n            <button class="sh-btn sh-btn-secondary sh-btn-sm confirm-no">No</button>\n        </div>\n    `;const s=o.querySelector(".confirm-yes"),i=o.querySelector(".confirm-no");return s&&s.addEventListener("click",(()=>{hideNotification(o),t&&t()})),i&&i.addEventListener("click",(()=>{hideNotification(o),n&&n()})),o}function clearAllNotifications(){const e=document.getElementById("sh-notifications");e&&e.querySelectorAll(".sh-notification").forEach((e=>{hideNotification(e)}))}function showBatchStatus(e,t,n){const o=Math.round(t/n*100);return showProgressNotification(`${e}: ${t}/${n} (${o}%)`,o)}function showApiError(e,t="perform operation"){let n=`Failed to ${t}`;return e&&e.message?n+=`: ${e.message}`:"string"==typeof e&&(n+=`: ${e}`),showMessage(n,"error",8e3)}function initializePresetSystem(){loadPresets(),initializePresetControls(),populatePresetDropdown()}function loadPresets(){try{const e=localStorage.getItem(PRESET_STORAGE_KEY);e?window.savedPresets=JSON.parse(e):(window.savedPresets=getDefaultPresets(),savePresets())}catch(e){window.savedPresets=getDefaultPresets()}}function savePresets(){try{localStorage.setItem(PRESET_STORAGE_KEY,JSON.stringify(window.savedPresets))}catch(e){showMessage("Failed to save presets","error")}}function getDefaultPresets(){return{"price-increase-10":{name:"10% Price Increase",description:"Increase all prices by 10%",settings:{priceAdjustment:10,regularAdjustmentType:"percentage",applyToSale:!0,enableRounding:!0,roundingType:"whole"}},"price-decrease-15":{name:"15% Price Decrease",description:"Decrease all prices by 15%",settings:{priceAdjustment:-15,regularAdjustmentType:"percentage",applyToSale:!0,enableRounding:!0,roundingType:"whole"}},"round-prices":{name:"Round Prices",description:"Round all prices to whole numbers",settings:{enableRounding:!0,roundingType:"whole"}},"enable-sale-25":{name:"25% Sale",description:"Enable 25% sale on all products",settings:{saleToggle:"set-discount",saleDiscount:25}},"disable-all-sales":{name:"Disable Sales",description:"Remove sale prices from all products",settings:{saleToggle:"disable"}},"set-in-stock":{name:"Set In Stock",description:"Set all products as in stock with inventory tracking",settings:{enableStockTracking:!0,stockAction:"set",stockAmount:100}}}}function initializePresetControls(){const e=document.getElementById("bulk-preset-select");e&&e.addEventListener("change",applyPreset);const t=document.getElementById("save-preset-btn");t&&t.addEventListener("click",showSavePresetDialog);const n=document.getElementById("manage-presets-btn");n&&n.addEventListener("click",showManagePresetsDialog)}function populatePresetDropdown(){const e=document.getElementById("bulk-preset-select");if(e){for(;e.children.length>1;)e.removeChild(e.lastChild);Object.keys(window.savedPresets).forEach((t=>{const n=window.savedPresets[t],o=document.createElement("option");o.value=t,o.textContent=n.name,o.title=n.description,e.appendChild(o)}))}}function applyPreset(){const e=document.getElementById("bulk-preset-select");if(!e||!e.value)return;const t=window.savedPresets[e.value];t&&(resetBulkChanges(),Object.assign(bulkChanges,t.settings),updateBulkUIFromSettings(),updateApplyAllButton(),showMessage(`Applied preset: ${t.name}`,"success"))}function updateBulkUIFromSettings(){if(null!==bulkChanges.priceAdjustment){const e=document.getElementById("bulk-adjust-regular-prices"),t=document.getElementById("bulk-regular-adjustment"),n=document.getElementById("bulk-regular-adjustment-type"),o=document.getElementById("bulk-regular-price-options");e&&(e.checked=!0),t&&(t.value=bulkChanges.priceAdjustment),n&&(n.value=bulkChanges.regularAdjustmentType||"percentage"),o&&(o.style.display="block")}if("no-change"!==bulkChanges.saleToggle){const e=document.getElementById("bulk-adjust-sale-prices"),t=document.getElementById("bulk-sale-price-options"),n=document.querySelectorAll('input[name="bulk-sale-toggle"]');e&&(e.checked=!0),t&&(t.style.display="block"),n.forEach((e=>{e.value===bulkChanges.saleToggle&&(e.checked=!0)}))}if(bulkChanges.enableRounding){const e=document.getElementById("bulk-round-prices"),t=document.getElementById("bulk-rounding-options"),n=document.getElementById("bulk-rounding-type");e&&(e.checked=!0),t&&(t.style.display="block"),n&&(n.value=bulkChanges.roundingType||"whole")}if(bulkChanges.enableStockTracking){const e=document.getElementById("bulk-stock-toggle"),t=document.getElementById("bulk-stock-options"),n=document.getElementById("bulk-stock-action"),o=document.getElementById("bulk-stock-amount");e&&(e.checked=!0),t&&(t.style.display="block"),n&&(n.value=bulkChanges.stockAction||"set"),o&&null!==bulkChanges.stockAmount&&(o.value=bulkChanges.stockAmount)}}function showSavePresetDialog(){if(Object.values(bulkChanges).every((e=>null===e||!1===e||"no-change"===e)))return void showMessage("No bulk changes to save as preset","warning");const e=document.createElement("div");e.className="sh-modal-overlay",e.innerHTML='\n        <div class="sh-modal">\n            <div class="sh-modal-header">\n                <h3>Save Preset</h3>\n                <button class="sh-modal-close">&times;</button>\n            </div>\n            <div class="sh-modal-body">\n                <div class="form-group">\n                    <label for="preset-name">Preset Name</label>\n                    <input type="text" id="preset-name" placeholder="Enter preset name...">\n                </div>\n                <div class="form-group">\n                    <label for="preset-description">Description (optional)</label>\n                    <textarea id="preset-description" placeholder="Enter description..."></textarea>\n                </div>\n            </div>\n            <div class="sh-modal-footer">\n                <button class="sh-btn sh-btn-secondary cancel-preset">Cancel</button>\n                <button class="sh-btn sh-btn-primary save-preset">Save Preset</button>\n            </div>\n        </div>\n    ',document.body.appendChild(e);const t=e.querySelector("#preset-name");t&&t.focus();const n=e.querySelector(".sh-modal-close"),o=e.querySelector(".cancel-preset"),s=e.querySelector(".save-preset"),i=()=>{document.body.removeChild(e)};n&&n.addEventListener("click",i),o&&o.addEventListener("click",i),s&&s.addEventListener("click",(()=>{const n=t.value.trim(),o=e.querySelector("#preset-description").value.trim();n?(saveNewPreset(n,o,{...bulkChanges}),i()):showMessage("Please enter a preset name","error")}))}function saveNewPreset(e,t,n){const o=e.toLowerCase().replace(/[^a-z0-9]/g,"-");window.savedPresets[o]={name:e,description:t||`Custom preset: ${e}`,settings:n,created:(new Date).toISOString()},savePresets(),populatePresetDropdown(),showMessage(`Preset "${e}" saved successfully`,"success")}function showManagePresetsDialog(){const e=document.createElement("div");e.className="sh-modal-overlay",e.innerHTML='\n        <div class="sh-modal sh-modal-large">\n            <div class="sh-modal-header">\n                <h3>Manage Presets</h3>\n                <button class="sh-modal-close">&times;</button>\n            </div>\n            <div class="sh-modal-body">\n                <div id="preset-list"></div>\n            </div>\n            <div class="sh-modal-footer">\n                <button class="sh-btn sh-btn-secondary">Close</button>\n            </div>\n        </div>\n    ',document.body.appendChild(e),populatePresetList(e.querySelector("#preset-list"));const t=e.querySelector(".sh-modal-close"),n=e.querySelector(".sh-btn-secondary"),o=()=>{document.body.removeChild(e)};t&&t.addEventListener("click",o),n&&n.addEventListener("click",o)}function populatePresetList(e){e&&(e.innerHTML="",Object.keys(window.savedPresets).forEach((t=>{const n=window.savedPresets[t],o=document.createElement("div");o.className="preset-item",o.innerHTML=`\n            <div class="preset-info">\n                <h4>${n.name}</h4>\n                <p>${n.description}</p>\n                ${n.created?`<small>Created: ${new Date(n.created).toLocaleDateString()}</small>`:""}\n            </div>\n            <div class="preset-actions">\n                <button class="sh-btn sh-btn-sm sh-btn-primary apply-preset" data-preset="${t}">Apply</button>\n                <button class="sh-btn sh-btn-sm sh-btn-danger delete-preset" data-preset="${t}">Delete</button>\n            </div>\n        `,e.appendChild(o)})),e.addEventListener("click",(function(t){if(t.target.classList.contains("apply-preset")){applyPresetById(t.target.getAttribute("data-preset"));const e=t.target.closest(".sh-modal-overlay");e&&document.body.removeChild(e)}if(t.target.classList.contains("delete-preset")){const n=t.target.getAttribute("data-preset");showConfirmation(`Are you sure you want to delete the preset "${window.savedPresets[n].name}"?`,(()=>{deletePreset(n),populatePresetList(e)}))}})))}function applyPresetById(e){const t=window.savedPresets[e];t&&(resetBulkChanges(),Object.assign(bulkChanges,t.settings),updateBulkUIFromSettings(),updateApplyAllButton(),showMessage(`Applied preset: ${t.name}`,"success"))}function deletePreset(e){delete window.savedPresets[e],savePresets(),populatePresetDropdown(),showMessage("Preset deleted successfully","success")}function exportPresets(){const e=JSON.stringify(window.savedPresets,null,2),t=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="squarehero-pm-presets.json",n.click()}function importPresets(e){const t=new FileReader;t.onload=function(e){try{const t=JSON.parse(e.target.result);Object.assign(window.savedPresets,t),savePresets(),populatePresetDropdown(),showMessage("Presets imported successfully","success")}catch(e){showMessage("Error importing presets","error")}},t.readAsText(e)}function initializePreviewPane(){initializeProductCarousel(),initializePreviewUpdates(),loadPreviewData()}function initializeProductCarousel(){const e=document.getElementById("sample-products-carousel");if(!e)return;const t=e.querySelector(".carousel-prev"),n=e.querySelector(".carousel-next");t&&t.addEventListener("click",(()=>{moveCarousel(-1)})),n&&n.addEventListener("click",(()=>{moveCarousel(1)})),window.carouselPosition=0,"function"==typeof window.addEventListener&&window.addEventListener("productsLoaded",updateSampleProducts)}function moveCarousel(e){const t=document.getElementById("sample-products-carousel");if(!t)return;const n=t.querySelectorAll(".product-preview-card"),o=Math.max(0,n.length-3);window.carouselPosition=Math.max(0,Math.min(o,window.carouselPosition+e)),updateCarouselPosition()}function updateCarouselPosition(){updateCarouselPositionEnhanced()}function initializePreviewUpdates(){document.addEventListener("bulkChangeUpdate",updatePreviewPane),document.addEventListener("productSelectionChange",updateSampleProducts)}function loadPreviewData(){updateSampleProducts(),updatePreviewPane()}function updatePreviewPane(){updateChangesPreview(),updateSampleProductCards(),updatePreviewPaneInfo()}function updateChangesPreview(){const e=document.getElementById("changes-summary");if(!e)return;const t=[];if(null!==bulkChanges.priceAdjustment&&0!==bulkChanges.priceAdjustment){const e="percentage"===bulkChanges.regularAdjustmentType?"%":"",n=window.getSystemCurrency()||"";t.push("fixed-price"===bulkChanges.regularAdjustmentType?`Price set to ${bulkChanges.priceAdjustment} ${n}`:`Price ${bulkChanges.priceAdjustment>0?"+":""}${bulkChanges.priceAdjustment}${e}${"percentage"===bulkChanges.regularAdjustmentType?"":` ${n} (adjustment)`}`)}if(null!==bulkChanges.saleDiscount&&0!==bulkChanges.saleDiscount){const e=window.getSystemCurrency()||"";t.push("fixed-price"===bulkChanges.saleAdjustmentType?`Sale price set to ${bulkChanges.saleDiscount} ${e}`:`Sale price ${bulkChanges.saleDiscount>0?"+":""}${bulkChanges.saleDiscount}${"percentage"===bulkChanges.saleAdjustmentType?"%":` ${e} (adjustment)`}`)}if(bulkChanges.saleToggle&&"keep-current"!==bulkChanges.saleToggle&&"no-change"!==bulkChanges.saleToggle&&t.push(`Sale status: ${"put-on-sale"===bulkChanges.saleToggle?"on sale":"take-off-sale"===bulkChanges.saleToggle?"off sale":bulkChanges.saleToggle}`),bulkChanges.enableRounding){const e=generateRoundingPreview();e&&t.push(e)}if(bulkChanges.inventory&&bulkChanges.inventory.stock){const e=bulkChanges.inventory.stock;if("unlimited"===e.type)t.push("Set stock to unlimited");else if("limited"===e.type&&void 0!==e.amount)if("adjust"===e.method&&0!==e.amount){const n=parseFloat(e.amount)||0;t.push(`Adjust stock by ${n>=0?"+":""}${n}`)}else if("fixed"===e.method){const n=parseInt(e.amount)||0;t.push(`Set stock to ${n}`)}}bulkChanges.categories&&bulkChanges.categories.toAdd&&bulkChanges.categories.toAdd.length>0&&t.push(`Add categories: ${bulkChanges.categories.toAdd.join(", ")}`),bulkChanges.categories&&bulkChanges.categories.toRemove&&bulkChanges.categories.toRemove.length>0&&t.push(`Remove categories: ${bulkChanges.categories.toRemove.join(", ")}`),bulkChanges.newStatus&&"unchanged"!==bulkChanges.newStatus&&t.push(`Product status: ${"public"===bulkChanges.newStatus?"Public":"hidden"===bulkChanges.newStatus?"Hidden":"scheduled"===bulkChanges.newStatus?"Scheduled":bulkChanges.newStatus}`),e.innerHTML=0===t.length?'<div class="no-changes">No changes configured</div>':t.map((e=>`<div class="change-item">\n                <span class="change-icon"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="13" viewBox="0 0 15 13" fill="none"><path d="M1 6.5L5.24264 10.7426L13.727 2.25732" stroke="#22A24E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>\n                <span class="change-text">${e}</span>\n            </div>`)).join("")}function updateSampleProducts(){const e=getSelectedProductsWithData(),t=Math.min(6,e.length);updateSampleProductCards(e.length>0?e.slice(0,t):globalProductsData.slice(0,t)),updateSelectedProductsCount()}function updateSampleProductCards(e=null){const t=document.getElementById("sample-products");if(!t)return;const n=(e||getSelectedProductsWithData()).slice(0,3);if(0===n.length)return void(t.innerHTML='<div class="no-changes">No products selected</div>');const o=n.map((e=>{const t=calculateProductPreview(e);return{productName:t.productName,sku:t.sku,currentPrice:t.currentPrice,newPrice:t.newPrice,priceChanged:t.newPrice!==t.currentPrice,currentSalePrice:t.currentSalePrice,newSalePrice:t.salePrice,salePriceChanged:t.salePrice!==t.currentSalePrice,oldPriceToShow:t.currentSalePrice,newStock:t.stockDisplay.replace('<span class="stock-display">',"").replace("</span>",""),saleStatusBadge:generateSaleStatusIndicator(t.currentPrice,t.currentSalePrice,t.newPrice,t.salePrice),isOnSale:null!==t.currentSalePrice}}));let s="";s=1===o.length?buildProductCard(o[0]):`\n            <div class="carousel-container">\n                <div class="carousel-content">\n                    <div class="carousel-track" id="product-carousel-track">\n                        ${o.map((e=>buildProductCard(e))).join("")}\n                    </div>\n                </div>\n            </div>\n            <div class="carousel-controls">\n                <button class="carousel-nav prev" onclick="navigateProductCard(-1)" ${o.length<=1?"disabled":""}>\n                    <svg width="9" height="16" viewBox="0 0 9 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <g clip-path="url(#clip0_181_2572_left)">\n                            <path d="M8 15L1 8L8 1" stroke="#001E45" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                        </g>\n                        <defs>\n                            <clipPath id="clip0_181_2572_left">\n                                <rect width="9" height="16" fill="white"/>\n                            </clipPath>\n                        </defs>\n                    </svg>\n                </button>\n                <div class="carousel-indicators">\n                    ${o.map(((e,t)=>`<span class="indicator ${0===t?"active":""}" onclick="goToProductCard(${t})"></span>`)).join("")}\n                </div>\n                <button class="carousel-nav next" onclick="navigateProductCard(1)" ${o.length<=1?"disabled":""}>\n                    <svg width="9" height="16" viewBox="0 0 9 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: rotate(180deg);">\n                        <g clip-path="url(#clip0_181_2572_right)">\n                            <path d="M8 15L1 8L8 1" stroke="#001E45" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                        </g>\n                        <defs>\n                            <clipPath id="clip0_181_2572_right">\n                                <rect width="9" height="16" fill="white"/>\n                            </clipPath>\n                        </defs>\n                    </svg>\n                </button>\n            </div>\n        `;const i=window.currentProductCardIndex||0;t.innerHTML=s,window.totalProductCards=o.length,window.currentProductCardIndex=i<o.length?i:Math.max(0,o.length-1),updateCarouselPosition()}function buildProductCard(e){let t=e.stockDisplay||"N/A";if(void 0!==e.newStock&&e.newStock!==e.currentStock){if(!1===e.newTrackStock)t="∞";else if(t=`${e.newStock}`,null!=e.currentStock){const n=e.newStock-e.currentStock;0!==n&&(t=`${e.newStock} (${n>0?"+":""}${n})`)}}else e.stockDisplay&&(t=e.stockDisplay);const n=(()=>{if(window.getSelectedProductsWithData){const e=window.getSelectedProductsWithData();if(e.length>0){const t=e[0];if(t.storeItem?.price?.currencyCode)return t.storeItem.price.currencyCode;if(t.storeItem?.variants?.[0]?.price?.currencyCode)return t.storeItem.variants[0].price.currencyCode}}if(window.allProducts&&window.allProducts.length>0)for(const e of window.allProducts)if(e.storeItem?.price?.currencyCode)return e.storeItem.price.currencyCode;return""})(),o=n?` (${n})`:"";return`<div class="product-preview-card">\n        <div class="product-info">\n            <h5 class="product-title" style="color: #011E45; font-family: 'Red Hat Text'; font-size: 16px; font-style: normal; font-weight: 500; line-height: normal; margin: 0 0 8px 0;">${e.productName}</h5>\n            ${e.sku&&"N/A"!==e.sku?`<div class="product-sku">${e.sku}</div>`:""}\n        </div>\n        \n        <div class="pricing-group">\n            <div class="price-line">\n                <span class="price-label">Price${o}</span>\n                <div class="price-values">\n                    ${e.priceChanged?`<span class="old-price">${window.formatCurrency?window.formatCurrency(e.currentPrice):`$${e.currentPrice.toFixed(2)}`}</span>`:""}\n                    <span class="new-price ${e.priceChanged?"changed":""}">${window.formatCurrency?window.formatCurrency(e.newPrice):`$${e.newPrice.toFixed(2)}`}</span>\n                </div>\n            </div>\n            \n            ${e.salePriceChanged?`\n            <div class="price-line">\n                <span class="price-label">Sale price${o}</span>\n                <div class="price-values">\n                    ${null!=e.oldPriceToShow?`<span class="old-price">${window.formatCurrency?window.formatCurrency(e.oldPriceToShow):`$${e.oldPriceToShow.toFixed(2)}`}</span>`:""}\n                    <span class="new-price changed">\n                        ${null!=e.newSalePrice?window.formatCurrency?window.formatCurrency(e.newSalePrice):`$${e.newSalePrice.toFixed(2)}`:"N/A"}\n                    </span>\n                </div>\n            </div>`:""}\n        </div>\n        \n        <div class="status-stock-group">\n            <div class="status-line">\n                ${e.saleStatusBadge||""}<span class="stock-info">Stock: ${t}</span>\n            </div>\n        </div>\n    </div>`}function createProductPreviewCard(e){return buildProductCardEnhanced(calculateProductPreview(e))}function calculateProductPreview(e){let t=0,n=null,o=!1,s=null;if(e.storeItem){const i="DIGITAL"===e.storeItem.productType,a="SERVICE"===e.storeItem.productType;if(i)t=e.storeItem.priceCents?e.storeItem.priceCents/100:0,e.storeItem.onSale&&e.storeItem.salePriceCents>0&&(n=e.storeItem.salePriceCents/100,o=!0);else if(a){if(e.storeItem.priceCents)t=e.storeItem.priceCents/100;else if(e.storeItem.variants?.length>0){const s=e.storeItem.variants[0];t=s?.price?s.price/100:0,s?.onSale&&s?.salePrice>0&&(n=s.salePrice/100,o=!0)}e.storeItem?.onSale&&e.storeItem?.salePriceCents>0&&(n=e.storeItem.salePriceCents/100,o=!0)}else s=e.storeItem.variants&&e.storeItem.variants[0],s&&(t=s.price?s.price/100:0,null!=s.salePrice&&(n=s.salePrice/100),s.onSale&&(o=!0));let r=0,c=!1;i||a?(c=!0,r=null):s&&(s.unlimited?(c=!0,r=null):r=parseInt(s.qtyInStock)||0);let l=t,d=n,u=!1,p=!1;if(null!==bulkChanges.fixedPrice)l=bulkChanges.fixedPrice,u=!0,bulkChanges.fixedApplyToSale&&n&&(d=bulkChanges.fixedPrice,d<0&&(d=0),d>l&&(d=l),p=!0);else if(null!==bulkChanges.priceAdjustment&&0!==bulkChanges.priceAdjustment){if("fixed-adjustment"===bulkChanges.regularAdjustmentType)l=t+bulkChanges.priceAdjustment;else if("fixed-price"===bulkChanges.regularAdjustmentType)l=bulkChanges.priceAdjustment;else{const e=1+bulkChanges.priceAdjustment/100;l=t<=0?1*e:t*e}if(l<0&&(l=0),u=!0,bulkChanges.applyToSale&&n){if("fixed-adjustment"===bulkChanges.regularAdjustmentType)d=n+bulkChanges.priceAdjustment;else if("fixed-price"===bulkChanges.regularAdjustmentType)d=bulkChanges.priceAdjustment;else{const e=1+bulkChanges.priceAdjustment/100;d=n<=0?1*e:n*e}d<0&&(d=0),d>l&&(d=l),p=!0}}if(null!==bulkChanges.saleDiscount&&0!==bulkChanges.saleDiscount){null!==n&&n>=0?"percentage"===bulkChanges.saleAdjustmentType?d=n<=0?1*(1+bulkChanges.saleDiscount/100):n*(1+bulkChanges.saleDiscount/100):"fixed-adjustment"===bulkChanges.saleAdjustmentType?d=n+bulkChanges.saleDiscount:"fixed-price"===bulkChanges.saleAdjustmentType&&(d=Math.abs(bulkChanges.saleDiscount)):"percentage"===bulkChanges.saleAdjustmentType?d=t<=0?1*(1+bulkChanges.saleDiscount/100):t*(1+bulkChanges.saleDiscount/100):"fixed-adjustment"===bulkChanges.saleAdjustmentType?d=t+bulkChanges.saleDiscount:"fixed-price"===bulkChanges.saleAdjustmentType&&(d=Math.abs(bulkChanges.saleDiscount)),d<0&&(d=0);const e=u?l:t;d>e&&bulkChanges.saleDiscount<0&&(d=e),p=!0}const g={productName:e.title,sku:e.storeItem?.sku||e.storeItem?.variants?.[0]?.sku||"N/A",currentPrice:t,currentSalePrice:n,newPrice:l,salePrice:d,currentStock:r,stockDisplay:formatStockDisplay(r,!0),status:"PUBLISHED"===e.workflowState?"public":"hidden",statusDisplay:formatStatusDisplay("PUBLISHED"===e.workflowState?"public":"hidden"),statusBadge:generateProductStatusIndicator(e),hasChanges:u||p};if(bulkChanges.enableRounding){const e=bulkChanges.roundingTarget||"all",t="all"===e||"sale"===e;"all"!==e&&"regular"!==e||null==g.newPrice||(g.newPrice=applyRounding(g.newPrice,bulkChanges.roundingType,bulkChanges.customCents),g.hasChanges=!0),t&&null!=g.salePrice&&(g.salePrice=applyRounding(g.salePrice,bulkChanges.roundingType,bulkChanges.customCents),g.hasChanges=!0)}let h=r,m=!c,y=!1;if(bulkChanges.inventory&&bulkChanges.inventory.stock&&void 0!==bulkChanges.inventory.stock.type&&(m="limited"===bulkChanges.inventory.stock.type,y=!0,m?null===r&&(h=0):h=null),m&&bulkChanges.inventory&&bulkChanges.inventory.stock){const e=bulkChanges.inventory.stock;if("adjust"===e.method&&void 0!==e.amount&&0!==e.amount){const t=parseFloat(e.amount)||0,n=null===r?0:parseInt(r)||0;h=Math.max(0,n+t),y=!0}else if("fixed"===e.method&&void 0!==e.amount){const t=parseInt(e.amount)||0;h=Math.max(0,t),y=!0}}return y?(g.stockDisplay=formatStockDisplay(h,m),g.newStock=h,g.newTrackStock=m,g.hasChanges=!0):(g.stockDisplay=formatStockDisplay(r,!c),g.newStock=r,g.newTrackStock=!c),bulkChanges.newStatus&&bulkChanges.newStatus!==g.status&&(g.status=bulkChanges.newStatus,g.statusDisplay=formatStatusDisplay(bulkChanges.newStatus),g.hasChanges=!0),g}}function formatStockDisplay(e,t){return t?null==e?"Not tracked":`${e}`:"∞"}function formatStatusDisplay(e){switch(e){case"public":case"PUBLISHED":return"Public";case"hidden":case"DRAFT":return"Hidden";default:return"Unknown"}}function applyRounding(e,t,n){if(!e||e<=0)return e;let o;switch(t){case"whole":o=Math.round(e);break;case".99":const t=Math.floor(e),s=t-1+.99,i=t+.99,a=t+1+.99,r=Math.abs(e-s),c=Math.abs(e-i),l=Math.abs(e-a);o=r<=c&&r<=l?s:c<=l?i:a,o<.99&&(o=.99);break;case".95":const d=Math.floor(e),u=d-1+.95,p=d+.95,g=d+1+.95,h=Math.abs(e-u),m=Math.abs(e-p),y=Math.abs(e-g);o=h<=m&&h<=y?u:m<=y?p:g,o<.95&&(o=.95);break;case"custom":const f=(n||99)/100,v=Math.floor(e),w=v-1+f,k=v+f,b=v+1+f,C=Math.abs(e-w),S=Math.abs(e-k),E=Math.abs(e-b);o=C<=S&&C<=E?w:S<=E?k:b,o<f&&(o=f);break;default:o=e}return o}function generateSaleStatusIndicator(e,t){if(!bulkChanges.saleToggle||"keep-current"===bulkChanges.saleToggle||"no-change"===bulkChanges.saleToggle)return"";const n=t&&t>0&&t<e;return"put-on-sale"===bulkChanges.saleToggle?n?'<span class="sale-tag on-sale">Sale</span>':'<span class="sale-tag sale-added">Sale</span>':"take-off-sale"===bulkChanges.saleToggle&&n?'<span class="sale-tag sale-removed">Sale</span>':""}function generateProductStatusIndicator(e){if(!bulkChanges.newStatus||"unchanged"===bulkChanges.newStatus)return"";const t=bulkChanges.newStatus;return("PUBLISHED"===e.workflowState?"public":"hidden")!==t?`<span class="status-badge ${t}">${"public"===t?"Public":"hidden"===t?"Hidden":"scheduled"===t?"Scheduled":t}</span>`:""}function buildProductCardEnhanced(e){const t=e.salePrice||e.currentSalePrice,n=generateSaleStatusIndicator(e.currentPrice||0,e.currentSalePrice||null,e.newPrice||0,e.salePrice||null);return`\n        <div class="product-preview-card">\n            <div class="product-info">\n                <h4 class="product-title">${e.productName||"Unnamed Product"}</h4>\n                <div class="product-meta-line">\n                    <p class="product-sku">${e.sku||"No SKU"}</p>\n                    ${e.statusBadge||""}\n                </div>\n            </div>\n            \n            <div class="price-section">\n                <div class="price-row">\n                    <span class="label">Price:</span>\n                    <span class="value">$${(e.newPrice||0).toFixed(2)}</span>\n                </div>\n                ${t?`\n                <div class="price-row sale-price">\n                    <span class="label">Sale Price:</span>\n                    <span class="value">$${(e.salePrice||0).toFixed(2)}</span>\n                </div>\n                `:""}\n            </div>\n            \n            <div class="stock-section">\n                <div class="stock-row">\n                    <span class="label">Stock:</span>\n                    <span class="value">${e.stockDisplay||"N/A"}</span>\n                </div>\n            </div>\n            \n            <div class="status-section">\n                <div class="status-row">\n                    <span class="label">Status:</span>\n                    <span class="value status-${e.status}">${e.statusDisplay||"Unknown"}</span>\n                </div>\n                <div class="sale-status-row">\n                    ${n}\n                </div>\n            </div>\n            \n            ${e.hasChanges?'<div class="change-indicator">Will be modified</div>':'<div class="no-changes">No changes</div>'}\n        </div>\n    `}function updateCarouselPositionEnhanced(){const e=document.getElementById("product-carousel-track"),t=document.querySelectorAll(".carousel-indicators .indicator");if(!e)return;const n=void 0!==window.currentProductCardIndex&&null!==window.currentProductCardIndex?window.currentProductCardIndex:0;e.style.transform=`translateX(${100*-n}%)`,t.forEach(((e,t)=>{t===n?e.classList.add("active"):e.classList.remove("active")}));const o=document.querySelector(".carousel-nav.prev"),s=document.querySelector(".carousel-nav.next");o&&s&&(o.disabled=n<=0,s.disabled=n>=window.totalProductCards-1)}function generateRoundingPreview(){if(!bulkChanges.enableRounding)return"";const e=bulkChanges.roundingType||"whole",t=bulkChanges.roundingTarget||"all",n=bulkChanges.customCents||99;let o="";switch(e){case"whole":o="Round to whole numbers";break;case".99":o="Round to .99";break;case".95":o="Round to .95";break;case"custom":o=`Round to .${n.toString().padStart(2,"0")}`;break;default:o="Apply rounding"}switch(t){case"all":default:o=`Round all prices to ${getRoundingTypeText(e,n)}`;break;case"regular":o=`Round regular prices to ${getRoundingTypeText(e,n)}`;break;case"sale":o=`Round sale prices to ${getRoundingTypeText(e,n)}`}return o}function getRoundingTypeText(e,t){switch(e){case"whole":return"whole numbers";case".99":return".99";case".95":return".95";case"custom":return`.${t.toString().padStart(2,"0")}`;default:return"nearest dollar"}}async function fetchCategoriesForCollection(e,t){try{if(!e||!t)return[];const n=`/api/product-content-service/products/${e}/categories/tree`,o=await fetch(n,{method:"GET",headers:{accept:"application/json, text/plain, */*","content-type":"application/json","x-csrf-token":t},credentials:"include"});if(!o.ok)return[];const s=await o.json();!globalCategoryTreeData&&s.categoryTree&&(globalCategoryTreeData=s.categoryTree);const i=[];return s.categoryTree&&s.categoryTree.forEach((e=>{"ROOT"!==e.type&&i.push({id:e.id,name:e.displayName,slug:e.shortSlug,fullSlug:e.fullSlug,itemCount:e.orderedItemCount,itemIds:e.orderedItemIds||[]})})),i}catch(e){return[]}}function getProductCategories(e){if(!globalCategoriesData||0===globalCategoriesData.length)return"";const t=[];return globalCategoriesData.forEach((n=>{n.itemIds&&n.itemIds.includes(e)&&t.push(n.name)})),t.length>0?t.join(", "):""}async function fetchCategoriesFromAllCollections(e){try{const t=await fetch(`${window.location.origin}/api/commondata/GetCollections?limit=100`,{method:"GET",headers:{accept:"application/json, text/plain, */*","x-csrf-token":e},credentials:"include"});if(!t.ok)return[];const n=await t.json(),o=(n&&n.collections?Object.values(n.collections):[]).filter((e=>"products"===e.typeName));if(globalCollectionsData=o,!o.length)return[];const s=o.map((t=>fetchCategoriesForCollection(t.id,e))),i=await Promise.all(s),a=[],r=new Set;return i.forEach((e=>{e.forEach((e=>{const t=`${e.name}_${e.id}`;r.has(t)||(r.add(t),a.push(e))}))})),a}catch(e){return[]}}async function fetchCategories(e,t){return await fetchCategoriesFromAllCollections(t)}function getSelectedProductsWithData(){const e=document.querySelectorAll('.mix input[type="checkbox"]:checked'),t=Array.from(e).map((e=>{const t=e.closest("tr");return t?t.getAttribute("data-product-id"):null})).filter((e=>null!==e));return globalProductsData.filter((e=>t.includes(e.id)))}function convertProductToTableRow(e){const t="DIGITAL"===e.storeItem?.productType,n="SERVICE"===e.storeItem?.productType,o=!t&&!n&&e.storeItem?.variants?.length>0?e.storeItem.variants[0]:null,s=(e,t=null)=>{if(!e)return"N/A";if(window.currencyManager)return window.currencyManager.formatCurrency(e/100,t);const n=t||window.getSystemCurrency?.(),o=(e/100).toFixed(2);return n?`${n}$${o}`:`$${o}`};let i="hidden";"PUBLISHED"===e.workflowState?i="public":"SCHEDULED"===e.workflowState?i="scheduled":"DRAFT"===e.workflowState&&(i="hidden");let a="0";t||n?a='<span class="stock-infinite">∞</span>':o&&(a=o.unlimited?'<span class="stock-infinite">∞</span>':o.qtyInStock?.toString()||"0");const r=getProductCategories(e.id),c=e.urlId||"";let l;if(t||n)l="N/A";else{const t=e.storeItem?.variants?.length||0;l=t>1?`${t} variants`:o?.sku?o.sku:"N/A"}let d="N/A",u="",p=!1;if(t)d=s(e.storeItem?.priceCents),null!=e.storeItem?.salePriceCents&&(u=s(e.storeItem.salePriceCents)),e.storeItem?.onSale&&(p=!0);else if(n){if(e.storeItem?.priceCents)d=s(e.storeItem.priceCents);else if(e.storeItem?.variants?.length>0){const t=e.storeItem.variants[0];d=s(t?.price),null!=t?.salePrice&&(u=s(t.salePrice)),t?.onSale&&(p=!0)}null!=e.storeItem?.salePriceCents&&(u=s(e.storeItem.salePriceCents)),e.storeItem?.onSale&&(p=!0)}else{const t=e.storeItem?.variants||[];if(t.length>1){const e=t.map((e=>e.price)).filter((e=>null!=e)),n=t.map((e=>e.salePrice)).filter((e=>null!=e));if(e.length>0){const t=Math.min(...e);d=t===Math.max(...e)?s(t):`from ${s(t)}`}if(n.length>0){const e=Math.min(...n);u=e===Math.max(...n)?s(e):`from ${s(e)}`}t.some((e=>e.onSale))&&(p=!0)}else d=s(o?.price),null!=o?.salePrice&&(u=s(o.salePrice)),o?.onSale&&(p=!0)}let g="";if("scheduled"===i&&e.publishOn){const t=new Date(e.publishOn);g=t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return{id:e.id,name:e.title||"Untitled",url:c,sku:l,skuEditable:!t&&!n&&1===e.storeItem?.variants?.length,categories:r,price:d,salePrice:u||"N/A",onSale:p,stock:a,type:n?"Service":t?"Digital":"Physical",status:i,scheduledDate:g,rawProduct:e}}function createCategoryTags(e){return e&&""!==e.trim()?e.split(",").map((e=>e.trim())).filter((e=>""!==e)).map((e=>`\n        <span class="category-tag">\n            ${e}\n            <button class="category-remove" data-category="${e}" title="Remove category">×</button>\n        </span>\n    `)).join(""):""}function createProductRow(e){const t=document.createElement("tr");t.className="mix master-product-row",t.setAttribute("data-product-id",e.id);const n=""===e.categories.trim()?"uncategorized":e.categories.toLowerCase().replace(/[^a-z0-9\s,]/g,"").replace(/\s+/g,"-").split(",").map((e=>e.trim())).join(" ");t.setAttribute("data-category",n),t.setAttribute("data-status",e.status),t.setAttribute("data-type",e.type),t.setAttribute("data-title",e.name.toLowerCase()),t.setAttribute("data-price",parseFloat(e.price.replace(/[^0-9.]/g,""))||0);let o=999999;"string"!=typeof e.stock||e.stock.includes("∞")||(o=parseInt(e.stock.replace(/[^0-9]/g,""))||0),t.setAttribute("data-stock",o),e.scheduledDate&&t.setAttribute("data-scheduled-date",e.scheduledDate);const s=e.rawProduct.storeItem&&"DIGITAL"!==e.rawProduct.storeItem.productType&&e.rawProduct.storeItem.variants&&e.rawProduct.storeItem.variants.length>1;return t.innerHTML=`\n        <td><input type="checkbox"></td>\n        <td class="title-with-expand">${s?`<button class="expand-btn" data-expanded="false">\n            <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M9 1L5 5L1 1" stroke="#011E45" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n        </button> ${e.name}`:e.name}</td>\n        <td>${e.url}</td>\n        <td class="${e.skuEditable?"":"non-editable"}">${e.sku}</td>\n        <td class="category-field" title="Click to edit categories" data-original-categories="${e.categories}">\n            ${e.categories||""}\n        </td>\n        <td>${e.price}</td>\n        <td>${e.salePrice}</td>\n        <td>${e.onSale?'<span class="status-badge public">Yes</span>':'<span class="status-badge hidden">No</span>'}</td>\n        <td>${e.stock}</td>\n        <td>${e.type}</td>\n        <td><span class="status-badge ${e.status}">${e.status.charAt(0).toUpperCase()+e.status.slice(1)}</span></td>\n        <td class="scheduled-date-cell scheduled-column ${"scheduled"!==e.status?"hidden":""}">${e.scheduledDate||""}</td>\n    `,s&&t.querySelector(".expand-btn").addEventListener("click",(function(n){n.stopPropagation(),toggleVariantRows(t,e.rawProduct)})),t}async function getWebsiteId(e){try{const t=window.location.pathname.split("/");if(t.includes("config")&&t.length>2){const e=t.indexOf("config");if(e+1<t.length){const n=t[e+1];if(n&&n.length>10)return n}}const n=await fetch(`${window.location.origin}/api/commondata/GetCollections`,{method:"GET",headers:{accept:"application/json","x-csrf-token":e},credentials:"include"});if(!n.ok)return"unknown";const o=await n.json(),s=Object.values(o.collections||{})[0],i=s?.websiteId;return i||"unknown"}catch(e){return"unknown"}}function getCsrfToken(){const e=document.cookie.split(";").find((e=>e.trim().startsWith("crumb=")))?.split("=")[1];return e||null}async function fetchAllProducts(){const e=getCsrfToken();if(!e)return[];try{const t=await getWebsiteId(e);if("unknown"===t)return[];const n=await fetch(`${window.location.origin}/api/commondata/GetCollections?limit=100`,{method:"GET",headers:{accept:"application/json, text/plain, */*","x-csrf-token":e},credentials:"include"});if(!n.ok)throw new Error(`Failed to fetch collections: ${n.status}`);const o=await n.json(),s=(o&&o.collections?Object.values(o.collections):[]).filter((e=>"products"===e.typeName));if(!s.length)return[];const i=s.map((async n=>{try{try{return await fetchProductsUsingQueryAPI(n.id,t,e)}catch(t){return await fetchProductsUsingCommerceAPI(n.id,e)}}catch(e){return[]}})),a=(await Promise.all(i)).flat(),r=[],c=new Set;return a.forEach((e=>{c.has(e.id)||(c.add(e.id),r.push(e))})),r}catch(e){return[]}}async function fetchProductsUsingQueryAPI(e,t,n){const o=`${window.location.origin}/api/content-service/product/1.1/websites/${t}/products/${e}/queryProductItems`;let s=[],i=!0,a="",r="",c=0;for(;i&&c<100;){c++;const l={limit:200,...a&&{pageAction:"NEXT",pageMarker:a}},d=await fetch(o,{method:"POST",headers:{accept:"application/json","content-type":"application/json","x-csrf-token":n},credentials:"include",body:JSON.stringify(l)});if(!d.ok){const e=await d.text();throw new Error(`HTTP ${d.status}: ${e}`)}const u=await d.json();if(u.products&&u.products.length>0){const n=u.products.map((n=>({...n,websiteId:t,parentCollectionId:e})));s=s.concat(n)}if(r=a,i=u.pagination?.hasNextPage||!1,a=u.pagination?.nextPageMarker||"",i&&a&&a===r)break;if(i&&!a)break}return s}async function fetchProductsUsingCommerceAPI(e,t){try{const n=await fetch(`${window.location.origin}/api/commerce/collections/${e}/items?limit=100`,{method:"GET",headers:{accept:"application/json","x-csrf-token":t},credentials:"include"});if(!n.ok)return[];const o=await n.json(),s=o.items?.map((e=>e.id))||[];if(0===s.length)return[];const i=[];for(const e of s)try{const n=await fetch(`${window.location.origin}/api/commerce/products/${e}`,{method:"GET",headers:{accept:"application/json","x-csrf-token":t},credentials:"include"});if(n.ok){const e=await n.json();i.push(e)}}catch(e){}return i}catch(e){return[]}}async function loadProducts(){const e=document.getElementById("product-container");if(!e)return;const t=Array(10).fill().map((()=>'\n            <tr class="skeleton-row">\n                <td><div class="skeleton skeleton-checkbox"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-title"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-url"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-sku"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-category"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-price"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-price"></div></td>\n                <td><div class="skeleton skeleton-badge"></div></td>\n                <td><div class="skeleton skeleton-text skeleton-stock"></div></td>\n                <td><div class="skeleton skeleton-badge"></div></td>\n                <td><div class="skeleton skeleton-badge"></div></td>\n            </tr>\n        ')).join("");e.innerHTML=t;const n=getCsrfToken();if(!n)return void(e&&(e.innerHTML='<tr><td colspan="11" style="text-align: center; padding: 2em;">Unable to authenticate. Please ensure you are logged into Squarespace admin.</td></tr>'));globalCategoriesData=await fetchCategoriesFromAllCollections(n),window.globalCategoriesData=globalCategoriesData,window.globalCollectionsData=globalCollectionsData,window.globalCategoryTreeData=globalCategoryTreeData;const o=await fetchAllProducts();if(0===o.length)return void(e&&(e.innerHTML='<tr><td colspan="11" style="text-align: center; padding: 2em;">No products found or unable to fetch products.</td></tr>'));globalProductsData=o,window.squarespaceProducts=o,e&&(e.innerHTML=""),o.forEach((t=>{const n=createProductRow(convertProductToTableRow(t));e&&e.appendChild(n)}));const s=globalCategoriesData.map((e=>e.name));"function"==typeof populateCategoryFilter&&populateCategoryFilter(new Set(s)),"function"==typeof initializeMixItUpIntegration&&setTimeout((()=>{initializeMixItUpIntegration()}),100),"function"==typeof initializeMixItUpAfterProducts&&setTimeout((()=>{initializeMixItUpAfterProducts()}),100),"function"==typeof updateScheduledColumnVisibility&&setTimeout((()=>{updateScheduledColumnVisibility()}),200)}function initializeProductTable(){initializeSelectAll(),initializeTableInteractions(),initializeChangesTracking()}function initializeSelectAll(){const e=document.getElementById("select-all-checkbox");e&&e.addEventListener("change",(function(){const e=this.checked;document.querySelectorAll('.mix:not([style*="display: none"]) input[type="checkbox"]').forEach((t=>{t.checked=e})),updateSelectedProductsCount(),updateBulkEditButton()}))}function initializeProductTable(){const e=document.getElementById("product-container");e&&(e.addEventListener("change",(function(e){"checkbox"===e.target.type&&handleProductSelection(e)})),e.addEventListener("input",(function(){})),e.addEventListener("click",(function(e){e.target.matches(".expand-btn")&&handleVariantToggle(e)})))}function handleProductSelection(e){const t=e.target,n=t.closest("tr");n&&(n.classList.toggle("selected",t.checked),updateSelectAllState(),updateSelectedProductsCount(),updateBulkEditButton())}function handleFieldEdit(e){const t=e.target,n=t.closest("tr");n&&n.getAttribute("data-product-id")&&trackChanges(t,n)}function handleVariantToggle(e){const t=e.target.closest("tr"),n=globalProductsData.find((e=>e.id===t.getAttribute("data-product-id")));n&&toggleVariantRows(t,n)}function toggleVariantRows(e,t){const n=e.querySelector(".expand-btn");if("true"===n.getAttribute("data-expanded")){let t=e.nextElementSibling;for(;t&&t.classList.contains("variant-row");){const e=t;t=t.nextElementSibling,e.remove()}n.setAttribute("data-expanded","false")}else(t.storeItem?.variants||[]).forEach(((n,o)=>{const s=createVariantRow(n,t.id,o),i=document.createElement("table"),a=document.createElement("tbody");a.innerHTML=s,i.appendChild(a);const r=a.firstElementChild;r&&"TR"===r.tagName&&e.parentNode.insertBefore(r,e.nextSibling)})),n.setAttribute("data-expanded","true")}function createVariantRow(e,t){const n=e=>null==e?"—":`$${(e/100).toFixed(2)}`;let o="Variant";e.optionalValues&&e.optionalValues.length>0&&(o=e.optionalValues.map((e=>`${e.optionName}: ${e.value}`)).join(", "));let s="—",i="—";return null!=e.price&&(s="string"==typeof e.price?e.price:n(e.price)),e.salePrice&&e.salePrice>0&&(i="string"==typeof e.salePrice?e.salePrice:n(e.salePrice)),`<tr class="variant-row mix" data-variant-id="${e.id}" data-parent-product="${t}" data-product-id="${e.id}" style="display: table-row; opacity: 1; transition: opacity 0.3s;">\n            <td class="variant-checkbox-cell">\x3c!-- No checkbox for variants --\x3e</td>\n            <td class="variant-name non-editable">↳ ${o}</td>\n            <td class="non-editable">—</td>\n            <td class="">${e.sku||""}</td>\n            <td class="non-editable">—</td>\n            <td>${s}</td>\n            <td>${i}</td>\n            <td><span class="status-badge ${e.visibility&&e.visibility.public?"public":"hidden"}">${e.visibility&&e.visibility.public?"Yes":"No"}</span></td>\n            <td><span class="stock-infinite">∞</span></td>\n            <td class="variant-type non-editable">Variant</td>\n            <td class="non-editable">—</td>\n        </tr>`}function updateSelectAllState(){const e=document.getElementById("select-all-checkbox");if(!e)return;const t=document.querySelectorAll('.mix:not([style*="display: none"]) input[type="checkbox"]:not(#select-all-checkbox)'),n=document.querySelectorAll('.mix:not([style*="display: none"]) input[type="checkbox"]:checked:not(#select-all-checkbox)');0===n.length?(e.checked=!1,e.indeterminate=!1):n.length===t.length?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}function updateSelectedProductsCount(){const e=document.querySelectorAll('.mix input[type="checkbox"]:checked:not(#select-all-checkbox)').length,t=document.getElementById("products-selected-count");t&&(t.textContent=`${e} Product${1!==e?"s":""} Selected`);const n=document.getElementById("estimated-time");if(n&&e>0){let t=Math.max(5,e);n.textContent=`Est. ${t} seconds`}}function updateBulkEditButton(){const e=document.querySelectorAll('.mix input[type="checkbox"]:checked:not(#select-all-checkbox)').length,t=document.querySelector(".bulk-adjust");t&&(t.disabled=0===e)}function initializeChangesTracking(){globalProductsData.forEach((e=>{const t=convertProductToTableRow(e);originalData.set(e.id,{title:t.name,url:t.url,stock:t.stock,price:t.price,salePrice:t.salePrice,status:t.status})}))}function trackChanges(e,t){const n=t.getAttribute("data-product-id");n&&"function"==typeof markProductAsChanged&&markProductAsChanged(n,e.getAttribute("data-field-type"),e.getAttribute("data-new-value")),"function"==typeof updateChangesFooter&&updateChangesFooter(),hasUnsavedChanges=!0}function checkUnsavedChanges(e){return hasUnsavedChanges?("function"==typeof shakeFooter&&shakeFooter(),!1):(e&&e(),!0)}function shakeFooter(){const e=document.getElementById("changes-footer");e&&(e.classList.add("shake"),setTimeout((()=>{e.classList.remove("shake")}),500))}function filterProducts(e,t){document.querySelectorAll(".master-product-row").forEach((n=>{let o=!0;switch(e){case"search":if(t){const e=t.toLowerCase(),s=n.getAttribute("data-name")||"",i=n.getAttribute("data-sku")||"";o=s.includes(e)||i.includes(e)}break;case"category":"all"!==t&&(o=(n.getAttribute("data-category")||"").includes(t));break;case"status":"all"!==t&&(o=(n.getAttribute("data-status")||"")===t)}n.style.display=o?"":"none"})),updateSelectAllState()}function initializeSearchFiltering(){function e(){E&&P&&(E.addEventListener("click",(function(e){e.stopPropagation(),t(E,P)})),P.addEventListener("click",(function(e){if(e.target.classList.contains("select-option")){const t=e.target.getAttribute("data-value");o(E,P,I,f,t,e.target.textContent),p=t,i()}}))),L&&x&&(L.addEventListener("click",(function(e){e.stopPropagation(),t(L,x)})),x.addEventListener("click",(function(e){if(e.target.classList.contains("select-option")){const t=e.target.getAttribute("data-value");o(L,x,A,w,t,e.target.textContent),h=t,i(),r()}}))),B&&T&&(B.addEventListener("click",(function(e){e.stopPropagation(),t(B,T)})),T.addEventListener("click",(function(e){if(e.target.classList.contains("select-option")){const t=e.target.getAttribute("data-value");o(B,T,D,v,t,e.target.textContent),g=t,i()}}))),M&&j&&(M.addEventListener("click",(function(e){e.stopPropagation(),t(M,j)})),j.addEventListener("click",(function(e){if(e.target.classList.contains("select-option")){const t=e.target.getAttribute("data-value");o(M,j,$,k,t,e.target.textContent),m=t,a()}}))),document.addEventListener("click",(function(){n()}))}function t(e,t){const o=t.classList.contains("open");n(),o||(e.classList.add("open"),e.querySelector("svg").classList.add("open"),t.classList.add("open"))}function n(){const e=[P,T,j];[E,B,M].forEach((e=>{if(e){e.classList.remove("open");const t=e.querySelector("svg");t&&t.classList.remove("open")}})),e.forEach((e=>{e&&e.classList.remove("open")}))}function o(e,t,n,o,s,i){n.textContent=i,o&&(o.value=s),t.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")})),t.querySelector(`[data-value="${s}"]`).classList.add("selected"),e.classList.remove("open"),e.querySelector("svg").classList.remove("open"),t.classList.remove("open")}function s(){let e="";if("all"!==p&&(e+=`[data-category~="${p.toLowerCase().replace(/[^a-z0-9\s,]/g,"").replace(/\s+/g,"-")}"]`),"all"!==g&&(e+=`[data-status="${g}"]`),"all"!==h&&(e+=`[data-type="${h}"]`),u){const t=document.querySelectorAll(e||".mix"),n=[];t.forEach((function(e){const t=e.getAttribute("data-title")||"",o=e.querySelector("td:nth-child(4)").textContent.toLowerCase(),s=t.includes(u),i=o.includes(u);if(s||i){const t=e.getAttribute("data-title"),o=e.getAttribute("data-price"),s=e.getAttribute("data-stock");e.getAttribute("data-category"),e.getAttribute("data-status"),n.push(`[data-title="${t}"][data-price="${o}"][data-stock="${s}"]`)}})),e=n.length>0?n.join(", "):".no-matches"}return e||(e=".mix"),e}function i(){const e=window.productMixer||l;if(!e)return;if(e.isBusy&&e.isBusy())return;const t=s();return document.querySelectorAll(".mix").forEach((e=>{e.style.display=""})),e.filter(".mix").then((function(){return e.filter(t)})).then((function(e){filteredItems=e.matching,currentPage=1,"default"!==m?a():(updatePagination(),applyPagination()),r()})).catch((function(){}))}function a(){if(!window.productMixer)return;let e;if("default"!==m){const[t,n]=m.split(":");e=`${t}:${n}`}else e="default:asc";window.productMixer.sort(e).then((function(e){filteredItems=e.matching,updatePagination(),applyPagination(),r()})).catch((function(){}))}function r(){const e=document.getElementById("reset-filters-btn");e&&(e.disabled=!(""!==u||"all"!==p||"all"!==g||"all"!==h||"default"!==m))}function c(){y&&y.addEventListener("input",(function(){d&&clearTimeout(d);const e=this;d=setTimeout((()=>{const t=e.value.toLowerCase();u=t,i()}),300)})),b&&b.addEventListener("change",(function(){itemsPerPage=parseInt(this.value),currentPage=1,updatePagination(),applyPagination()})),C&&C.addEventListener("click",(function(){!function(){if(y&&(y.value="",u=""),f&&(f.value="all",p="all"),I&&(I.textContent="All categories",P)){P.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")}));const e=P.querySelector('[data-value="all"]');e&&e.classList.add("selected")}if(v&&(v.value="all",g="all"),D&&(D.textContent="All status",T)){T.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")}));const e=T.querySelector('[data-value="all"]');e&&e.classList.add("selected")}if(w&&(w.value="all",h="all"),A&&(A.textContent="All types",x)){x.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")}));const e=x.querySelector('[data-value="all"]');e&&e.classList.add("selected")}if(k&&(k.value="default",m="default"),$&&($.textContent="Sort by",j)){j.querySelectorAll(".select-option").forEach((e=>{e.classList.remove("selected")}));const e=j.querySelector('[data-value="default"]');e&&e.classList.add("selected")}currentPage=1,i().then((()=>{if(window.productMixer)return window.productMixer.sort("default:asc")})).then((()=>{})).catch((()=>{})),r()}()}))}let l,d,u="",p="all",g="all",h="all",m="default";const y=document.getElementById("search-input"),f=document.getElementById("category-filter"),v=document.getElementById("status-filter"),w=document.getElementById("type-filter"),k=document.getElementById("sort-select"),b=document.getElementById("items-per-page"),C=document.getElementById("reset-filters-btn"),S=document.getElementById("product-container"),E=document.getElementById("category-filter-trigger"),P=document.getElementById("category-filter-dropdown"),I=document.getElementById("category-filter-text"),L=document.getElementById("type-filter-trigger"),x=document.getElementById("type-filter-dropdown"),A=document.getElementById("type-filter-text"),B=document.getElementById("status-filter-trigger"),T=document.getElementById("status-filter-dropdown"),D=document.getElementById("status-filter-text"),M=document.getElementById("sort-filter-trigger"),j=document.getElementById("sort-filter-dropdown"),$=document.getElementById("sort-filter-text");if(S)return function t(){if(window.mixitup||document.querySelector('script[src*="mixitup"]'))window.mixitup?(c(),e()):setTimeout(t,100);else{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/mixitup/3.3.1/mixitup.min.js",document.head.appendChild(t),t.onload=function(){c(),e()}}}(),{filterProducts:i,buildFilterString:s,initializeMixer:function(){if("undefined"!=typeof mixitup)try{const e=document.getElementById("product-container");l&&"function"==typeof l.destroy&&l.destroy(),e&&e._mixitup&&e._mixitup.destroy(),l=mixitup("#product-container",{selectors:{target:".master-product-row"},animation:{duration:300,effects:"fade",easing:"ease"},data:{uidKey:"id"},callbacks:{onMixEnd:function(){}}}),l.getState()}catch(e){}}}}function applyPagination(){filteredItems.forEach((e=>{e.style.display="none"}));const e=(currentPage-1)*itemsPerPage;filteredItems.slice(e,e+itemsPerPage).forEach((e=>{e.style.display=""})),updatePaginationInfo()}function updatePagination(){const e=Math.ceil(filteredItems.length/itemsPerPage),t=document.getElementById("page-numbers");if(t){t.innerHTML="";for(let n=1;n<=e;n++){const e=document.createElement("button");e.className="page-btn "+(n===currentPage?"active":""),e.textContent=n,e.addEventListener("click",(function(){currentPage=n,document.querySelectorAll(".page-btn").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),applyPagination()})),t.appendChild(e)}}}function updatePaginationInfo(){const e=filteredItems.length,t=0===e?0:(currentPage-1)*itemsPerPage+1,n=Math.min(currentPage*itemsPerPage,e),o=document.getElementById("pagination-info");o&&(o.textContent=`Showing ${t} to ${n} of ${e} products`)}function initializeMixItUpAfterProducts(){if(window.productMixer&&"function"==typeof window.productMixer.destroy){try{window.productMixer.destroy()}catch(e){}window.productMixer=null}if("undefined"!=typeof mixitup)try{if(document.getElementById("product-container"),0===document.querySelectorAll(".master-product-row").length)return;const e=mixitup("#product-container",{selectors:{target:".master-product-row"},animation:{duration:300,effects:"fade",easing:"ease"},callbacks:{onMixEnd:function(){}}});window.productMixer=e;const t=e.getState();filteredItems=t.targets,updatePagination(),applyPagination()}catch(e){}}function initializeTableInteractions(){document.addEventListener("mousemove",(function(e){const t=e.target.closest("td.editing-no-changes, td.editing-with-changes");if(t&&t.matches("td:nth-child(2), td:nth-child(3), td:nth-child(4), td:nth-child(6), td:nth-child(7)")){const n=t,o=n.getBoundingClientRect(),s=e.clientX,i=e.clientY,a=o.right,r=a-36,c=a-60,l=a-36,d=i>=o.top+o.height/2-9&&i<=o.top+o.height/2+9;n.classList.remove("icon-hover-cancel","icon-hover-save"),d&&(n.classList.contains("editing-with-changes")?s>=r?n.classList.add("icon-hover-save"):s>=c&&s<r&&n.classList.add("icon-hover-cancel"):n.classList.contains("editing-no-changes")&&s>=l&&n.classList.add("icon-hover-cancel"))}else document.querySelectorAll(".icon-hover-cancel, .icon-hover-save").forEach((e=>{e.classList.remove("icon-hover-cancel","icon-hover-save")}))})),document.addEventListener("mouseleave",(function(e){e.target&&e.target.matches&&e.target.matches("td.editing-no-changes, td.editing-with-changes")&&e.target.classList.remove("icon-hover-cancel","icon-hover-save")})),document.addEventListener("mouseleave",(function(e){e.target===document.documentElement&&document.querySelectorAll(".icon-hover-cancel, .icon-hover-save").forEach((e=>{e.classList.remove("icon-hover-cancel","icon-hover-save")}))})),document.addEventListener("click",(function(e){const t=e.target.closest("td.editing-no-changes, td.editing-with-changes");if(t&&t.matches("td:nth-child(2), td:nth-child(3), td:nth-child(4), td:nth-child(6), td:nth-child(7)")){const n=t,o=n.getBoundingClientRect(),s=e.clientX,i=e.clientY,a=o.right,r=a-36,c=a-60,l=a-36;let d=!1;if(i>=o.top+o.height/2-9&&i<=o.top+o.height/2+9)if(n.classList.contains("editing-with-changes")){if(s>=r){e.preventDefault(),e.stopPropagation(),d=!0;const t=n.querySelector("input.editable-input"),o=n.querySelector("select.editable-select"),s=n.querySelector(".stock-editor"),i=n.querySelector(".sale-toggle-editor");if(t){t.setAttribute("data-confirmed-save","true");const e=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",bubbles:!0});t.dispatchEvent(e)}else if(o){o.setAttribute("data-confirmed-save","true");const e=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",bubbles:!0});o.dispatchEvent(e)}else if(s){const e=s.querySelector(".stock-input");if(e){e.setAttribute("data-confirmed-save","true");const t=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",bubbles:!0});e.dispatchEvent(t)}}else i&&n.classList.remove("editing-with-changes","editing-no-changes")}else if(s>=c&&s<r){e.preventDefault(),e.stopPropagation(),d=!0;const t=n.getAttribute("data-original-value")||"Unknown";n.innerHTML=t,n.classList.remove("editing-with-changes","editing-no-changes")}}else if(n.classList.contains("editing-no-changes")&&s>=l){e.preventDefault(),e.stopPropagation(),d=!0;const t=n.getAttribute("data-original-value")||"Unknown";n.innerHTML=t,n.classList.remove("editing-with-changes","editing-no-changes")}if(d)return}if("INPUT"!==e.target.tagName&&"SELECT"!==e.target.tagName||!e.target.classList.contains("editable-input")&&!e.target.classList.contains("editable-select"))if(e.target.closest("td:nth-child(2)")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.querySelector("input")&&makeFieldEditable(t,n,"title")}else if(e.target.closest("td:nth-child(3)")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.querySelector("input")&&makeFieldEditable(t,n,"url")}else if(e.target.closest("td:nth-child(4)")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.querySelector("input")&&"N/A"!==t.textContent.trim()&&makeFieldEditable(t,n,"sku")}else if(e.target.closest("td:nth-child(5)")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.classList.contains("editing")&&showCategoryPopup(t,n)}else if(e.target.closest("td:nth-child(6)")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.querySelector("input")&&makeFieldEditable(t,n,"price")}else if(e.target.closest("td:nth-child(7)")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.querySelector("input")&&"N/A"!==t.textContent.trim()&&makeFieldEditable(t,n,"salePrice")}else if(e.target.closest("td:nth-child(8)")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&makeFieldEditable(t,n,"onSale")}else if(e.target.closest("td:nth-child(9)")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.classList.contains("non-editable")&&showStockPopup(t,n)}else if(e.target.closest("td:nth-child(11)")&&!e.target.querySelector("select")){const t=e.target.closest("td"),n=t.closest("tr");n&&n.classList.contains("mix")&&!t.querySelector("select")&&makeFieldEditable(t,n,"status")}else if(e.target.closest(".scheduled-date-cell")&&!e.target.querySelector("input")){const t=e.target.closest("td"),n=t.closest("tr"),o=t.textContent.trim();n&&n.classList.contains("mix")&&o&&""!==o&&showSchedulePopup(t)}})),document.addEventListener("mouseover",(function(e){const t=e.target.closest("td:nth-child(2)"),n=e.target.closest("td:nth-child(3)"),o=e.target.closest("td:nth-child(4)"),s=e.target.closest("td:nth-child(6)"),i=e.target.closest("td:nth-child(7)"),a=e.target.closest("td:nth-child(9)"),r=e.target.closest("td:nth-child(11)");t&&t.closest(".mix")&&!t.querySelector("input")?t.title="Click to edit title":n&&n.closest(".mix")&&!n.querySelector("input")?n.title="Click to edit URL slug":o&&o.closest(".mix")&&!o.querySelector("input")&&"N/A"!==o.textContent.trim()?o.title="Click to edit SKU":s&&s.closest(".mix")&&!s.querySelector("input")?s.title="Click to edit price":i&&i.closest(".mix")&&!i.querySelector("input")?i.title="Click to edit sale price":a&&a.closest(".mix")&&!a.classList.contains("non-editable")?a.title="Click to edit stock level":r&&r.closest(".mix")&&!r.querySelector("select")&&(r.title="Click to edit status")}))}function makeFieldEditable(e,t,n){document.querySelectorAll(".mix td").forEach((t=>{if(t._documentClickHandler&&(document.removeEventListener("click",t._documentClickHandler),delete t._documentClickHandler),t!==e){const e=t.querySelector("input.editable-input"),n=t.querySelector("select.editable-select"),o=t.querySelector(".stock-editor"),s=t.querySelector(".sale-toggle-editor");if(e||n||o||s){const e=t.getAttribute("data-original-value")||t.textContent.trim()||"Unknown";t.innerHTML=e,t.removeAttribute("data-original-value"),t.removeAttribute("data-new-value"),t.removeAttribute("data-field-type"),t.classList.remove("modified","editing-with-changes","editing-no-changes")}}}));const o=e.textContent.trim();let s,i=null,a=!1;if("title"===n&&e.querySelector(".expand-btn")&&(a=!0,i=e.innerHTML,e.setAttribute("data-original-html",i)),e.setAttribute("data-original-value",o),"onSale"===n){const s=o.includes("Yes")?"Yes":"No",i=document.createElement("select");i.className="editable-select onSale-dropdown";const a=document.createElement("option");a.value="Yes",a.textContent="Yes","Yes"===s&&(a.selected=!0);const r=document.createElement("option");return r.value="No",r.textContent="No","No"===s&&(r.selected=!0),i.appendChild(a),i.appendChild(r),e.innerHTML="",e.appendChild(i),i.addEventListener("change",(()=>{const s=i.value,a=`<span class="status-badge ${"Yes"===s?"public":"hidden"}">${s}</span>`;e.classList.add("modified"),e.setAttribute("data-field-type",n),e.setAttribute("data-original-value",o),e.setAttribute("data-new-value",s),setTimeout((()=>{e.innerHTML=a,"function"==typeof trackChanges&&trackChanges(e,t)}),300)})),void i.focus()}if("status"===n){s=document.createElement("select"),s.className="editable-select",s.innerHTML='\n            <option value="public">Public</option>\n            <option value="hidden">Hidden</option>\n            <option value="scheduled">Scheduled</option>\n        ';const n=document.createElement("div");n.innerHTML=o;const i=n.querySelector(".status-badge"),a=i?i.textContent.toLowerCase():o.toLowerCase();s.value=a,s.addEventListener("change",(()=>{if("scheduled"===s.value){const n=new Date;n.setDate(n.getDate()+1),n.setHours(9,0,0,0);const s=n.toISOString().slice(0,16);if(e.setAttribute("data-scheduled-date",s),window.currentSchedulingContext={cell:e,row:t,originalValue:o,currentScheduledDate:s},e.innerHTML='<span class="status-badge scheduled">Scheduled</span>',e.classList.add("modified"),e.setAttribute("data-field-type","status"),e.setAttribute("data-original-value",o),e.setAttribute("data-new-value","scheduled"),"function"==typeof trackChanges&&trackChanges(e,t),"function"==typeof updateScheduledColumnVisibility&&setTimeout(updateScheduledColumnVisibility,10),"function"==typeof addScheduledDateToRow){const e=n.toLocaleDateString()+" "+n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});addScheduledDateToRow(t,e)}showSchedulePopup(e)}else setTimeout((()=>{l(!0)}),10)}))}else if(s=document.createElement("input"),s.type="text",s.className="editable-input","price"===n||"salePrice"===n){const e=o.replace(/[^0-9.]/g,"");s.value=e}else s.value=o;e.innerHTML="",e.appendChild(s);const r=["title","url","sku","price","salePrice"].includes(n);r&&e.classList.add("editing-no-changes");const c=()=>{const t=s.value.trim();let i;if("price"===n||"salePrice"===n)i=o.replace(/[^0-9.]/g,"");else if("status"===n){const e=document.createElement("div");e.innerHTML=o;const t=e.querySelector(".status-badge");i=t?t.textContent.toLowerCase():o.toLowerCase()}else i=o;r&&(t!==i&&""!==t?(e.classList.remove("editing-no-changes"),e.classList.add("editing-with-changes")):(e.classList.remove("editing-with-changes"),e.classList.add("editing-no-changes")))};s.addEventListener("input",c),s.addEventListener("change",c),"SELECT"===s.tagName&&s.addEventListener("change",(()=>{setTimeout((()=>{l(!0)}),10)})),s.focus(),"text"===s.type&&s.select();const l=(i=!1)=>{const a=s.value.trim();let c,l,u;if("price"===n||"salePrice"===n){const t=parseFloat(a);if(isNaN(t)||!(t>=0))return e.innerHTML=o,e.classList.remove("editing-with-changes"),void d();c=`$${t.toFixed(2)}`,l=t.toString()}else if("status"===n)l=a,c=`<span class="status-badge ${a.toLowerCase()}">${a.charAt(0).toUpperCase()+a.slice(1)}</span>`,"scheduled"===a&&window.schedulingContext&&window.schedulingContext.scheduledDate&&e.setAttribute("data-scheduled-date",window.schedulingContext.scheduledDate);else if(c=a,l=a,"title"===n){const t=e.getAttribute("data-original-html");if(t&&t.includes("expand-btn")){const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector(".expand-btn");n&&(c=`${n.outerHTML} ${a}`)}}if("price"===n||"salePrice"===n)u=o.replace(/[^0-9.]/g,"");else if("status"===n){const e=document.createElement("div");e.innerHTML=o;const t=e.querySelector(".status-badge");u=t?t.textContent.toLowerCase():o.toLowerCase()}else u=o;if(l!==u){if(("status"===n||i)&&(e.classList.add("modified"),e.setAttribute("data-field-type",n),e.setAttribute("data-original-value",o),e.setAttribute("data-new-value",l),"function"==typeof trackChanges&&trackChanges(e,t)),e.innerHTML=c,"title"===n){const n=e.querySelector(".expand-btn");n&&n.addEventListener("click",(function(e){e.stopPropagation();const n=t.getAttribute("data-product-id"),o=globalProductsData?globalProductsData.find((e=>e.id===n)):null;o&&"function"==typeof toggleVariantRows&&toggleVariantRows(t,o)}))}if("status"===n&&"function"==typeof updateScheduledColumnVisibility&&setTimeout(updateScheduledColumnVisibility,10),"title"===n){const n=t.querySelector("td:nth-child(3)");if(n){const s=n.textContent.trim();if(shouldSuggestURL(o,l,s)){const n=generateSlug(l);showURLSuggestion(n,e,t)}}}}else{const s=e.getAttribute("data-original-html");if("title"===n&&s){e.innerHTML=s;const n=e.querySelector(".expand-btn");n&&n.addEventListener("click",(function(e){e.stopPropagation();const n=t.getAttribute("data-product-id"),o=globalProductsData?globalProductsData.find((e=>e.id===n)):null;o&&"function"==typeof toggleVariantRows&&toggleVariantRows(t,o)}))}else e.innerHTML=o}r&&e.classList.remove("editing-with-changes","editing-no-changes"),d()},d=()=>{e._documentClickHandler&&(document.removeEventListener("click",e._documentClickHandler),delete e._documentClickHandler),"title"===n&&e.removeAttribute("data-original-html")};s.addEventListener("keydown",(i=>{if("Enter"===i.key){i.preventDefault();const e=s.hasAttribute("data-confirmed-save");e&&s.removeAttribute("data-confirmed-save"),l(e)}else"Escape"===i.key&&(i.preventDefault(),(()=>{const s=e.getAttribute("data-original-html");if("title"===n&&s){e.innerHTML=s;const n=e.querySelector(".expand-btn");n&&n.addEventListener("click",(function(e){e.stopPropagation();const n=t.getAttribute("data-product-id"),o=globalProductsData?globalProductsData.find((e=>e.id===n)):null;o&&"function"==typeof toggleVariantRows&&toggleVariantRows(t,o)}))}else e.innerHTML=o;r&&e.classList.remove("editing-with-changes","editing-no-changes"),d()})())}));const u=t=>{e.contains(t.target)||e.contains(t.target)||setTimeout((()=>{l()}),50)};e._documentClickHandler=u,setTimeout((()=>{document.addEventListener("click",u)}),100)}function initializeSelectAll(){function e(){const e=document.querySelectorAll('.mix input[type="checkbox"]'),n=document.querySelectorAll('.mix input[type="checkbox"]:checked');0===n.length?(t.checked=!1,t.indeterminate=!1):n.length===e.length?(t.checked=!0,t.indeterminate=!1):(t.checked=!1,t.indeterminate=!0),updateProductSelectionCounter(n.length),"function"==typeof updateBulkAdjustButton&&updateBulkAdjustButton()}const t=document.getElementById("select-all-checkbox");t&&(t.addEventListener("change",(function(){const t=this.checked;document.querySelectorAll('.mix input[type="checkbox"]').forEach((e=>{e.checked=t})),e()})),document.addEventListener("change",(function(t){"checkbox"===t.target.type&&t.target.closest(".mix")&&e()})))}function generateSlug(e){return e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}function shouldSuggestURL(e,t,n){if(!e||!t||e===t)return!1;const o=generateSlug(t);return o.length>0&&o!==n}function showURLSuggestion(e,t,n){const o=document.getElementById("url-suggestion-tooltip"),s=document.getElementById("url-suggestion-preview"),i=document.getElementById("url-suggestion-apply"),a=document.getElementById("url-suggestion-cancel"),r=document.getElementById("url-suggestion-close"),c=document.getElementById("url-create-redirect"),l=n.querySelector("td:nth-child(3)");l&&l.textContent.trim(),s&&(s.textContent=e);const d=t.getBoundingClientRect(),u=window.pageYOffset||document.documentElement.scrollTop,p=window.pageXOffset||document.documentElement.scrollLeft;o.style.position="absolute",o.style.top=d.bottom+u+10+"px",o.style.left=d.left+p+"px",o.style.zIndex="10000",o.classList.remove("hidden"),o.classList.add("visible"),o.setAttribute("data-target-row-id",n.getAttribute("data-product-id"));const g=()=>{if(l&&!l.classList.contains("modified")){const t=l.textContent.trim();l.textContent=e,l.setAttribute("data-new-value",e),l.setAttribute("data-field-type","url"),l.classList.add("modified"),c.checked&&t&&t!==e&&window.urlRedirects.set(t,e),"function"==typeof trackChanges&&trackChanges(l,n)}hideURLSuggestion()},h=()=>{hideURLSuggestion()};i.addEventListener("click",g),a.addEventListener("click",h),r.addEventListener("click",h),o._cleanup=()=>{i.removeEventListener("click",g),a.removeEventListener("click",h),r.removeEventListener("click",h)}}function hideURLSuggestion(){const e=document.getElementById("url-suggestion-tooltip");e&&(e.classList.add("hidden"),e.classList.remove("visible"),e._cleanup&&(e._cleanup(),delete e._cleanup),e.removeAttribute("data-target-row-id"))}function showCategoryPopup(e,t){const n=document.getElementById("category-editor-popup"),o=document.getElementById("category-tags-display"),s=document.getElementById("category-popup-input"),i=document.getElementById("category-popup-suggestions"),a=n.querySelector(".category-existing-select"),r=(n.querySelector(".category-field-wrapper"),e.dataset.originalCategories||"");n.dataset.originalCategories=r,updateCategoryTagsDisplay(o,r),s.value="";const c=a.querySelector(".select-text"),l=a.querySelector(".select-dropdown");c.textContent="Select an existing category",c.classList.add("placeholder"),l.classList.remove("open"),i.style.display="none",populateExistingCategoriesDropdown(a,o),positionPopup(n,e),n.classList.remove("hidden"),n.classList.add("visible"),setTimeout((()=>s.focus()),100),setupPopupAutocompleteForNew(s,i,o),setupExistingCategoryDropdown(a,o),setupPopupRemoveHandlers(o);const d=n.querySelector("#category-popup-discard"),u=n.querySelector("#category-popup-save"),p=()=>{applyCategoryChanges(e,t,o),h()},g=()=>{h()},h=()=>{n.classList.remove("visible"),n.classList.add("hidden"),d.removeEventListener("click",g),u.removeEventListener("click",p),document.removeEventListener("click",m)},m=t=>{n.contains(t.target)||e.contains(t.target)||h()};d.addEventListener("click",g),u.addEventListener("click",p),setTimeout((()=>{document.addEventListener("click",m)}),100)}function positionPopup(e,t){const n=t.getBoundingClientRect();e.getBoundingClientRect();let o=n.bottom+window.scrollY+8,s=n.left+window.scrollX;s+320>window.innerWidth&&(s=window.innerWidth-320-20),s<20&&(s=20),e.style.position="absolute",e.style.top=`${o}px`,e.style.left=`${s}px`}function updateCategoryTagsDisplay(e,t){e.innerHTML="",t.trim()&&t.split(",").map((e=>e.trim())).filter((e=>""!==e)).forEach((t=>{addCategoryTagToDisplay(t,e)}))}function addCategoryTagToDisplay(e,t){const n=document.createElement("span");n.className="category-tag",n.innerHTML=`\n        ${e}\n        <button class="category-remove" data-category="${e}" title="Remove category">×</button>\n    `,t.appendChild(n)}function setupPopupAutocompleteForNew(e,t,n){e.replaceWith(e.cloneNode(!0)),(e=document.getElementById("category-popup-input")).addEventListener("input",(()=>{t.style.display=(e.value.trim(),"none")})),e.addEventListener("keydown",(o=>{"Enter"===o.key?(o.preventDefault(),e.value.trim()&&addCategoryToDisplay(e.value.trim(),n,e,t)):"Escape"===o.key&&(t.style.display="none",t.classList.remove("visible"))}))}function addCategoryToDisplay(e,t,n){if(!getCurrentCategoriesFromDisplay(t).includes(e)){addCategoryTagToDisplay(e,t),n&&(n.value="",n.focus()),setupPopupRemoveHandlers(t);const o=document.querySelector(".category-existing-select");o&&populateExistingCategoriesDropdown(o,t)}}function setupPopupRemoveHandlers(e){e.querySelectorAll(".category-remove").forEach((t=>{const n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const n=t.target.closest(".category-tag");if(n){n.remove();const t=document.querySelector(".category-existing-select");t&&populateExistingCategoriesDropdown(t,e)}}))}))}function getCurrentCategoriesFromDisplay(e){const t=e.querySelectorAll(".category-tag");return Array.from(t).map((e=>e.textContent.replace("×","").trim()))}function applyCategoryChanges(e,t,n){const o=getCurrentCategoriesFromDisplay(n),s=o.join(", "),i=e.dataset.originalCategories||"",a=i?i.split(", ").map((e=>e.trim())):[],r=o.filter((e=>!a.includes(e))),c=a.filter((e=>!o.includes(e)));e.innerHTML=s,e.dataset.originalCategories=s,e.classList.add("modified");const l=""===s.trim()?"uncategorized":s.toLowerCase().replace(/[^a-z0-9\s,]/g,"").replace(/\s+/g,"-").split(",").map((e=>e.trim())).join(" ");t.setAttribute("data-category",l),e.setAttribute("data-field-type","category"),e.setAttribute("data-original-value",i),e.setAttribute("data-new-value",s),r.length>0?e.setAttribute("data-categories-added",r.join(",")):e.removeAttribute("data-categories-added"),c.length>0?e.setAttribute("data-categories-removed",c.join(",")):e.removeAttribute("data-categories-removed"),"function"==typeof trackChanges&&trackChanges(e,t)}function getAvailableCategories(){const e=document.getElementById("category-filter-dropdown");if(e){const t=e.querySelectorAll('.select-option:not([data-value="all"])');if(t.length>0)return Array.from(t).map((e=>e.textContent.trim())).sort()}if(window.globalCategoriesData&&window.globalCategoriesData.length>0)return window.globalCategoriesData.map((e=>e.name)).sort();const t=new Set;document.querySelectorAll('[data-field-name="categories"]').forEach((e=>{const n=e.dataset.originalCategories||e.textContent||"";n.trim()&&n.split(",").forEach((e=>{const n=e.trim();n&&t.add(n)}))}));const n=Array.from(t);return 0===n.length?[]:n.sort()}function updateProductSelectionCounter(e){const t=document.getElementById("products-selected-text");t&&(t.textContent=0===e?"0 products selected":1===e?"1 product selected":`${e} products selected`)}function populateExistingCategoriesDropdown(e,t){const n=getAvailableCategories(),o=getCurrentCategoriesFromDisplay(t),s=e.querySelector(".select-dropdown");s.innerHTML="";const i=n.filter((e=>!o.includes(e)));0===i.length?s.innerHTML='<div class="select-option disabled">No categories available</div>':i.forEach((e=>{const t=document.createElement("div");t.className="select-option",t.dataset.value=e,t.textContent=e,s.appendChild(t)}))}function setupExistingCategoryDropdown(e,t){const n=e.querySelector(".select-trigger"),o=e.querySelector(".select-dropdown"),s=(e.querySelector(".select-arrow"),e.querySelector(".select-text"),n.cloneNode(!0)),i=o.cloneNode(!0);n.parentNode.replaceChild(s,n),o.parentNode.replaceChild(i,o);const a=e.querySelector(".select-trigger"),r=e.querySelector(".select-dropdown"),c=(e.querySelector(".select-arrow"),e.querySelector(".select-text"));a.addEventListener("click",(e=>{e.stopPropagation(),r.classList.contains("active")?(r.classList.remove("active"),a.classList.remove("active")):(r.classList.add("active"),a.classList.add("active"))})),r.addEventListener("click",(n=>{n.stopPropagation(),n.target.classList.contains("select-option")&&!n.target.classList.contains("disabled")&&(addCategoryToDisplay(n.target.dataset.value,t,null,null),r.classList.remove("active"),a.classList.remove("active"),c.textContent="Select an existing category",c.classList.add("placeholder"),populateExistingCategoriesDropdown(e,t))}));const l=t=>{e.contains(t.target)||(r.classList.remove("active"),a.classList.remove("active"))};document.addEventListener("click",l),e._outsideClickHandler=l}function showSchedulePopup(e){const t=document.getElementById("schedule-editor-popup"),n=document.getElementById("schedule-datetime-input");if(!t||!n)return;const o=new Date,s=window.currentSchedulingContext?.currentScheduledDate,i=e.getAttribute("data-scheduled-date");let a;a=s?new Date(s):i?new Date(i):new Date(o.getTime()+36e5),window.schedulePopupFlatpickr?window.schedulePopupFlatpickr.setDate(a):window.schedulePopupFlatpickr=window.initializeFlatpickr(n,{inline:!1,static:!0,altFormat:"F j, Y at h:i K",minDate:"today",defaultDate:a,clickOpens:!0,onChange:function(e){e.length>0&&(n.value=e[0].toISOString().slice(0,16))}});const r=e.closest("tr"),c=e.getAttribute("data-original-value")||e.textContent.trim();window.currentSchedulingContext={cell:e,row:r,originalValue:c,currentScheduledDate:n.value||a.toISOString().slice(0,16)},t.classList.remove("hidden"),t.classList.add("visible");let l=0;const d=()=>{l<10&&t.classList.contains("hidden")&&(t.classList.remove("hidden"),t.classList.add("visible"),l++,setTimeout(d,50))};setTimeout(d,25),setTimeout((()=>{n&&n.focus()}),100)}function hideSchedulePopup(){const e=document.getElementById("schedule-editor-popup");e&&(e.classList.remove("visible"),e.classList.add("hidden")),window.schedulePopupFlatpickr&&window.schedulePopupFlatpickr.close(),window.currentSchedulingContext=null}function saveScheduledDate(){const e=document.getElementById("schedule-datetime-input"),t=window.currentSchedulingContext;if(!t||!e.value)return;const{cell:n,row:o,originalValue:s}=t;n.setAttribute("data-scheduled-date",e.value),n.innerHTML='<span class="status-badge scheduled">Scheduled</span>',n.classList.add("modified"),n.setAttribute("data-field-type","status"),n.setAttribute("data-original-value",s),n.setAttribute("data-new-value","scheduled"),"function"==typeof trackChanges&&trackChanges(n,o),updateScheduledColumnVisibility(),addScheduledDateToRow(o,e.value),hideSchedulePopup()}function initializeSchedulePopup(){const e=document.getElementById("schedule-popup-cancel"),t=document.getElementById("schedule-popup-save");e&&e.addEventListener("click",(e=>{e.preventDefault(),hideSchedulePopup();const t=window.currentSchedulingContext;if(t){const{cell:e,originalValue:n}=t;e.innerHTML=n}})),t&&t.addEventListener("click",(e=>{e.preventDefault(),saveScheduledDate()})),document.addEventListener("click",(e=>{const t=document.getElementById("schedule-editor-popup");if(t&&!t.contains(e.target)&&!t.classList.contains("hidden")){const n=e.target.closest("td")&&e.target.closest("td").classList.contains("editable")&&"status"===e.target.closest("td").getAttribute("data-field"),o=e.target.closest("td")&&e.target.closest("td").classList.contains("scheduled-date-cell"),s="schedule-popup-save"===e.target.id||e.target.closest("#schedule-popup-save"),i=("schedule-popup-cancel"===e.target.id||e.target.closest("#schedule-popup-cancel"),t.contains(e.target));n||o||s||i||hideSchedulePopup()}}))}function updateScheduledColumnVisibility(){const e=document.getElementById("scheduled-header"),t=document.querySelectorAll(".scheduled-date-cell"),n=document.querySelectorAll("tr .status-badge.scheduled").length>0,o=document.querySelectorAll("[data-scheduled-date]").length>0,s=n||o;e&&(s?e.classList.remove("hidden"):e.classList.add("hidden")),t.forEach((e=>{s?e.classList.remove("hidden"):e.classList.add("hidden")}))}function addScheduledDateToRow(e,t){let n=e.querySelector(".scheduled-date-cell");n||(n=document.createElement("td"),n.className="scheduled-date-cell scheduled-column",e.appendChild(n));const o=new Date(t),s=o.toLocaleDateString()+" "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});n.textContent=s,n.classList.remove("hidden"),n.classList.add("editing-with-changes")}function showStockPopup(e,t){const n=document.getElementById("stock-editor-popup"),o=document.getElementById("stock-quantity-input"),s=document.getElementById("stock-track-inventory"),i=e.textContent.trim(),a="∞"===i||"Unlimited"===i;a?(s.checked=!1,o.disabled=!0,o.value="",o.placeholder="Unlimited stock"):(s.checked=!0,o.disabled=!1,o.value=i||"0",o.placeholder="0"),n.dataset.originalValue=i,n.dataset.targetCellId=t.getAttribute("data-product-id"),n.classList.remove("hidden"),n.classList.add("visible"),a||setTimeout((()=>o.focus()),100);const r=()=>{s.checked?(o.disabled=!1,o.placeholder="0",o.focus()):(o.disabled=!0,o.placeholder="Unlimited stock",o.value="")},c=document.getElementById("stock-popup-save"),l=document.getElementById("stock-popup-cancel"),d=()=>{let n;if(s.checked){const e=parseInt(o.value)||0;if(e<0)return alert("Please enter a valid stock quantity (0 or greater)"),void o.focus();n=e.toString()}else n="∞";n!==i&&(e.textContent=n,e.classList.add("modified"),e.setAttribute("data-field-type","stock"),e.setAttribute("data-original-value",i),e.setAttribute("data-new-value",n),"function"==typeof trackChanges&&trackChanges(e,t)),hideStockPopup()},u=()=>{hideStockPopup()},p=t=>{n.contains(t.target)||e.contains(t.target)||hideStockPopup()};s.addEventListener("change",r),c.addEventListener("click",d),l.addEventListener("click",u),setTimeout((()=>{document.addEventListener("click",p)}),100),n._cleanup=()=>{s.removeEventListener("change",r),c.removeEventListener("click",d),l.removeEventListener("click",u),document.removeEventListener("click",p)}}function hideStockPopup(){const e=document.getElementById("stock-editor-popup");e&&(e.classList.add("hidden"),e.classList.remove("visible"),e._cleanup&&(e._cleanup(),delete e._cleanup),e.removeAttribute("data-original-value"),e.removeAttribute("data-target-cell-id"))}function getJsonFileUrl(){const e=document.querySelector('meta[data-squarehero-plugin="product-manager"]');return e?e.getAttribute("settings"):null}async function loadUndoHistoryFromJson(){try{const e=getJsonFileUrl();if(!e)return void(undoHistory=[]);const t=await fetch(e,{method:"GET",cache:"no-cache"});if(!t.ok)return void(undoHistory=[]);const n=await t.json();n.undoHistory||(n.undoHistory=[]),undoHistory=n.undoHistory||[]}catch(e){undoHistory=[]}}async function initializeUndoSystem(){try{await loadUndoHistoryFromJson();const e=document.getElementById("undo-changes-btn");e&&e.addEventListener("click",openUndoDrawer),initializeUndoDrawerHandlers(),updateUndoButtonState()}catch(e){undoHistory||(undoHistory=[]),updateUndoButtonState()}}function initializeUndoDrawerHandlers(){const e=document.getElementById("undo-changes-drawer"),t=e?.querySelector(".undo-drawer-overlay"),n=e?.querySelector(".drawer-close"),o=document.getElementById("undo-selected-btn");t&&t.addEventListener("click",closeUndoDrawer),n&&n.addEventListener("click",closeUndoDrawer),o&&o.addEventListener("click",(()=>{null!==selectedUndoIndex&&restoreFromUndoIndex(selectedUndoIndex)})),e&&e.addEventListener("click",(t=>{t.target===e&&closeUndoDrawer()}))}function openUndoDrawer(){const e=document.getElementById("undo-changes-drawer");e&&(e.classList.add("visible"),populateUndoHistoryList())}function closeUndoDrawer(){const e=document.getElementById("undo-changes-drawer");e&&e.classList.remove("visible")}function populateUndoHistoryList(){const e=document.querySelector("#undo-changes-drawer .undo-history-list"),t=document.getElementById("undo-status-count"),n=document.getElementById("undo-info-text"),o=document.getElementById("undo-selected-btn");if(e){if(t){const e=undoHistory.length;t.textContent=0===e?"No Changes Available":1===e?"1 Change Available":`${e} Changes Available`}if(n&&(n.textContent=0===undoHistory.length?"No restore points":"Choose a restore point"),e.innerHTML="",0===undoHistory.length)return e.innerHTML='\n            <div class="undo-empty-state">\n                <div class="empty-icon">\n                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M4 10H20M4 10L8 6M4 10L8 14" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                    </svg>\n                </div>\n                <h4>No Changes to Undo</h4>\n                <p>Make some bulk changes to see undo history here</p>\n            </div>\n        ',void(o&&(o.disabled=!0));undoHistory.forEach(((t,n)=>{const o=document.createElement("div");o.className="undo-history-item",o.dataset.index=n;const s=new Date(t.timestamp),i=formatTimeAgo(s),a=getDetailedTimestamp(s),r=t.productCount||0,c=1===r?"product":"products",l=t.detailedDescription||t.action||"Bulk Changes",d=t.productTitles||[],u=d.length>0?d.slice(0,3).join(", ")+(d.length>3?"...":""):"Products";o.innerHTML=`\n            <div class="undo-item-content">\n                <div class="undo-item-header">\n                    <div class="undo-item-title">${l}</div>\n                    <div class="undo-item-time" title="${a}">${i}</div>\n                </div>\n                <div class="undo-item-details">\n                    <span class="undo-item-count">${r} ${c}</span>\n                    <span class="undo-item-products">${u}</span>\n                </div>\n            </div>\n        `,o.addEventListener("click",(()=>{toggleUndoItemSelection(o,n)})),e.appendChild(o)})),updateRestoreButtonState()}}function toggleUndoItemSelection(e,t){const n=e.classList.contains("selected");document.querySelectorAll(".undo-history-item").forEach((e=>{e.classList.remove("selected")})),n?selectedUndoIndex=null:(e.classList.add("selected"),selectedUndoIndex=t),updateRestoreButtonState()}function updateRestoreButtonState(){const e=document.getElementById("undo-selected-btn");e&&(e.disabled=null===selectedUndoIndex,e.textContent=null!==selectedUndoIndex?"Restore Selected":"Select Item to Restore")}function formatTimeAgo(e){const t=new Date(e),n=new Date,o=n-t,s=Math.floor(o/6e4),i=Math.floor(o/36e5),a=Math.floor(o/864e5);if(s<1)return"Just now";if(s<60)return`${s}m ago`;if(i<24)return`${i}h ago`;if(a<7)return`${a}d ago`;const r={month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return t.getFullYear()!==n.getFullYear()&&(r.year="numeric"),t.toLocaleDateString("en-US",r)}function getDetailedTimestamp(e){return new Date(e).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}function captureUndoSnapshot(e="Bulk Changes"){try{const t=getSelectedProductsWithData();if(!t||0===t.products.length)return;const n={timestamp:(new Date).toISOString(),action:e,productCount:t.products.length,productTitles:t.products.map((e=>e.title||"Untitled Product")).slice(0,5),filename:`undo_${Date.now()}.json`,fileUrl:null,productData:t.products.map((e=>({id:e.id,title:e.title,price:e.price,salePrice:e.salePrice,status:e.status,categories:e.categories?[...e.categories]:[],tags:e.tags?[...e.tags]:[],stock:e.stock,sku:e.sku,variants:e.variants?JSON.parse(JSON.stringify(e.variants)):[]})))};undoHistory.unshift(n),undoHistory.length>MAX_UNDO_HISTORY&&(undoHistory=undoHistory.slice(0,MAX_UNDO_HISTORY)),updateUndoButtonState()}catch(e){}}async function restoreFromUndoIndex(e){try{if(e<0||e>=undoHistory.length)return;const t=undoHistory[e];if(!t.productData||!Array.isArray(t.productData))return;showMessage("Restoring changes...","info");let n=0;for(const e of t.productData)try{await restoreSingleProduct(e),n++}catch(e){}undoHistory=undoHistory.slice(e+1),updateUndoButtonState(),closeUndoDrawer(),await loadProductsData(),showMessage(`Successfully restored ${n} products`,"success")}catch(e){showMessage("Error restoring changes","error")}}async function restoreSingleProduct(e){try{const t={title:e.title,price:e.price,salePrice:e.salePrice,status:e.status,categories:e.categories||[],tags:e.tags||[],stock:e.stock,sku:e.sku};e.variants&&e.variants.length>0&&(t.variants=e.variants);const n=await fetch(`/api/commerce/products/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`Failed to restore product ${e.id}: ${n.status}`);return await n.json()}catch(e){throw e}}function updateUndoButtonState(){const e=document.getElementById("undo-changes-btn");e&&(e.disabled=!(undoHistory&&undoHistory.length>0))}async function getCurrentUrlMappings(){const e=getCsrfToken();if(!e)return"";try{const t=await fetch("/api/config/GetAdvancedSettings",{method:"GET",headers:{accept:"application/json, text/plain, */*","x-csrf-token":e},credentials:"include"});return t.ok&&(await t.json()).mappings||""}catch(e){return""}}async function saveUrlMappings(e){const t=getCsrfToken();if(!t)return!1;try{const n=`mappings=${encodeURIComponent(e)}`,o=await fetch("/api/config/SaveAdvancedSettings",{method:"POST",headers:{accept:"application/json, text/plain, */*","content-type":"application/x-www-form-urlencoded","x-csrf-token":t},body:n,credentials:"include"});return!!o.ok||(await o.text(),!1)}catch(e){return!1}}async function applyUrlRedirects(){if(0===window.urlRedirects.size)return!0;try{const e=await getCurrentUrlMappings();if(null===e)return!1;const t=e.split("\n").filter((e=>e.trim())),n=[];window.urlRedirects.forEach(((e,t)=>{const o=t.startsWith("/")?t:`/${t}`,s=e.startsWith("/")?e:`/${e}`,i=o.endsWith("/")?o:`${o}/`,a=s.endsWith("/")?s:`${s}/`;n.push(`${i} -> ${a} 301`)}));const o=[...t,...n].join("\n");return!!await saveUrlMappings(o)&&(window.urlRedirects.clear(),!0)}catch(e){return!1}}function getJsonFileUrl(){const e=document.querySelector('meta[data-squarehero-plugin="product-manager"]');return e?e.getAttribute("settings"):null}function extractFileIdFromUrl(e){if(!e)return null;const t=e.match(/\/t\/([^\/]+)\//);return t?t[1]:null}async function deleteOldJsonFile(e){const t=getCsrfToken();if(!t||!e)return!1;try{const n=extractFileIdFromUrl(e);if(!n)return!1;const o=window.location.hostname.includes("squarespace.com")?window.location.pathname.split("/")[2]:"current",s=new URLSearchParams({crumb:t,websiteId:o,templateId:"5c5a519771c10ba3470d8101",filename:n});return!!(await fetch(`${window.location.origin}/api/template/RemoveTemplateCSSAsset`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s})).ok}catch(e){return!1}}async function updateMetaTagWithJsonUrl(e){const t=getCsrfToken();if(!t)return!1;try{const n=await fetch(`${window.location.origin}/api/config/GetInjectionSettings`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`crumb=${t}`}),o=await n.json(),s=`\n\x3c!-- SquareHero Product Manager Settings --\x3e\n<meta data-squarehero-plugin="product-manager" settings="${e}">\n`;let i=o.header||"";const a=/<!-- SquareHero Product Manager Settings -->\s*<meta data-squarehero-plugin="product-manager"[^>]*>\s*/g;a.test(i)?i=i.replace(a,s):i+=s;const r=new URLSearchParams({crumb:t,header:i,footer:o.footer||"",codeInjection:"true"});if((await fetch(`${window.location.origin}/api/config/SaveInjectionSettings`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r})).ok){let t=document.querySelector('meta[data-squarehero-plugin="product-manager"]');if(t)t.setAttribute("settings",e);else{const t=document.createElement("meta");t.setAttribute("data-squarehero-plugin","product-manager"),t.setAttribute("settings",e),document.head.appendChild(t)}return!0}return!1}catch(e){return!1}}function generateUrlSlug(e){return e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}function checkUrlSlugExists(e,t=null){return globalProductsData.some((n=>(!t||n.id!==t)&&n.urlSlug===e))}function generateUniqueUrlSlug(e,t=null){let n=generateUrlSlug(e),o=n,s=1;for(;checkUrlSlugExists(o,t);)o=`${n}-${s}`,s++;return o}function showUrlSuggestion(e,t,n,o){const s=document.getElementById("url-suggestion-tooltip"),i=document.getElementById("url-suggestion-preview");if(!s||!i)return;i.textContent=n;const a=o.getBoundingClientRect();s.style.left=a.left+"px",s.style.top=a.bottom+10+"px",s.classList.remove("hidden"),s.dataset.productId=e,s.dataset.oldUrl=t,s.dataset.newUrl=n}function hideUrlSuggestion(){const e=document.getElementById("url-suggestion-tooltip");e&&(e.classList.add("hidden"),delete e.dataset.productId,delete e.dataset.oldUrl,delete e.dataset.newUrl)}function applyUrlSuggestion(){const e=document.getElementById("url-suggestion-tooltip");if(!e)return;const t=e.dataset.productId,n=e.dataset.oldUrl,o=e.dataset.newUrl,s=e.querySelector('input[type="checkbox"]');if(!t||!o)return;const i=document.querySelector(`tr[data-product-id="${t}"]`);if(i){const e=i.querySelector('input[data-field="urlSlug"]');e&&(e.value=o,e.classList.add("modified"),s&&s.checked&&n!==o&&window.urlRedirects.set(n,o))}hideUrlSuggestion()}function initializeUrlManagement(){const e=document.getElementById("url-suggestion-apply");e&&e.addEventListener("click",applyUrlSuggestion);const t=document.getElementById("url-suggestion-cancel");t&&t.addEventListener("click",hideUrlSuggestion),document.addEventListener("click",(e=>{const t=document.getElementById("url-suggestion-tooltip");!t||t.contains(e.target)||e.target.closest('input[data-field="title"]')||hideUrlSuggestion()}))}async function startApplication(){if(new URLSearchParams(window.location.search).has("siteActivated")){window.licenseManager&&window.licenseManager.clearCache();const e=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.replaceState({path:e},"",e)}try{if("blocked"===await initializeLicensing())return}catch(e){return}if(window.currencyManager){const e=window.currencyManager.getCurrency();e&&"function"==typeof e.then?e.then((e=>{updateCurrencyHeaders(e)})).catch((()=>{updateCurrencyHeaders(window.currencyManager.getCurrencySync())})):updateCurrencyHeaders(e),window.addEventListener("currencyDetected",(e=>{updateCurrencyHeaders(e.detail.currency)}))}setupPreviewToggle(),setTimeout((()=>{"function"==typeof loadProducts&&loadProducts(),"function"==typeof initializeTableInteractions&&initializeTableInteractions(),"function"==typeof initializeSchedulePopup&&initializeSchedulePopup(),"function"==typeof initializeProductTable&&initializeProductTable(),"function"==typeof initializeSelectAll&&initializeSelectAll(),"function"==typeof initializeSearchFiltering&&initializeSearchFiltering(),"function"==typeof initializeDataUtilities&&initializeDataUtilities(),"function"==typeof initializeBulkEditor&&initializeBulkEditor(),"function"==typeof initializeBulkChangeApplication&&initializeBulkChangeApplication(),"function"==typeof initializeUrlManagement&&initializeUrlManagement(),setTimeout((()=>{"function"==typeof initializeBulkAdjust&&initializeBulkAdjust()}),1e3)}),100)}async function initializeLicensing(){if(!window.licenseManager)return"blocked";if(licenseValidationInProgress)return!!isLicensed||"demo";licenseValidationInProgress=!0;try{const e=await window.licenseManager.initialize();return isLicensed=e,e?(window.licenseManager.enablePlugin(),!0):window.licenseManager.isBlocked&&window.licenseManager.isBlocked()?"blocked":(isLicensed=!1,"demo")}catch(e){return isLicensed=!1,"blocked"}finally{licenseValidationInProgress=!1}}function _0xe5da8364(){return{licensed:isLicensed,status:window.licenseManager?window.licenseManager.getLicenseStatus():{licensed:!1,status:"no_manager"}}}function showMessage(e,t="info"){"function"==typeof showBulkNotification&&showBulkNotification(e,t)}function setupPreviewToggle(){const e=document.getElementById("preview-toggle-btn");let t=!1;e&&(updateToggleIcon(e,t),e.addEventListener("click",(function(){try{const n=window.parent.document.querySelector("#frame-toolbar-desktop"),o=n?n.querySelector('[aria-label="Preview"]'):window.parent.document.querySelector('[aria-label="Preview"]');o&&(o.click(),t=!t,updateToggleIcon(e,t))}catch(e){}})))}function updateToggleIcon(e,t){const n=e.querySelector("svg path");n&&n.setAttribute("d",t?"M1 10H6V15M15 6H10V1":"M6 15H1V10M10 1H15V6")}function updateCurrencyHeaders(e){const t=document.getElementById("price-header"),n=document.getElementById("sale-price-header");t&&(t.textContent=`Price (${e})`),n&&(n.textContent=`Sale Price (${e})`)}function initProductManager(){const e=document.createElement("div");e.innerHTML=HTML_TEMPLATE,document.body.appendChild(e),"function"==typeof startApplication&&startApplication()}const HTML_TEMPLATE='<link rel=preconnect href="https://fonts.googleapis.com"><link rel=preconnect href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&family=Red+Hat+Text:ital,wght@0,300..700;1,300..700&display=swap" rel=stylesheet><link rel=stylesheet type="text/css" href="/s/sh-product-manager.css" /><div class=sh-product-manager><header class=sh-header><div class=logo><img src="https://cdn.jsdelivr.net/gh/squarehero-store/advanced-product-manager@latest/dist/sh-logo.png" alt="SquareHero Logo" class=logo-icon></div><div class=header-title-section><h2 class=header-title>Advanced Product Manager</h2><span class=demo-mode-indicator id=demo-mode-indicator style="display: none;">Demo mode</span><div class="sh-status-indicator sh-active" id=activated-badge style="display: none;"><div class=sh-status-icon><svg width=11 height=8 viewBox="0 0 11 8" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M1.66539 3.83192L4.2107 6.16528L9.66539 1.16528" stroke=white stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></div>Activated</div></div><button class=preview-toggle-btn id=preview-toggle-btn title="Toggle Preview Mode"><svg width=16 height=16 viewBox="0 0 16 16" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M1 10H6V15M15 6H10V1" stroke=white stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></button></header><div class=gradient-strip></div><div class=container><main class=main-content><div class=content-header><div class=products-selected-text id=products-selected-text>0 products selected</div><div class=action-buttons><button class="btn bulk-adjust"><svg width=19 height=17 viewBox="0 0 19 17" fill=none xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_224_2570)"><path d="M7.75 13.75H17.375M1.625 13.75H4.25M4.25 13.75V15.5M4.25 13.75V12M16.5 8.5H17.375M1.625 8.5H13M13 8.5V10.25M13 8.5V6.75M11.25 3.25H17.375M1.625 3.25H7.75M7.75 3.25V5M7.75 3.25V1.5" stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round/></g><defs><clipPath id=clip0_224_2570><rect width=19 height=17 fill=white/></clipPath></defs></svg><span>Bulk Adjust</span></button></div></div><div class=filters><div class=search-box><span class=search-icon><svg width=18 height=18 viewBox="0 0 18 18" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M7.53223 14.0332C3.72656 14.0332 0.615234 10.9219 0.615234 7.11621C0.615234 3.31055 3.73535 0.199219 7.53223 0.199219C11.3379 0.199219 14.4492 3.31055 14.4492 7.11621C14.4492 8.59277 13.9834 9.95508 13.1924 11.0801L17.0156 14.9209C17.2617 15.167 17.376 15.4922 17.376 15.8262C17.376 16.5469 16.8398 17.1182 16.1104 17.1182C15.7588 17.1182 15.4336 16.9951 15.1787 16.749L11.3291 12.8906C10.2393 13.6113 8.92969 14.0332 7.53223 14.0332ZM7.53223 12.1875C10.3184 12.1875 12.6035 9.90234 12.6035 7.11621C12.6035 4.33008 10.3184 2.04492 7.53223 2.04492C4.74609 2.04492 2.46094 4.33008 2.46094 7.11621C2.46094 9.90234 4.74609 12.1875 7.53223 12.1875Z" fill="#3C3C43" fill-opacity="0.6"/></svg></span><input type=text id=search-input placeholder="Search products by name or SKU"></div><div class=filter-dropdown id=category-filter-container><div class=select-trigger id=category-filter-trigger><span class=select-text id=category-filter-text>All categories</span><svg width=10 height=6 viewBox="0 0 10 6" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M9 1L5 5L1 1" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></div><div class=select-dropdown id=category-filter-dropdown><div class="select-option selected" data-value=all>All categories</div></div><select id=category-filter style="display: none;"><option value=all>All categories</option></select></div><div class=filter-dropdown id=type-filter-container><div class=select-trigger id=type-filter-trigger><span class=select-text id=type-filter-text>All types</span><svg width=10 height=6 viewBox="0 0 10 6" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M9 1L5 5L1 1" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></div><div class=select-dropdown id=type-filter-dropdown><div class="select-option selected" data-value=all>All types</div><div class=select-option data-value=Physical>Physical</div><div class=select-option data-value=Digital>Digital</div><div class=select-option data-value=Service>Service</div></div><select id=type-filter style="display: none;"><option value=all>All types</option><option value=Physical>Physical</option><option value=Digital>Digital</option><option value=Service>Service</option></select></div><div class=filter-dropdown id=status-filter-container><div class=select-trigger id=status-filter-trigger><span class=select-text id=status-filter-text>All status</span><svg width=10 height=6 viewBox="0 0 10 6" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M9 1L5 5L1 1" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></div><div class=select-dropdown id=status-filter-dropdown><div class="select-option selected" data-value=all>All status</div><div class=select-option data-value=public>Public</div><div class=select-option data-value=hidden>Hidden</div><div class=select-option data-value=scheduled>Scheduled</div></div><select id=status-filter style="display: none;"><option value=all>All status</option><option value=public>Public</option><option value=hidden>Hidden</option><option value=scheduled>Scheduled</option></select></div><div class=filter-dropdown id=sort-filter-container><div class=select-trigger id=sort-filter-trigger><span class=select-text id=sort-filter-text>Sort by</span><svg width=10 height=6 viewBox="0 0 10 6" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M9 1L5 5L1 1" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></div><div class=select-dropdown id=sort-filter-dropdown><div class="select-option selected" data-value=default>Sort by</div><div class=select-option data-value="title:asc">Title (A-Z)</div><div class=select-option data-value="title:desc">Title (Z-A)</div><div class=select-option data-value="price:asc">Price (Low-High)</div><div class=select-option data-value="price:desc">Price (High-Low)</div><div class=select-option data-value="stock:asc">Stock (Low-High)</div><div class=select-option data-value="stock:desc">Stock (High-Low)</div></div><select id=sort-select style="display: none;"><option value=default>Sort by</option><option value="title:asc">Title (A-Z)</option><option value="title:desc">Title (Z-A)</option><option value="price:asc">Price (Low-High)</option><option value="price:desc">Price (High-Low)</option><option value="stock:asc">Stock (Low-High)</option><option value="stock:desc">Stock (High-Low)</option></select></div><button class=reset-filters-btn id=reset-filters-btn disabled><svg width=14 height=18 viewBox="0 0 14 18" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M7.75 3.98328H11.8C12.2201 3.98328 12.4307 3.98328 12.5911 4.06502C12.7322 4.13693 12.8461 4.25158 12.918 4.3927C12.9997 4.55313 13 4.76331 13 5.18335V5.74188C13 5.92161 13 6.01241 12.9795 6.09784C12.9612 6.17437 12.9304 6.24747 12.8893 6.31458C12.8429 6.39026 12.7782 6.45513 12.6486 6.58484L11.5 7.73337M3.62471 3.98328H2.19971C1.77967 3.98328 1.56986 3.98328 1.40942 4.06502C1.2683 4.13693 1.15365 4.25158 1.08174 4.3927C1 4.55313 1 4.76331 1 5.18335V5.7363C1 5.91974 1 6.01152 1.02072 6.09784C1.0391 6.17437 1.06947 6.24747 1.11059 6.31458C1.15696 6.39024 1.22193 6.45521 1.35156 6.58484L5.14862 10.3819C5.27832 10.5116 5.34283 10.5761 5.38921 10.6518C5.43033 10.7189 5.46112 10.7922 5.4795 10.8688C5.5 10.9542 5.5 11.0449 5.5 11.2247V14.7915C5.5 15.4344 5.5 15.7561 5.63541 15.9497C5.75364 16.1187 5.93605 16.2315 6.14014 16.2617C6.37385 16.2962 6.66153 16.1526 7.23657 15.8651L7.83655 15.5651C8.07738 15.4447 8.19745 15.3843 8.28542 15.2944C8.3632 15.215 8.42275 15.1197 8.45898 15.0145C8.5 14.8957 8.5 14.7608 8.5 14.4915V11.2302C8.5 11.0468 8.5 10.9551 8.5207 10.8688C8.53908 10.7922 8.56945 10.719 8.61063 10.6519C8.65683 10.5765 8.7214 10.5119 8.85017 10.3831L8.8516 10.3818L9.62508 9.60835M9.62508 9.60835L1.75 1.73328M9.62508 9.60835L12.25 12.2333" stroke="#011E45" stroke-width="1.5" stroke-linecap=round stroke-linejoin=round/></svg><span>Reset</span></button></div><div class=table-container><table><thead><tr><th><input type=checkbox id=select-all-checkbox></th><th>Title</th><th>URL</th><th>SKU</th><th>Categories</th><th id=price-header>Price</th><th id=sale-price-header>Sale Price</th><th>On Sale</th><th>Stock</th><th>Type</th><th>Status</th><th id=scheduled-header class="scheduled-column hidden">Scheduled</th></tr></thead><tbody id=product-container></tbody></table></div><div class=pagination><div class=pagination-info id=pagination-info></div><div class=pagination-controls><div class=page-numbers id=page-numbers></div><div class=show-select><span>Show</span><select id=items-per-page><option value=10>10</option><option value=20>20</option><option value=50>50</option></select></div></div></div></main></div><div id=changes-footer class="changes-footer hidden"><div class=changes-footer-content><div class=changes-footer-left><div class=changes-info><span class=changes-icon><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 6.44971V10.4497M5.33173 1.9375L1.9375 5.33173L1.93442 5.33462C1.59057 5.67847 1.41824 5.85081 1.29492 6.05204C1.18526 6.23098 1.10425 6.4263 1.05526 6.63037C1 6.86055 1 7.10506 1 7.59424V12.4058C1 12.8949 1 13.1395 1.05526 13.3697C1.10425 13.5738 1.18526 13.7688 1.29492 13.9478C1.41857 14.1495 1.59182 14.3228 1.9375 14.6685L5.33173 18.0627C5.67763 18.4086 5.85021 18.5812 6.05204 18.7048C6.23099 18.8145 6.42581 18.8958 6.62988 18.9448C6.85971 19 7.10382 19 7.59151 19H12.4075C12.8952 19 13.1404 19 13.3702 18.9448C13.5743 18.8958 13.7693 18.8145 13.9482 18.7049C14.1501 18.5812 14.323 18.4086 14.6689 18.0627L18.0632 14.6685C18.4091 14.3226 18.5817 14.1496 18.7053 13.9478C18.815 13.7688 18.8953 13.5738 18.9443 13.3697C18.9996 13.1395 19 12.895 19 12.4058V7.59424C19 7.10506 18.9996 6.86055 18.9443 6.63037C18.8953 6.4263 18.815 6.23099 18.7053 6.05205C18.5817 5.85022 18.4091 5.67761 18.0632 5.33173L14.6689 1.9375C14.3233 1.59181 14.15 1.41857 13.9482 1.29492C13.7693 1.18526 13.5743 1.10425 13.3702 1.05526C13.14 1 12.8945 1 12.4053 1H7.59375C7.10457 1 6.86006 1 6.62988 1.05526C6.42581 1.10425 6.23099 1.18526 6.05204 1.29492C5.85204 1.41748 5.68106 1.58847 5.3414 1.92813L5.33173 1.9375ZM10.0498 13.4497V13.5497L9.9502 13.5499V13.4497H10.0498Z" stroke=white stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></span><span class=changes-text>You have unsaved changes</span><span class=changes-count id=changes-count>0 products modified</span></div><div class=changes-notification-content style="display: none;"><span class=changes-notification-text id=notification-text></span></div><div id=main-progress-container class=progress-container style="display: none;"><div class=progress-bar><div class=progress-fill id=main-progress-fill></div></div><div class=progress-info><span id=main-progress-text>Saving changes...</span><span id=main-progress-time></span></div></div></div><div class=changes-footer-right><button class=btn-discard id=discard-changes>Discard Changes</button><button class=apply-btn id=save-changes>Apply Changes</button></div></div></div><div id=url-suggestion-tooltip class="url-suggestion-tooltip hidden"><div class=url-suggestion-content><div class=url-suggestion-header><span class=url-suggestion-title>Update URL to match title?</span><button class=url-suggestion-close id=url-suggestion-close>×</button></div><div class=url-suggestion-body><span class=url-suggestion-text>New URL:</span><span class=url-suggestion-preview id=url-suggestion-preview></span><div class=url-redirect-option><label class=url-redirect-checkbox><input type=checkbox id=url-create-redirect checked><span class=url-redirect-checkmark></span><span class=url-redirect-text>Create redirect from old URL to new URL</span></label></div></div><div class=url-suggestion-actions><button class="url-suggestion-btn secondary" id=url-suggestion-cancel>Keep Current</button><button class="url-suggestion-btn primary" id=url-suggestion-apply>Update URL</button></div></div></div><div id=category-editor-popup class="category-editor-popup hidden"><div class=category-popup-content><div class=category-popup-body><div class=category-field-container><div class=category-field-wrapper><div id=category-tags-display class=category-tags-display></div><div class=category-input-section><input type=text id=category-popup-input class=category-popup-input placeholder="Type to add new category..."><div class=category-suggestions id=category-popup-suggestions></div></div></div><div class=category-existing-dropdown><div class=category-existing-select><div class=select-trigger><span class="select-text placeholder">Select an existing category</span><svg width=16 height=17 viewBox="0 0 16 17" fill=none xmlns="http://www.w3.org/2000/svg"><path fill-rule=evenodd clip-rule=evenodd d="M0.792969 5.70712L2.20718 4.29291L8.00008 10.0858L13.793 4.29291L15.2072 5.70712L8.00008 12.9142L0.792969 5.70712Z" fill="#1A1A1A"/></svg></div><div class=select-dropdown></div><select id=category-existing-select-hidden style="display: none;"></select></div></div></div><div class=category-popup-actions><button id=category-popup-discard class="category-popup-btn category-popup-discard">Discard</button><button id=category-popup-save class="category-popup-btn category-popup-save">Save Changes</button></div></div></div></div><div id=schedule-editor-popup class="schedule-editor-popup hidden"><div class=schedule-popup-content><div class=schedule-popup-body><h4>Schedule Publication Date & Time</h4><div class=schedule-field-container><label for=schedule-datetime-input class=schedule-label>When should this product be published?</label><input type=datetime-local id=schedule-datetime-input class=schedule-datetime-input><div class=schedule-note><svg width=14 height=14 viewBox="0 0 14 14" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M7 13C10.3137 13 13 10.3137 13 7C13 3.68629 10.3137 1 7 1C3.68629 1 1 3.68629 1 7C1 10.3137 3.68629 13 7 13Z" stroke="#666" stroke-width="1.5" stroke-linecap=round stroke-linejoin=round/><path d="M7 4.5V7L8.5 8.5" stroke="#666" stroke-width="1.5" stroke-linecap=round stroke-linejoin=round/></svg><span>Product will be automatically published at the specified date and time</span></div></div><div class=schedule-popup-actions><button id=schedule-popup-cancel class="schedule-popup-btn schedule-popup-cancel">Cancel</button><button id=schedule-popup-save class="schedule-popup-btn schedule-popup-save">Schedule</button></div></div></div></div><div id=stock-editor-popup class="stock-editor-popup hidden"><div class=stock-popup-content><div class=stock-popup-body><h4>Edit Stock Level</h4><div class=stock-field-container><div class=stock-input-section><label for=stock-quantity-input class=stock-label>Stock Quantity</label><input type=number id=stock-quantity-input class=stock-quantity-input min=0 placeholder=0></div><div class=stock-toggle-section><div class=section-header><span class=stock-toggle-label>Track Inventory</span><label class=toggle-switch><input type=checkbox id=stock-track-inventory class=stock-track-checkbox><span class=toggle-slider></span></label></div><div class=price-adjustment-tooltip><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z" stroke="#011E45" stroke-opacity="0.7" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span class=tooltip-text>When disabled, shows unlimited stock (∞)</span></div></div></div><div class=stock-popup-actions><button id=stock-popup-cancel class="stock-popup-btn stock-popup-cancel">Cancel</button><button id=stock-popup-save class="stock-popup-btn stock-popup-save">Save Changes</button></div></div></div></div><div id=bulk-adjust-drawer class=bulk-adjust-drawer><div class=bulk-drawer-overlay></div><div class=bulk-drawer-content><div class=bulk-drawer-header><h3>Bulk Product Editor</h3><button class=bulk-drawer-close id=bulk-drawer-close><svg xmlns="http://www.w3.org/2000/svg" width=24 height=24 viewBox="0 0 24 24" fill=none><path d="M18 18L12 12M12 12L6 6M12 12L18 6M12 12L6 18" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></button></div><div class=bulk-drawer-body><div class=bulk-tabs-nav><button class="bulk-tab active" data-tab=pricing>Pricing</button><button class=bulk-tab data-tab=visibility>Visibility</button><button class=bulk-tab data-tab=inventory>Inventory</button></div><div class=bulk-drawer-main><div class=bulk-tabs-container><div class=bulk-tab-content><div id=pricing-tab class="tab-pane active"><div class=bulk-section><div class=section-header><h4>Regular Pricing</h4><label class=toggle-switch><input type=checkbox id=bulk-adjust-regular-prices><span class=toggle-slider></span></label></div><div class=bulk-form-group id=bulk-regular-price-options style="display: none;"><div class=price-adjustment-container><div class=price-controls-row><label class=price-adjustment-label>Price adjustment</label><div class=price-input-group><div class=price-value-input><input type=number id=bulk-regular-adjustment placeholder=0 step=1 value=0><span class=price-unit id=price-unit>%</span></div><div class=price-method-selector><div class=bulk-select-dropdown><div class=select-trigger id=price-method-trigger><span class=select-text id=price-method-text>Adjust by %</span><svg width=16 height=17 viewBox="0 0 16 17" fill=none xmlns="http://www.w3.org/2000/svg"><path fill-rule=evenodd clip-rule=evenodd d="M0.792969 5.70712L2.20718 4.29291L8.00008 10.0858L13.793 4.29291L15.2072 5.70712L8.00008 12.9142L0.792969 5.70712Z" fill="#1A1A1A"/></svg></div><div class=select-dropdown id=price-method-dropdown><div class="select-option selected" data-value=percentage>Adjust by %</div><div class=select-option data-value=fixed-adjustment>Adjust by amount</div><div class=select-option data-value=fixed-price>Fixed price</div></div><select id=bulk-regular-adjustment-type style="display: none;"><option value=percentage>Adjust by %</option><option value=fixed-adjustment>Adjust by amount</option><option value=fixed-price>Fixed price</option></select></div></div></div></div><div class=price-slider-row><div class=price-slider-container data-slider=regular><div class=price-slider-track><div class=price-slider-cover></div><div class=price-slider-handle></div></div></div></div></div><div class=price-adjustment-tooltip><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z" stroke="#011E45" stroke-opacity="0.7" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span class=tooltip-text>If a price change reduces the value below $0, the product price will default to $0.</span></div></div></div><div class=bulk-section><div class=section-header><h4>Sale Pricing</h4><label class=toggle-switch><input type=checkbox id=bulk-adjust-sale-prices><span class=toggle-slider></span></label></div><div class=bulk-form-group id=bulk-sale-price-options style="display: none;"><div class=bulk-form-group><label>Sale status</label><div class=three-way-toggle><button class="toggle-option active" data-value=unchanged>Unchanged</button><button class=toggle-option data-value=on-sale>On sale</button><button class=toggle-option data-value=not-on-sale>Not on sale</button></div><input type=hidden id=bulk-sale-status value=unchanged></div><div class=bulk-form-group id=bulk-sale-pricing-controls><div class=price-adjustment-container><div class=price-controls-row><label class=price-adjustment-label>Price adjustment</label><div class=price-input-group><div class=price-value-input><input type=number id=bulk-sale-adjustment placeholder=0 step=1 value=0><span class=price-unit id=sale-price-unit>%</span></div><div class=price-method-selector><div class=bulk-select-dropdown><div class=select-trigger id=sale-price-method-trigger><span class=select-text id=sale-price-method-text>Adjust by %</span><svg width=16 height=17 viewBox="0 0 16 17" fill=none xmlns="http://www.w3.org/2000/svg"><path fill-rule=evenodd clip-rule=evenodd d="M0.792969 5.70712L2.20718 4.29291L8.00008 10.0858L13.793 4.29291L15.2072 5.70712L8.00008 12.9142L0.792969 5.70712Z" fill="#1A1A1A"/></svg></div><div class=select-dropdown id=sale-price-method-dropdown><div class="select-option selected" data-value=percentage>Adjust by %</div><div class=select-option data-value=fixed-adjustment>Adjust by amount</div><div class=select-option data-value=fixed-price>Fixed sale price</div></div><select id=bulk-sale-adjustment-type style="display: none;"><option value=percentage selected>Adjust by %</option><option value=fixed-adjustment>Adjust by amount</option><option value=fixed-price>Fixed sale price</option></select></div></div></div></div><div class=price-slider-row><div class=price-slider-container data-slider=sale><div class=price-slider-track><div class=price-slider-cover></div><div class=price-slider-handle></div></div></div></div></div><div class=price-adjustment-tooltip id=sale-adjustment-tooltip style="display: none;"><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z" stroke="#011E45" stroke-opacity="0.7" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span class=tooltip-text>Sale prices that exceed the regular price will be capped at the regular price for affected products.</span></div></div><div style="display: none;"><input type=radio name=bulk-sale-action id=bulk-sale-keep-current value=keep-current checked><input type=radio name=bulk-sale-action id=bulk-sale-put-on value=put-on-sale><input type=radio name=bulk-sale-action id=bulk-sale-take-off value=take-off-sale></div></div></div><div class=bulk-section><div class=section-header><h4>Rounding</h4><label class=toggle-switch><input type=checkbox id=bulk-round-prices><span class=toggle-slider></span></label></div><div class=bulk-form-group id=bulk-rounding-options style="display: none;"><div class=bulk-form-group><label>Rounding type</label><div class=four-way-toggle><button class="toggle-option active" data-value=whole title="Round to nearest dollar (e.g., $24.60 becomes $25)">Whole</button><button class=toggle-option data-value=".99" title="Round to the nearest .99 (e.g. $24.60 becomes $24.99)">.99</button><button class=toggle-option data-value=".95" title="Round to the nearest .95 (e.g. $24.60 becomes $24.95)">.95</button><button class=toggle-option data-value=custom title="Round to custom cents value">Custom</button></div><input type=hidden id=bulk-rounding-type value=whole></div><div class=bulk-form-group id=bulk-rounding-description><div class=info-text><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z" stroke="#011E45" stroke-opacity="0.7" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span id=bulk-rounding-description-text>Round to the nearest dollar (e.g. $24.60 becomes $25)</span></div></div><div class=bulk-price-input-group id=bulk-custom-ending style="display: none; margin-top: 8px;"><label>Custom ending (2 digits):</label><div class=price-input-group><div class=price-value-input><span class=price-unit>.</span><input type=number id=bulk-custom-cents placeholder=99 min=0 max=99 step=1></div></div></div><div class=bulk-form-group style="margin-top: 16px;"><label>Apply rounding to</label><div class=three-way-toggle><button class="toggle-option active" data-value=all>All prices</button><button class=toggle-option data-value=regular>Regular price</button><button class=toggle-option data-value=sale>Sale price</button></div><input type=hidden id=bulk-rounding-target value=all></div></div></div></div><div id=visibility-tab class=tab-pane><div class=bulk-section><div class=section-header><h4>Product Status</h4><label class=toggle-switch><input type=checkbox id=bulk-product-status-toggle><span class=toggle-slider></span></label></div><div class=bulk-form-group id=bulk-product-status-options style="display: none;"><div class=bulk-form-group><label>Product status</label><div class=four-way-toggle><button class="toggle-option active" data-value=unchanged title="Keep current status">Unchanged</button><button class=toggle-option data-value=public title="Make products visible to customers">Public</button><button class=toggle-option data-value=hidden title="Hide products from customers">Hidden</button><button class=toggle-option data-value=scheduled title="Schedule products for future publication">Scheduled</button></div><input type=hidden id=bulk-product-status value=unchanged></div><div class=bulk-form-group id=bulk-scheduled-date-group style="display: none;"><label for=bulk-scheduled-date>Schedule publication date</label><input type=datetime-local id=bulk-scheduled-date class=bulk-datetime-input></div></div></div><div class=bulk-section><div class=section-header><h4>Categories</h4><label class=toggle-switch><input type=checkbox id=bulk-categories-toggle><span class=toggle-slider></span></label></div><div class=bulk-form-group id=bulk-categories-options style="display: none;"><div class=category-section><div class=category-field-container><div class=category-field-wrapper><div id=bulk-category-tags-display class=category-tags-display></div><div class=category-input-section><input type=text id=bulk-category-input class=category-popup-input placeholder="Type to add new category..."><div class=category-suggestions id=bulk-category-suggestions></div></div></div><div class=bulk-select-dropdown><div class=select-trigger id=bulk-category-add-trigger><span class="select-text placeholder">Select an existing category</span><svg width=16 height=17 viewBox="0 0 16 17" fill=none xmlns="http://www.w3.org/2000/svg"><path fill-rule=evenodd clip-rule=evenodd d="M0.792969 5.70712L2.20718 4.29291L8.00008 10.0858L13.793 4.29291L15.2072 5.70712L8.00008 12.9142L0.792969 5.70712Z" fill="#1A1A1A"/></svg></div><div class=select-dropdown id=bulk-category-add-dropdown></div></div><div class=bulk-select-dropdown><div class=select-trigger id=bulk-category-remove-trigger><span class="select-text placeholder">Select category to remove</span><svg width=16 height=17 viewBox="0 0 16 17" fill=none xmlns="http://www.w3.org/2000/svg"><path fill-rule=evenodd clip-rule=evenodd d="M0.792969 5.70712L2.20718 4.29291L8.00008 10.0858L13.793 4.29291L15.2072 5.70712L8.00008 12.9142L0.792969 5.70712Z" fill="#1A1A1A"/></svg></div><div class=select-dropdown id=bulk-category-remove-dropdown></div></div></div><div class=category-info-tooltip><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z" stroke="#011E45" stroke-opacity="0.7" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span class=tooltip-text>When removing categories, a number in brackets next to a category shows how many selected products it applies to.</span></div></div></div></div></div><div id=inventory-tab class=tab-pane><div class=bulk-section><div class=section-header><h4>Stock management</h4><label class=toggle-switch><input type=checkbox id=bulk-enable-stock-tracking><span class=toggle-slider></span></label></div><div class=bulk-form-group id=bulk-stock-controls style="display: none;"><div class=two-way-toggle><div class="toggle-option active" data-value=limited>Limited stock</div><div class=toggle-option data-value=unlimited>Unlimited stock</div></div><input type=hidden id=bulk-stock-type value=limited><div class=bulk-form-group id=bulk-stock-adjustment-group><div class=price-adjustment-container><div class=price-controls-row><label class=price-adjustment-label>Stock adjustment</label><div class=price-input-group><div class=price-value-input><input type=number id=bulk-stock-adjustment placeholder=0 step=1 value=0></div><div class=price-method-selector><div class=bulk-select-dropdown><div class=select-trigger id=stock-method-trigger><span class=select-text id=stock-method-text>Adjust by amount</span><svg width=16 height=17 viewBox="0 0 16 17" fill=none xmlns="http://www.w3.org/2000/svg"><path fill-rule=evenodd clip-rule=evenodd d="M0.792969 5.70712L2.20718 4.29291L8.00008 10.0858L13.793 4.29291L15.2072 5.70712L8.00008 12.9142L0.792969 5.70712Z" fill="#1A1A1A"/></svg></div><div class=select-dropdown id=stock-method-dropdown><div class="select-option selected" data-value=adjust>Adjust by amount</div><div class=select-option data-value=fixed>Fixed amount</div></div><select id=bulk-stock-action style="display: none;"><option value=adjust>Adjust by amount</option><option value=fixed>Fixed amount</option></select></div></div></div></div><div class=price-slider-row><div class=price-slider-container data-slider=stock><div class=price-slider-track><div class=price-slider-cover></div><div class=price-slider-handle></div></div></div></div></div></div><div class=price-adjustment-tooltip id=stock-adjustment-tooltip style="display: none;"><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 9V14M10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10C19 14.9706 14.9706 19 10 19ZM10.0498 6V6.1L9.9502 6.1002V6H10.0498Z" stroke="#011E45" stroke-opacity="0.7" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span class=tooltip-text>Products where the adjustment would set stock below 0 will instead be set to 0.</span></div></div></div></div></div></div><div class=bulk-preview-pane><div class=group-pane><h4>Changes to Apply</h4><div id=changes-summary class=changes-list><div class=no-changes>No changes configured</div></div></div><div class=group-pane><h4>Product preview</h4><div id=sample-products class=sample-products-carousel></div></div></div></div></div><div id=bulk-notification-footer class=bulk-notification-footer><div class=bulk-footer-content><div class=bulk-footer-left><div class=products-selected-info><h4 id=products-selected-count>0 Products Selected</h4><div class=time-estimate><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M10 5.83333V10H14.1667M10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5Z" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span id=estimated-time>Est. 30 seconds</span></div></div><div class=bulk-notification-content style="display: none;"><span class=bulk-notification-text id=bulk-notification-text></span></div><div id=bulk-progress-container class=progress-container style="display: none;"><div class=progress-bar><div class=progress-fill id=bulk-progress-fill></div></div><div class=progress-info><span id=bulk-progress-text></span><span id=bulk-progress-time></span></div></div></div><div class=bulk-footer-right><button class="bulk-btn primary" id=bulk-apply-all disabled>Apply Changes</button></div></div></div></div></div><div id=undo-changes-drawer style="display: none;"><div class=undo-drawer-overlay></div><div class=undo-drawer-content><div class=drawer-header><h2>Undo History</h2><button class=drawer-close id=undo-drawer-close><svg xmlns="http://www.w3.org/2000/svg" width=24 height=24 viewBox="0 0 24 24" fill=none><path d="M18 18L12 12M12 12L6 6M12 12L18 6M12 12L6 18" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg></button></div><div class=drawer-content><div class=undo-content-container><div class=undo-description><p>Undo this bulk edit and roll back affected products to their state before these changes were made.</p></div><div class=undo-history-list id=undo-history-list></div></div></div><div class=drawer-footer id=undo-notification-footer><div class=bulk-footer-content><div class=bulk-footer-left><div class=undo-status-info><h4 id=undo-status-count>5 Changes Available</h4><div class=undo-info><svg width=20 height=20 viewBox="0 0 20 20" fill=none xmlns="http://www.w3.org/2000/svg"><path d="M4.16666 10H15.8333M4.16666 10L8.33333 5.83333M4.16666 10L8.33333 14.1667" stroke="#011E45" stroke-width=2 stroke-linecap=round stroke-linejoin=round/></svg><span id=undo-info-text>Choose a restore point</span></div></div><div class=bulk-notification-content style="display: none;"><span class=bulk-notification-text id=undo-notification-text></span></div><div id=undo-progress-container class=progress-container style="display: none;"><div class=progress-bar><div class=progress-fill id=undo-progress-fill></div></div><div class=progress-info><span id=undo-progress-text></span><span id=undo-progress-time></span></div></div></div><div class=bulk-footer-right><button class="bulk-btn secondary" id=undo-selected-btn disabled>Restore Selected</button></div></div></div></div></div></div>';class CurrencyManager{constructor(){this.detectedCurrency=null,this.detectedCurrencyName=null,this.isDetected=!1,this.supportedCurrencies={},this.detectionPromise=null}async detectCurrency(){if(this.isDetected&&this.detectedCurrency)return this.detectedCurrency;try{const e=await this.detectFromSquarespaceAPI();if(e)return this.setCurrency(e,"Squarespace Commerce API"),e}catch(e){}if(window.getSelectedProductsWithData){const e=window.getSelectedProductsWithData();if(e.length>0)for(const t of e){const e=this.extractCurrencyFromProduct(t);if(e)return this.setCurrency(e,"selected products"),e}}if(window.allProducts&&window.allProducts.length>0)for(const e of window.allProducts){const t=this.extractCurrencyFromProduct(e);if(t)return this.setCurrency(t,"all products"),t}if(window.squarespaceProducts&&window.squarespaceProducts.length>0)for(const e of window.squarespaceProducts){const t=this.extractCurrencyFromProduct(e);if(t)return this.setCurrency(t,"global products"),t}throw new Error("Unable to detect currency - please ensure you are on a Squarespace site with commerce enabled")}async detectFromSquarespaceAPI(){try{const e=this.getCSRFToken(),t=await fetch("/api/commerce/settings/payment",{method:"GET",headers:{accept:"application/json, text/plain, */*","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin",...e&&{"x-csrf-token":e}},mode:"cors",credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();return n.storeCurrency?(n.supportedCurrencies&&(this.supportedCurrencies=n.supportedCurrencies,this.detectedCurrencyName=n.supportedCurrencies[n.storeCurrency]),n.storeCurrency):null}catch(e){return null}}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):window.Static&&window.Static.SQUARESPACE_CONTEXT&&window.Static.SQUARESPACE_CONTEXT.csrfToken?window.Static.SQUARESPACE_CONTEXT.csrfToken:window.Y&&window.Y.Squarespace&&window.Y.Squarespace.Analytics&&window.Y.Squarespace.Analytics.csrfToken?window.Y.Squarespace.Analytics.csrfToken:null}extractCurrencyFromProduct(e){return e.storeItem?.price?.currencyCode?e.storeItem.price.currencyCode:e.storeItem?.variants?.[0]?.price?.currencyCode?e.storeItem.variants[0].price.currencyCode:e.storeItem?.priceCurrency?e.storeItem.priceCurrency:e.price?.currencyCode?e.price.currencyCode:null}setCurrency(e,t="manual"){this.detectedCurrency=e,this.isDetected=!0,window.detectedCurrency=e,"function"==typeof window.dispatchEvent&&window.dispatchEvent(new CustomEvent("currencyDetected",{detail:{currency:e,source:t}}))}getCurrency(e=!0){return this.isDetected?this.detectedCurrency:e?(this.detectionPromise||(this.detectionPromise=this.detectCurrency().finally((()=>{this.detectionPromise=null}))),this.detectionPromise):null}getCurrencySync(){return this.detectedCurrency}async refresh(){return this.isDetected=!1,this.detectedCurrency=null,this.detectionPromise=null,await this.detectCurrency()}getCurrencySymbol(e=null){const t=e||this.getCurrencySync();return{CHF:"CHF",MXN:"$",ARS:"$",ZAR:"R",INR:"₹",THB:"฿",AUD:"$",ILS:"₪",JPY:"¥",PLN:"zł",GBP:"£",IDR:"Rp",PHP:"₱",RUB:"₽",HKD:"$",EUR:"€",DKK:"kr",COP:"$",USD:"$",CAD:"$",MYR:"RM",NOK:"kr",SGD:"$",CZK:"Kč",SEK:"kr",NZD:"$",BRL:"R$"}[t]||t}formatCurrency(e,t=null,n=!1){if(null==e||isNaN(e))return"N/A";const o=t||this.getCurrencySync();if(!o)return`${parseFloat(e).toFixed(2)}`;const s=this.getCurrencySymbol(o),i=parseFloat(e).toFixed(2);return n&&s!==o?`${s}${i} (${o})`:`${s}${i}`}getCurrencyLabel(e,t=null){const n=t||this.getCurrencySync();return n?`${e} (${n})`:e}}window.currencyManager=new CurrencyManager,"undefined"!=typeof module&&module.exports&&(module.exports=CurrencyManager),window.addEventListener("productsLoaded",(()=>{window.currencyManager.refresh()})),window.getSystemCurrency=()=>window.currencyManager.getCurrencySync(),window.formatSystemCurrency=(e,t=!1)=>window.currencyManager.formatCurrency(e,null,t),window.currencyManager&&window.currencyManager.getCurrency().then((()=>{})).catch((()=>{})),window.getProductDataById=getProductDataById,window.getProcessedProductData=getProcessedProductData,window.getSelectedProductsWithData=getSelectedProductsWithData,window.getSelectedProducts=getSelectedProducts,window.markProductAsChanged=markProductAsChanged,window.updateChangesFooter=updateChangesFooter,window.clearProductModifications=clearProductModifications,window.getCurrentBulkSettings=getCurrentBulkSettings,window.applyBulkSettings=applyBulkSettings,window.generateActionDescription=generateActionDescription,window.validateProductData=validateProductData,window.deepClone=deepClone,window.formatCurrency=formatCurrency,window.parseCurrency=parseCurrency,window.saveChangesToSquarespace=saveChangesToSquarespace,window.initializeDataUtilities=initializeDataUtilities;let presetFileSaveLock=!1;window.uploadJsonToCssAssets=uploadJsonToCssAssets,window.savePresetsFile=savePresetsFile,window.fetchPresets=fetchPresets,window.savePresets=savePresets,window.createPresetsBackup=createPresetsBackup,window.importPresetsFromFile=importPresetsFromFile,window.exportPresetsToFile=exportPresetsToFile,window.initializeFileUploadUtilities=initializeFileUploadUtilities,window.flatpickrInstances||(window.flatpickrInstances={}),window.initializeFlatpickr=initializeFlatpickr,window.initializeBulkSchedulingPicker=initializeBulkSchedulingPicker,window.getFlatpickrValue=getFlatpickrValue,window.setFlatpickrValue=setFlatpickrValue,window.destroyFlatpickr=destroyFlatpickr,window.bulkSchedulingPicker=null;const validators={required:e=>({valid:e&&""!==e.toString().trim(),message:"This field is required"}),number:e=>({valid:!isNaN(parseFloat(e))&&isFinite(e),message:"Please enter a valid number"}),positiveNumber:e=>({valid:!isNaN(parseFloat(e))&&isFinite(e)&&parseFloat(e)>=0,message:"Please enter a positive number"}),percentage:e=>({valid:!isNaN(parseFloat(e))&&isFinite(e)&&parseFloat(e)>=0&&parseFloat(e)<=100,message:"Please enter a percentage between 0 and 100"}),email:e=>({valid:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:"Please enter a valid email address"}),url:e=>({valid:/^https?:\/\/.+/.test(e),message:"Please enter a valid URL starting with http:// or https://"}),minLength:e=>t=>({valid:t&&t.toString().length>=e,message:`Must be at least ${e} characters long`}),maxLength:e=>t=>({valid:!t||t.toString().length<=e,message:`Must be no more than ${e} characters long`}),pattern:(e,t="Invalid format")=>n=>({valid:!n||e.test(n),message:t}),custom:(e,t)=>n=>({valid:e(n),message:t})};window.validators=validators,window.validateField=validateField,window.validateForm=validateForm,window.initializeAdvancedEventHandlers=initializeAdvancedEventHandlers,window.makeInlineEditable=makeInlineEditable,window.debounce=debounce,window.debugCheckboxSelection=function(){const e=document.querySelectorAll('.mix input[type="checkbox"]'),t=document.querySelectorAll('.mix input[type="checkbox"]:checked'),n=getSelectedProductsWithData();return{totalCheckboxes:e.length,selectedCheckboxes:t.length,globalDataLength:globalProductsData?.length||0,selectedDataLength:n?.count||0}},window.initializeProductManager=initializeProductManager,window.initializeApplication=initializeApplication,window.initializeEventHandlers=initializeEventHandlers,window.initializeTableControls=initializeTableControls,window.initializeBulkEditor=initializeBulkEditor,window.initializeBulkTabs=initializeBulkTabs,window.initializeCustomSlider=initializeCustomSlider,window.initializeCustomDropdowns=initializeCustomDropdowns;let currentEditingCell=null;window.generateSlug=generateSlug,window.generateUniqueUrlSlug=generateUniqueUrlSlug,window.shouldSuggestURL=shouldSuggestURL,window.hideURLSuggestion=hideURLSuggestion,window.showFooterNotification=showFooterNotification,window.exportProducts=exportProducts,window.importProducts=importProducts,window.openBulkDrawer=openBulkDrawer,window.closeBulkDrawer=closeBulkDrawer,window.openUndoDrawer=openUndoDrawer,window.initializeInteractiveUtilities=initializeInteractiveUtilities;class _0x21c74a45{constructor(){this.firebaseConfig=window.firebaseConfig||{_0x7cc61b43:(function(){return atob('aHR0cHM6Ly91cy1jZW50cmFsMS1teS1zcXVhcmVoZXJvLWh1Yi5jbG91ZGZ1bmN0aW9ucy5uZXQ=')})()},this.storageKey="squarehero-license",this.currentLicense=null,this.appBlocked=!1}async initialize(){this.loadStoredLicense();const e=await this.getValidJWT();if(!e){if(this.currentLicense&&this.currentLicense.token){const e=this.decodeToken(this.currentLicense.token);if(e&&"demo"===e.licenseType&&e.connected){const t=Math.floor(Date.now()/1e3);if(e.exp&&e.exp>t)return this.updateDemoModeIndicator(),!1;this.clearLicense()}}if(!await this.checkFirebaseConnection())return this.appBlocked=!0,this.showLicenseError(),!1;const e=await this.createDemoModeToken();if(null===e){const e=await this.createActivatedLicense();if(e){const t=await this.getSiteInfo();return this.currentLicense={token:e,siteInfo:{siteId:t.id,siteName:t.name,domain:t.domain},lastValidated:(new Date).toISOString()},this.storeLicense(e,this.currentLicense.siteInfo),!0}return!1}if(e){const t=await this.getSiteInfo();this.currentLicense={token:e,siteInfo:{siteId:t.id,siteName:t.name,expiresAt:null},createdAt:(new Date).toISOString()},this.storeLicense()}return this.updateDemoModeIndicator(),!1}const t=this.decodeToken(e);return t&&"demo"===t.licenseType?(this.updateDemoModeIndicator(),!1):t&&"activated"===t.licenseType?(this.updateDemoModeIndicator(),!0):(await this.resetToDemo("Unknown token type"),!1)}loadStoredLicense(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.currentLicense=t}}catch(e){localStorage.removeItem(this.storageKey)}}storeLicense(e,t){let n;if(e&&t)n={token:e,siteInfo:t,storedAt:(new Date).toISOString()};else{if(!this.currentLicense)return;n={...this.currentLicense,storedAt:(new Date).toISOString()}}try{localStorage.setItem(this.storageKey,JSON.stringify(n)),this.currentLicense=n}catch(e){}}clearCache(){try{localStorage.removeItem(this.storageKey),this.currentLicense=null}catch(e){}}async checkFirebaseConnection(){try{const e=await this.getSiteInfo();if(!e||!e.id)return!1;const t=await fetch(`${this.firebaseConfig._0x7cc61b43}/verifySiteLicense`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:e.id,checkStatusOnly:!0})});if(404===t.status)return!1;let n=null;try{const e=await t.text();e&&(n=JSON.parse(e))}catch(e){return!1}return!(n&&n.error&&(n.error.includes("not found")||n.error.includes("not registered"))||(!t.ok||!n||!0!==n.connected)&&!t.ok)}catch(e){return!1}}validateClientSide(){if(!this.currentLicense||!this.currentLicense.token)return!1;try{const e=this.decodeToken(this.currentLicense.token);if(!e)return!1;const t=Math.floor(Date.now()/1e3);return!(e.exp&&e.exp<t)||"expired_needs_refresh"}catch(e){return!1}}async getValidJWT(){if(!this.currentLicense||!this.currentLicense.token)return null;const e=this.validateClientSide();if(!0===e)return this.currentLicense.token;if("expired_needs_refresh"===e)try{return await this.refreshJWT()||(await this.resetToDemo("JWT refresh failed - license revoked"),null)}catch(e){return await this.resetToDemo("JWT refresh error"),null}return null}async refreshJWT(){try{const e=await this.getSiteInfo();if(!e||!e.id)return null;const t=await fetch(`${this.firebaseConfig._0x7cc61b43}/refreshJWT`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:e.id})}),n=await t.json();if(t.ok&&n.success&&n.jwt){const e={...this.currentLicense,token:n.jwt,lastRefreshed:(new Date).toISOString(),expiresAt:n.expiresAt};return this.currentLicense=e,this.storeLicense(),n.jwt}return null}catch(e){return null}}async _0xe19968bf(){return!(!this.currentLicense||!this.currentLicense.token)&&null!==await this.getValidJWT()}async ensureValidJWT(){const e=await this.getValidJWT();if(!e)throw new Error("License validation failed - please check your subscription status");return e}async forceLicenseSync(){try{const e=document.getElementById("sync-license-btn");e&&(e.textContent="Syncing...",e.style.pointerEvents="none");const t=await this.refreshJWT();if(t){const n=this.decodeToken(t);if(n&&"activated"===n.licenseType){const e=document.getElementById("demo-mode-indicator"),t=document.getElementById("activated-badge");return e&&t?(e.style.transition="opacity 0.3s ease",e.style.opacity="0",setTimeout((()=>{e.style.display="none",t.style.display="inline-flex",t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout((()=>{t.style.opacity="1"}),50)}),300)):this.updateDemoModeIndicator(),window.SquareHeroProductManager&&window.SquareHeroProductManager.updateLicenseDisplay&&setTimeout((()=>{window.SquareHeroProductManager.updateLicenseDisplay()}),300),setTimeout((()=>{this.updateApplyButtonStates(!1)}),350),{success:!0,message:"License activated successfully!"}}return e&&(e.textContent="Still Demo",e.style.borderColor="#FFC107",e.style.color="#FFC107"),{success:!1,message:"Site refreshed but still in demo mode."}}return e&&(e.textContent="Still Demo",e.style.borderColor="#FFC107",e.style.color="#FFC107"),{success:!1,message:"Site is still in demo mode. Please activate it from your dashboard."}}catch(e){return{success:!1,message:"Error syncing license. Please try again."}}finally{const e=document.getElementById("sync-license-btn");e&&setTimeout((()=>{e.textContent="Sync License",e.style.borderColor="rgba(255,255,255,0.3)",e.style.color="white",e.style.pointerEvents="auto"}),2e3)}}async activateLicense(e,t){if(!e)throw new Error("Firebase authentication token is required");if(!(t&&t.id&&t.name&&t.domain))throw new Error("Complete site information is required (id, name, domain)");try{const n=await fetch(`${this.firebaseConfig._0x7cc61b43}/activateSiteLicense`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({siteId:t.id,siteName:t.name,siteDomain:t.domain})}),o=await n.json();if(n.ok&&o.success&&o.licenseToken)return this.storeLicense(o.licenseToken,o.siteInfo),this.updateDemoModeIndicator(),{success:!0,licenseToken:o.licenseToken,siteInfo:o.siteInfo,message:o.message};throw new Error(o.error||o.message||"License activation failed")}catch(e){throw e}}async getSiteInfo(){if(this.currentLicense&&this.currentLicense.siteInfo)return{id:this.currentLicense.siteInfo.siteId,name:this.currentLicense.siteInfo.siteName||window.location.hostname,domain:this.currentLicense.siteInfo.siteDomain||window.location.hostname};const e=await this.getSiteId();if(!e)return null;let t=window.location.hostname;const n=document.querySelector("title");return n&&n.textContent&&(t=n.textContent.replace(/\s*-\s*Admin$/,"").trim()),{id:e,name:t,domain:window.location.hostname}}async getSiteId(){if(this.currentLicense&&this.currentLicense.siteInfo)return this.currentLicense.siteInfo.siteId;const e=await this.getSquarespaceSiteId();return e?`squarespace-${e}`:null}async getSquarespaceSiteId(){try{const e=this.getCsrfToken();if(!e)return null;const t=await fetch("/api/commondata/GetCollections",{method:"GET",headers:{Accept:"application/json","X-CSRF-Token":e},credentials:"include"});if(!t.ok)return null;const n=await t.json();if(n&&n.collections){const e=Object.keys(n.collections);if(e.length>0){const t=n.collections[e[0]];if(t&&t.websiteId)return t.websiteId}}return null}catch(e){return null}}getCsrfToken(){const e=document.cookie.split(";").find((e=>e.trim().startsWith("crumb=")))?.split("=")[1];return e||null}getLicenseStatus(){if(!this.currentLicense)return{licensed:!1,status:"no_license",message:"No license found"};const e=this.currentLicense.siteInfo;if(!e)return{licensed:!1,status:"invalid_license",message:"Invalid license data"};if(this.currentLicense.token){const t=this.decodeToken(this.currentLicense.token);if(t&&t.licenseType){const n=Math.floor(Date.now()/1e3);if(t.exp&&t.exp<n)return{licensed:!1,status:"demo"===t.licenseType?"demo_expired":"expired",message:"demo"===t.licenseType?"Demo mode token has expired":"License has expired",demo:"demo"===t.licenseType};if("demo"===t.licenseType)return{licensed:!1,status:"demo",siteInfo:e,message:"Demo mode active",demo:!0,valid:!0};if("activated"===t.licenseType)return{licensed:!0,siteActivated:!0,siteInfo:e,message:"License is active",demo:!1,valid:!0}}}if(e.expiresAt){const t=new Date(e.expiresAt);if(new Date>t)return{licensed:!1,status:"expired",message:"License has expired",expiresAt:e.expiresAt}}return{licensed:!0,status:"active",siteInfo:e,message:"License is active",valid:!0}}clearLicense(){this.currentLicense=null,localStorage.removeItem(this.storageKey),this.updateDemoModeIndicator()}clearDemoToken(){return!(!this.currentLicense||!this.isDemoToken(this.currentLicense.token)||(this.clearLicense(),0))}isDemoToken(e){if(!e)return!1;const t=this.decodeToken(e);return t&&"demo"===t.licenseType}showLicenseError(){this.disablePlugin()}hideLicenseError(){const e=document.getElementById("license-error-banner");e&&(e.style.display="none")}disablePlugin(){const e=document.createElement("div");e.id="license-overlay",e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(255, 255, 255, 0.8);\n            z-index: 999998;\n            backdrop-filter: blur(2px);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n        ",e.innerHTML='\n            <div style="\n                background: white;\n                padding: 40px;\n                border-radius: 12px;\n                box-shadow: 0 20px 40px rgba(0,0,0,0.15);\n                text-align: center;\n                max-width: 400px;\n            ">\n                <div style="font-size: 48px; margin-bottom: 20px;">🔒</div>\n                <h2 style="margin: 0 0 12px 0; color: #333;">Site Activation Required</h2>\n                <p style="margin: 0 0 24px 0; color: #666; line-height: 1.5;">\n                    This site needs to be activated in your SquareHero dashboard to use the Products Manager.\n                </p>\n                <button onclick="window.open(\'https://squarehero.store/dashboard\', \'_blank\')" style="\n                    background: #0066cc;\n                    color: white;\n                    border: none;\n                    padding: 12px 24px;\n                    border-radius: 6px;\n                    font-weight: 600;\n                    cursor: pointer;\n                    font-size: 16px;\n                ">\n                    Open Dashboard\n                </button>\n            </div>\n        ',document.body.appendChild(e)}enablePlugin(){const e=document.getElementById("license-overlay");e&&e.remove(),this.hideLicenseError()}isBlocked(){return this.appBlocked}updateDemoModeIndicator(){const e=document.getElementById("demo-mode-indicator"),t=document.getElementById("activated-badge");if(!e)return;const n=this.getLicenseStatus();if("demo"===n.status&&n.valid){t&&(t.style.display="none"),e.style.display="inline-flex",e.innerHTML='\n                Demo mode\n                <button id="sync-license-btn" class="sync-license-btn" style="\n                    margin-left: 8px;\n                    background: none;\n                    border: 1px solid rgba(255,255,255,0.3);\n                    color: white;\n                    padding: 2px 8px;\n                    border-radius: 4px;\n                    font-size: 11px;\n                    cursor: pointer;\n                    transition: all 0.2s ease;\n                " onmouseover="this.style.backgroundColor=\'rgba(255,255,255,0.1)\'" \n                   onmouseout="this.style.backgroundColor=\'transparent\'">\n                    Sync License\n                </button>\n            ';const n=document.getElementById("sync-license-btn");n&&n.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation(),await this.forceLicenseSync()}))}else e.style.display="none",t&&(t.style.display="inline-flex");this.updateApplyButtonStates("demo"===n.status&&n.valid)}updateApplyButtonStates(e){document.getElementById("bulk-apply-all")&&"function"==typeof updateApplyAllButton&&updateApplyAllButton();const t=document.getElementById("save-changes");if(t)if(e)t.disabled=!0,t.textContent="Activate to Apply Changes",t.title="Apply changes is disabled in demo mode. Please activate your license to use this feature.";else{const e=window.changedProducts&&window.changedProducts.size>0;t.disabled=!e,t.textContent="Apply Changes",t.title=""}}decodeToken(e){try{const t=e.split(".");if(3!==t.length)return null;const n=atob(t[1].replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(n)}catch(e){return null}}async createDemoModeToken(){try{const e=await this.getSiteId();if(!e)return null;try{const t=await fetch(`${this.firebaseConfig._0x7cc61b43}/verifySiteLicense`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:e,checkStatusOnly:!0})});if(t.ok){if(!0===(await t.json()).siteActivated)return null}}catch(e){}const t=Math.floor(Date.now()/1e3),n={siteId:e,licenseType:"demo",connected:!0,iat:t,exp:t+604800,iss:"squarehero-product-manager"},o=await fetch(`${this.firebaseConfig._0x7cc61b43}/signJWT`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:n})});if(!o.ok)return null;return(await o.json()).token}catch(e){return null}}async createActivatedLicense(){try{const e=await this.getSiteId();if(!e)return null;const t=await fetch(`${this.firebaseConfig._0x7cc61b43}/verifySiteLicense`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:e,checkStatusOnly:!0})});if(!t.ok)return null;const n=await t.json();if(!n.success||!n.siteActivated)return null;let o;o=n.currentPeriodEnd?Math.floor(new Date(n.currentPeriodEnd).getTime()/1e3):Math.floor(Date.now()/1e3)+2592e3;const s={siteId:e,licenseType:"activated",iat:Math.floor(Date.now()/1e3),exp:o,customerId:n.customerId||null,billingPeriod:n.billingPeriod||"monthly"},i=await fetch(`${this.firebaseConfig._0x7cc61b43}/signJWT`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:s})});if(!i.ok)return null;const a=(await i.json()).token;return this.storeLicense(a,{siteId:e,id:e,activated:!0,activatedAt:n.activatedAt||(new Date).toISOString(),billingPeriod:n.billingPeriod||"monthly",expiresAt:new Date(1e3*o).toISOString()}),a}catch(e){return null}}getTimeUntilExpiry(){const e=this.getLicenseStatus();if(!e.licensed||!e.siteInfo||!e.siteInfo.expiresAt)return null;const t=new Date(e.siteInfo.expiresAt),n=new Date,o=t.getTime()-n.getTime();return o<=0?{expired:!0}:{days:Math.floor(o/864e5),hours:Math.floor(o%864e5/36e5),expired:!1}}async resetToDemo(e="Validation failed"){try{const t=await this.getSiteId();await fetch(`${this.firebaseConfig._0x7cc61b43}/verifySiteLicense`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:t,action:"resetToDemo",reason:e})})}catch(e){}this.clearLicense(),this.updateDemoModeIndicator()}async resetToDemo(e="FCM license revocation"){try{const t=await this.getSiteInfo();await fetch("https://verifysitelicense-n6bvhzbxla-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:t.id,action:"resetToDemo",reason:e})})}catch(e){}this.clearLicense(),this.updateDemoModeIndicator()}async re_0xe5da8364(){try{(await this.validateClientSide()).isValid?window.SquareHeroProductManager&&window.SquareHeroProductManager.updateLicenseDisplay&&window.SquareHeroProductManager.updateLicenseDisplay():await this.resetToDemo("License validation failed on recheck")}catch(e){await this.resetToDemo("License recheck failed with error")}}}window._0x21c74a45=_0x21c74a45,"undefined"!=typeof module&&module.exports&&(module.exports=_0x21c74a45),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{window.licenseManager=new _0x21c74a45})):window.licenseManager=new _0x21c74a45,window.initializeCustomUI=initializeCustomUI,window.closeModal=closeModal;const categoryOperationTracker={activeOperations:new Map,operationDelay:2e3,async waitForCategorySlot(e,t="remove"){const n=`${e}-${t}`,o=Date.now();if(!this.activeOperations.has(n))return void this.activeOperations.set(n,{count:1,lastOperation:o,queue:[]});const s=this.activeOperations.get(n);if(o-s.lastOperation>=this.operationDelay)return s.count++,void(s.lastOperation=o);const i=new Promise((n=>{s.queue.push({resolve:n,operationType:t,categoryName:e,queuedAt:o})}));this._processQueue(n),await i,s.count++,s.lastOperation=Date.now()},async _processQueue(e){const t=this.activeOperations.get(e);if(t&&0!==t.queue.length&&!t.processing){for(t.processing=!0;t.queue.length>0;){const e=Date.now()-t.lastOperation,n=Math.max(0,this.operationDelay-e);n>0&&await new Promise((e=>setTimeout(e,n)));const o=t.queue.shift();o&&(o.resolve(),t.lastOperation=Date.now())}t.processing=!1}},cleanup(){const e=Date.now()-2*this.operationDelay;for(const[t,n]of this.activeOperations.entries())n.lastOperation<e&&0===n.queue.length&&this.activeOperations.delete(t)}},preparationMessages=["Rearranging pixels...","Warming the coffee machine...","Dusting off the product shelves...","Sweeping the digital floor...","Polishing the product images...","Straightening the virtual shelves...","Quietly preparing magic..."];let preparationMessageInterval=null,usedMessages=[],updateBulkAdjustButton=function(){};window.updateApplyAllButton=updateApplyAllButton;const debouncedAutoSave=debounce((async()=>{try{await uploadPresetsToServer(window.savedPresets)}catch(e){}}),2e3),PRESET_STORAGE_KEY="squarehero-pm-presets";window.navigateProductCard=function(e){if(!window.totalProductCards||window.totalProductCards<=1)return;const t=window.currentProductCardIndex||0;window.currentProductCardIndex=t+e,window.currentProductCardIndex<0?window.currentProductCardIndex=window.totalProductCards-1:window.currentProductCardIndex>=window.totalProductCards&&(window.currentProductCardIndex=0),updateCarouselPosition()},window.goToProductCard=function(e){!window.totalProductCards||e<0||e>=window.totalProductCards||(window.currentProductCardIndex=e,updateCarouselPosition())};let globalCategoriesData=[],globalCollectionsData=[],globalCategoryTreeData=null;window.initializeProductTable=initializeProductTable,window.initializeChangesTracking=initializeChangesTracking,window.handleFieldEdit=handleFieldEdit,window.trackChanges=trackChanges,window.checkUnsavedChanges=checkUnsavedChanges,window.shakeFooter=shakeFooter,window.filterProducts=filterProducts;let currentPage=1,itemsPerPage=10,filteredItems=[];window.initializeSearchFiltering=initializeSearchFiltering,window.initializeMixItUpAfterProducts=initializeMixItUpAfterProducts,window.showSchedulePopup=showSchedulePopup,window.hideSchedulePopup=hideSchedulePopup,window.saveScheduledDate=saveScheduledDate,window.initializeSchedulePopup=initializeSchedulePopup,window.updateScheduledColumnVisibility=updateScheduledColumnVisibility,window.addScheduledDateToRow=addScheduledDateToRow,window.showStockPopup=showStockPopup,window.hideStockPopup=hideStockPopup;let undoHistory=[],selectedUndoIndex=null;const MAX_UNDO_HISTORY=5;window.initializeUndoSystem=initializeUndoSystem,window.captureUndoSnapshot=captureUndoSnapshot,window.updateUndoButtonState=updateUndoButtonState,window.openUndoDrawer=openUndoDrawer,window.closeUndoDrawer=closeUndoDrawer,window.restoreFromUndoIndex=restoreFromUndoIndex,window.undoHistory=undoHistory,window.getCurrentUrlMappings=getCurrentUrlMappings,window.saveUrlMappings=saveUrlMappings,window.applyUrlRedirects=applyUrlRedirects,window.getJsonFileUrl=getJsonFileUrl,window.extractFileIdFromUrl=extractFileIdFromUrl,window.deleteOldJsonFile=deleteOldJsonFile,window.updateMetaTagWithJsonUrl=updateMetaTagWithJsonUrl,window.generateUrlSlug=generateUrlSlug,window.generateUniqueUrlSlug=generateUniqueUrlSlug,window.showUrlSuggestion=showUrlSuggestion,window.hideUrlSuggestion=hideUrlSuggestion,window.applyUrlSuggestion=applyUrlSuggestion,window.initializeUrlManagement=initializeUrlManagement;let bulkChanges={categoryToAdd:null,roundPricesOnly:!1,priceAdjustment:null,regularAdjustmentType:"percentage",applyToSale:!1,fixedPrice:null,fixedApplyToSale:!1,saleDiscount:null,saleToggle:"no-change",enableRounding:!1,roundingType:"whole",customCents:99,newStatus:null,enableStockTracking:!1,stockAction:"set",stockAmount:null},currentPresetIndex=null,hasUnsavedChanges=!1,presetSettingsSnapshot=null,presetsData=null,globalProductsData=[],changedProducts=new Set,originalData=new Map;window.urlRedirects=new Map;let isLicensed=!1,licenseValidationInProgress=!1;window.startApplication=startApplication,window.showMessage=showMessage,window.updateCurrencyHeaders=updateCurrencyHeaders,window.initializeLicensing=initializeLicensing,window._0xe5da8364=_0xe5da8364,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initProductManager):initProductManager();
})();